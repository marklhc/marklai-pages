---
title: Multilevel Composite Reliability
author: marklai
date: '2022-11-13'
slug: multilevel-composite-reliability
categories:
  - Statistics
tags:
  - Reliability
  - Multilevel
  - SEM
subtitle: ''
summary: ''
authors: []
lastmod: '2022-11-13T20:56:38-08:00'
featured: no
draft: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---



<p>This is a short blog post on computing multilevel reliability based on <a href="/publication/lai2020pm">Lai (2021)</a>.</p>
<div id="load-packages" class="section level2">
<h2>Load Packages</h2>
<pre class="r"><code>library(lavaan)</code></pre>
<pre><code>## This is lavaan 0.6-12
## lavaan is FREE software! Please report any bugs.</code></pre>
<pre class="r"><code>library(semTools)</code></pre>
<pre><code>## </code></pre>
<pre><code>## ###############################################################################</code></pre>
<pre><code>## This is semTools 0.5-6</code></pre>
<pre><code>## All users of R (or SEM) are invited to submit functions or ideas for functions.</code></pre>
<pre><code>## ###############################################################################</code></pre>
<p>First, use demo data from <code>lavaan</code></p>
<pre class="r"><code>data(&quot;Demo.twolevel&quot;, package = &quot;lavaan&quot;)</code></pre>
<p>Then source a script I wrote <a href="https://github.com/marklhc/mcfa_reliability_supp/blob/master/multilevel_alpha.R">here</a> implementing the procedures in the paper, which defines a function <code>multilevel_alpha()</code>:</p>
<pre class="r"><code>source(&quot;https://github.com/marklhc/mcfa_reliability_supp/raw/master/multilevel_alpha.R&quot;)</code></pre>
<p>Example syntax in R and Mplus for the paper can be found in <a href="https://github.com/marklhc/mcfa_reliability_supp" class="uri">https://github.com/marklhc/mcfa_reliability_supp</a>. Going back to the multilevel demo data, we can consider the reliability for between-level and within-level composite scores when summing <code>y1</code>, <code>y2</code>, and <code>y3</code>. This can be done using</p>
<pre class="r"><code>multilevel_alpha(Demo.twolevel[c(&quot;y1&quot;, &quot;y2&quot;, &quot;y3&quot;)],
                 id = Demo.twolevel$cluster)</code></pre>
<pre><code>## Loading required package: psych</code></pre>
<pre><code>## 
## Attaching package: &#39;psych&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:semTools&#39;:
## 
##     reliability, skew</code></pre>
<pre><code>## The following object is masked from &#39;package:lavaan&#39;:
## 
##     cor2cov</code></pre>
<pre><code>## Parallel analysis suggests that the number of factors =  NA  and the number of components =  1 
## Parallel analysis suggests that the number of factors =  NA  and the number of components =  1</code></pre>
<pre><code>## $alpha
##   alpha2l    alphab    alphaw 
## 0.7523324 0.7613526 0.6682291 
## 
## $alpha_ci
##              2.5%     97.5%
## alpha2l 0.7280449 0.7736249
## alphab  0.7145704 0.7968058
## alphaw  0.6420312 0.6936817
## 
## $omega
##   omega2l    omegab    omegaw 
## 0.7669377 0.7837490 0.6761273 
## 
## $omega_ci
##              2.5%     97.5%
## omega2l 0.7428390 0.7866943
## omegab  0.7401762 0.8168061
## omegaw  0.6485975 0.7008100
## 
## $ncomp
##  within between 
##       1       1</code></pre>
<p>Note that the <span class="math inline">\(\omega\)</span> indices assume unidimensionality, local independence, and cross-level invariance. There were a total of six indices: three <span class="math inline">\(\alpha\)</span>s and three <span class="math inline">\(\omega\)</span>s, corresponding to raw composite (“2l”), between-level composite (“b”), and within-level composite (“w”). The 95% CIs were obtained using the Monte Carlo method by simulating from the asymptotic distribution of the model parameters. In addition, the function also implemented a parallel analysis procedure for determining the number of factors/components at each level, as discussed in <a href="https://www.tandfonline.com/doi/abs/10.1080/10705511.2021.1916394">this paper</a>.</p>
</div>
<div id="using-semtoolscomprelsem" class="section level2">
<h2>Using <code>semTools::compRelSEM()</code></h2>
<p>Some of the above procedures were implemented in the <code>semTools</code> package. To use that, one needs to fit a two-level CFA in <code>lavaan</code> first (see <code>?compRelSEM</code>:</p>
<pre class="r"><code>mcfa_mod &lt;- &#39;
  level: 1
    f =~ y1 + L2*y2 + L3*y3
  level: 2
    f =~ y1 + L2*y2 + L3*y3
&#39;
mcfa_fit &lt;- cfa(mcfa_mod, data = Demo.twolevel, cluster = &quot;cluster&quot;)</code></pre>
<p>Then call the function</p>
<pre class="r"><code>compRelSEM(mcfa_fit, config = c(&quot;f&quot;), shared = c(&quot;f&quot;))</code></pre>
<pre><code>## $config
## $config$f
##   omega_W  omega_2L 
## 0.6732269 0.7705154 
## 
## 
## $shared
## $shared$f
##   omega_B       IRR 
## 0.7972928 0.8361785</code></pre>
</div>
