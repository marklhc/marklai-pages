<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Mark Lai">
<meta name="dcterms.date" content="2017-08-25">

<title>Mark Lai - Confidence Intervals for Multilevel Mediation (Draft)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-NLMBWPMFDG"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-NLMBWPMFDG', { 'anonymize_ip': true});
</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Mark Lai</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../post.html" rel="" target="">
 <span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publication.html" rel="" target="">
 <span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../software.html" rel="" target="">
 <span class="menu-text">Software</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../course.html" rel="" target="">
 <span class="menu-text">Courses</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../presentation.html" rel="" target="">
 <span class="menu-text">Presentations</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#quasi-bayesianmonte-carlo-ci-with-the-mediation-package" id="toc-quasi-bayesianmonte-carlo-ci-with-the-mediation-package" class="nav-link active" data-scroll-target="#quasi-bayesianmonte-carlo-ci-with-the-mediation-package">Quasi-Bayesian/Monte Carlo CI With the <code>mediation</code> Package</a></li>
  <li><a href="#analytical-approaches-for-ci-with-the-rmediation-package" id="toc-analytical-approaches-for-ci-with-the-rmediation-package" class="nav-link" data-scroll-target="#analytical-approaches-for-ci-with-the-rmediation-package">Analytical Approaches for CI With the <code>RMediation</code> Package</a>
  <ul class="collapse">
  <li><a href="#distribution-of-product-of-coefficients" id="toc-distribution-of-product-of-coefficients" class="nav-link" data-scroll-target="#distribution-of-product-of-coefficients">Distribution of Product of Coefficients</a></li>
  <li><a href="#asymptotic-normal-ci" id="toc-asymptotic-normal-ci" class="nav-link" data-scroll-target="#asymptotic-normal-ci">Asymptotic Normal CI</a></li>
  </ul></li>
  <li><a href="#case-bootstrap" id="toc-case-bootstrap" class="nav-link" data-scroll-target="#case-bootstrap">Case Bootstrap</a>
  <ul class="collapse">
  <li><a href="#bootstrap-ci" id="toc-bootstrap-ci" class="nav-link" data-scroll-target="#bootstrap-ci">Bootstrap CI</a></li>
  </ul></li>
  <li><a href="#fully-bayesian-approach-with-rstan" id="toc-fully-bayesian-approach-with-rstan" class="nav-link" data-scroll-target="#fully-bayesian-approach-with-rstan">Fully Bayesian Approach With <code>rstan</code></a>
  <ul class="collapse">
  <li><a href="#posterior-credible-intervals" id="toc-posterior-credible-intervals" class="nav-link" data-scroll-target="#posterior-credible-intervals">Posterior (Credible) Intervals</a></li>
  </ul></li>
  <li><a href="#summary-table-of-different-cis" id="toc-summary-table-of-different-cis" class="nav-link" data-scroll-target="#summary-table-of-different-cis">Summary Table of Different CIs:</a></li>
  <li><a href="#bibliography" id="toc-bibliography" class="nav-link" data-scroll-target="#bibliography">Bibliography</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Confidence Intervals for Multilevel Mediation (Draft)</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Statistics</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Mark Lai </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 25, 2017</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p>The data are from the <code>mediation</code> package, which are simulated data with the source of the Education Longitudinal Study of 2002. For the interest of time as well as to consider situations where asymptotic normality may not hold, I only select 50 schools (out of 568) from the sample.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mediation)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"school"</span>, <span class="at">package =</span> <span class="st">"mediation"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Select only a random sample of 24 schools, stratified by </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># `coed` and `catholic`</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">827</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># School-level subsample:</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>school_sub <span class="ot">&lt;-</span> school <span class="sc">%&gt;%</span> <span class="fu">sample_n</span>(<span class="at">size =</span> <span class="dv">50</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(SCH_ID)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>school_sub <span class="sc">%&gt;%</span> <span class="fu">as_data_frame</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `as_data_frame()` was deprecated in tibble 2.0.0.
ℹ Please use `as_tibble()` (with slightly different semantics) to convert to a
  tibble, or `as.data.frame()` to convert to a data frame.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 50 × 5
   SCH_ID  coed smorale  free catholic
    &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt;    &lt;int&gt;
 1      7     1       5     3        0
 2     12     1       3     4        0
 3     14     1       3     2        0
 4     15     1       4     4        0
 5     33     1       4     3        0
 6     36     1       3     6        0
 7     38     1       5     4        0
 8     43     1       3     3        0
 9     52     1       5     1        0
10     55     1       4     6        0
# ℹ 40 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Student-level subsample:</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>student_sub <span class="ot">&lt;-</span> student <span class="sc">%&gt;%</span> <span class="fu">filter</span>(SCH_ID <span class="sc">%in%</span> school_sub<span class="sc">$</span>SCH_ID)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>student_sub <span class="sc">%&gt;%</span> <span class="fu">as_data_frame</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 804 × 13
   fight attachment  work score  late  coed smorale gender income  free pared
   &lt;int&gt;      &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;  &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt;
 1     0          1     0    52     2     1       4      1     10     6     0
 2     0          0     0    49     3     1       4      1      8     6     0
 3     0          1     0    52     1     1       4      1      8     6     0
 4     0          1     0    57     1     1       4      1     10     6     1
 5     0          1     0    42     2     1       4      1      8     6     1
 6     0          1     0    45     2     1       4      0     10     6     0
 7     0          1     0    41     1     1       4      1      5     6     0
 8     0          1     1    44     3     1       4      0      9     6     0
 9     0          0     1    37     3     1       4      1      5     6     0
10     0          1     0    61     2     1       4      0      8     6     0
# ℹ 794 more rows
# ℹ 2 more variables: catholic &lt;int&gt;, SCH_ID &lt;int&gt;</code></pre>
</div>
</div>
<p>The example is taken from <a href="ftp://ftp.gr.vim.org/mirrors/CRAN/web/packages/mediation/vignettes/mediation.pdf">the vignette of the <code>mediation</code> package</a> (p.&nbsp;19), where a school-level poverty indicator (<code>free</code>, “percent of 10th grade students receiving free lunch” with 7 levels) is hypothesized to cause school-level morale (<code>smorale</code> with 4 levels), which in turn causes student-level tardiness (<code>late</code>, “frequency in which the student was late for school” with 5 levels). For the mediator equation, the school-level covariates are <code>catholic</code> and <code>coed</code>; for the outcome equation, in addition to the school-level covariates, student-level covariates are <code>gender</code>, <code>income</code>, <code>pared</code>.</p>
<section id="quasi-bayesianmonte-carlo-ci-with-the-mediation-package" class="level2">
<h2 class="anchored" data-anchor-id="quasi-bayesianmonte-carlo-ci-with-the-mediation-package">Quasi-Bayesian/Monte Carlo CI With the <code>mediation</code> Package</h2>
<p>The <code>mediate()</code> function provides CI for the indirect effect using Quasi-Bayesian method, which I believe is similar to the Monte Carlo method by assuming normality of the <span class="math inline">\(a\)</span> path and the <span class="math inline">\(b\)</span> path. Bootstrapping is not supported when one equation is a multilevel model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using the mediation package</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Mediator equation</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>med_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(smorale <span class="sc">~</span> free <span class="sc">+</span> catholic <span class="sc">+</span> coed, <span class="at">data =</span> school_sub)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Outcome equation</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>out_fit <span class="ot">&lt;-</span> <span class="fu">lmer</span>(late <span class="sc">~</span> free <span class="sc">+</span> smorale <span class="sc">+</span> catholic <span class="sc">+</span> coed <span class="sc">+</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>                  gender <span class="sc">+</span> income <span class="sc">+</span> pared <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> SCH_ID), <span class="at">data =</span> student_sub)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Record the time:</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(med_out <span class="ot">&lt;-</span> <span class="fu">mediate</span>(med_fit, out_fit, <span class="at">treat =</span> <span class="st">"free"</span>, </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>                               <span class="at">mediator =</span> <span class="st">"smorale"</span>,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                               <span class="at">control.value =</span> <span class="dv">3</span>, <span class="at">treat.value =</span> <span class="dv">4</span>, <span class="at">sims =</span> <span class="dv">500</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
  2.061   0.020   2.082 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(med_out)  <span class="co"># Summary of mediation analysis</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Causal Mediation Analysis 

Quasi-Bayesian Confidence Intervals

Mediator Groups: 

Outcome Groups: SCH_ID 

Output Based on Overall Averages Across Groups 

               Estimate 95% CI Lower 95% CI Upper p-value  
ACME           -0.00535     -0.02541         0.01    0.54  
ADE             0.05599     -0.00895         0.13    0.08 .
Total Effect    0.05063     -0.01316         0.12    0.13  
Prop. Mediated -0.06275     -2.02871         1.35    0.58  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Sample Size Used: 804 


Simulations: 500 </code></pre>
</div>
</div>
<p>The output gives the “ACME” (average causal mediation effect) estimate, which equals estimator of <span class="math inline">\(ab\)</span> under a normal model, as well as “ADE” (average direct effect), which equals estimator of <span class="math inline">\(c'\)</span> under a normal model, and ACME and ADE add up to the “Total Effect”, and the proportion mediated as estimating <span class="math inline">\(ab / (ab + c')\)</span>. The posterior median was used for all the quantities, together with the credible intervals.</p>
<p>One can use the posterior samples (e.g., <code>d0.sim</code> for the posterior samples of the <span class="math inline">\(a\)</span> path) to compute any derived quantities. However, the posterior samples for the variance components are not available, so one cannot compute standardized coefficients or effect sizes defined using variance components.</p>
</section>
<section id="analytical-approaches-for-ci-with-the-rmediation-package" class="level2">
<h2 class="anchored" data-anchor-id="analytical-approaches-for-ci-with-the-rmediation-package">Analytical Approaches for CI With the <code>RMediation</code> Package</h2>
<p>The two main analytical approaches are <span class="citation" data-cites="MacKinnon2004">(see <a href="#ref-MacKinnon2004" role="doc-biblioref">MacKinnon, Lockwood, and Williams 2004</a>)</span>:</p>
<ol type="1">
<li>distribution of product of coefficients</li>
<li>Asymptotic normal CI (or Wald CI)</li>
</ol>
<section id="distribution-of-product-of-coefficients" class="level3">
<h3 class="anchored" data-anchor-id="distribution-of-product-of-coefficients">Distribution of Product of Coefficients</h3>
<p>This approach uses the quantiles of the distribution of <span class="math inline">\(ab\)</span> when <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> are assumed bivariate normal. Therefore, the Quasi-Bayesian/Monte Carlo approach can be viewed as an approximation of it. It is, however, less flexible as it does not provide distributions of other derived quantities (e.g., proportion mediated).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># With RMediation</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>nmtx <span class="ot">&lt;-</span> <span class="st">"free"</span>  <span class="co"># name of treatment variable</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>nmmed <span class="ot">&lt;-</span> <span class="st">"smorale"</span>  <span class="co"># name of mediator</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">coef</span>(med_fit)[nmtx]  <span class="co"># estimate of a path with name removed</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>va <span class="ot">&lt;-</span> <span class="fu">vcov</span>(med_fit)[nmtx, nmtx]  <span class="co"># sampling variance of a path</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">fixef</span>(out_fit)[nmmed]  <span class="co"># estimate of b path with name removed</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>vb <span class="ot">&lt;-</span> <span class="fu">vcov</span>(out_fit)[nmmed, nmmed]  <span class="co"># sampling variance of b path</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribution of Product of Coefficients</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>(med_dop <span class="ot">&lt;-</span> RMediation<span class="sc">::</span><span class="fu">medci</span>(<span class="at">mu.x =</span> a, <span class="at">mu.y =</span> b, <span class="at">type =</span> <span class="st">"dop"</span>, </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>                              <span class="at">se.x =</span> <span class="fu">sqrt</span>(va), <span class="at">se.y =</span> <span class="fu">sqrt</span>(vb)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`95% CI`
[1] -0.02656919  0.01056354

$Estimate
        free 
-0.004806245 

$SE
       free 
0.009017573 </code></pre>
</div>
</div>
</section>
<section id="asymptotic-normal-ci" class="level3">
<h3 class="anchored" data-anchor-id="asymptotic-normal-ci">Asymptotic Normal CI</h3>
<p>The asymptotic <em>SE</em> for the product of two normal variables, as defined in the <code>RMediation</code> package, is: <span class="math display">\[\textit{SE}(\hat a \hat b) = \sqrt{a^2 \textit{SE}^2(b) + b^2 \textit{SE}^2(a) +
                       2 ab \textit{SE}(a) \textit{SE}(b) r_{\hat a \hat b} +
                       \textit{SE}^2(a) \textit{SE}^2(b) r_{\hat a \hat b}}\]</span> And we replace <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span>, <span class="math inline">\(\textit{SE}(a)\)</span>, <span class="math inline">\(\textit{SE}(b)\)</span> with the corresponding sample estimates. Note that as we use separate equations to obtain <span class="math inline">\(\hat a\)</span> and <span class="math inline">\(\hat b\)</span>, the correlation between them, <span class="math inline">\(r_{\hat a \hat b}\)</span>, is assumed zero, so the asymptotic <em>SE</em> is computed as: <span class="math display">\[\textit{SE}(\hat a \hat b) = \sqrt{a^2 \textit{SE}^2(b) + b^2 \textit{SE}^2(a)}\]</span> and the Asymptotic symmetric CI is <span class="math inline">\(\hat a \hat b \pm 1.96 \textit{SE}(\hat a \hat b)\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming Asymptotic Normality</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>(med_asym <span class="ot">&lt;-</span> RMediation<span class="sc">::</span><span class="fu">medci</span>(<span class="at">mu.x =</span> a, <span class="at">mu.y =</span> b, <span class="at">type =</span> <span class="st">"asymp"</span>, </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">se.x =</span> <span class="fu">sqrt</span>(va), <span class="at">se.y =</span> <span class="fu">sqrt</span>(vb)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`95% CI`
[1] -0.02248036  0.01286787

$Estimate
        free 
-0.004806245 

$SE
       free 
0.009017573 </code></pre>
</div>
</div>
</section>
</section>
<section id="case-bootstrap" class="level2">
<h2 class="anchored" data-anchor-id="case-bootstrap">Case Bootstrap</h2>
<p>All the above approaches involve normality assumptions: the quasi-Bayesian and the distribution of product approaches assume the sampling distribution of <span class="math inline">\(\hat a\)</span> and <span class="math inline">\(\hat b\)</span> are jointly normal, whereas the asymptotic CI assumes that the sampling distribution of <span class="math inline">\(\hat a \hat b\)</span> is normal. In small sample and/or with non-normal data, such assumptions may not hold. That is one of the reasons that resampling methods, in particular the bootstrap, is popular for single-level mediation analysis.</p>
<p>There are many methods to do bootstrapping with multilevel analysis <span class="citation" data-cites="VanderLeeden2008">(see <a href="#ref-VanderLeeden2008" role="doc-biblioref">Leeden, Meijer, and Busing 2008</a> for an overview)</span>. However, to my knowledge most of them are not directly built in multilevel software, especially for mediation models. A relatively simple bootstrapping method is the <em>case bootstrap</em>, which resample intact clusters with replacement. The advantage is that it basically makes no assumption about the data, such as the specification of the functional form and the distribution of the random effects. Therefore the results should be robust. The drawback, however, is that when the cluster sizes are not balanced, as in our example, it results in bootstrap samples with different level-1 sample sizes. And based on my experience it is generally less efficient and requires a relatively large number of clusters to perform well. Below is my implementation of the case bootstrap for this example, which include the indirect effect and some derived quantities.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(boot)  <span class="co"># load the boot package</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the unique school IDs as a global variable</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>sch_id <span class="ot">&lt;-</span> school_sub<span class="sc">$</span>SCH_ID</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>lv1_resample <span class="ot">&lt;-</span> <span class="cf">function</span>(new_lv2_id, <span class="at">data =</span> student_sub, </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">group_var =</span> <span class="st">"SCH_ID"</span>) {</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return a resampled lv-1 data set given an input of cluster values</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># </span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Args:</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   new_lv2_id: A vector (character/numeric) showing the cluster values </span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#               to be selected. </span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   data: The lv-1 data set to be resampled. </span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   group_var: A character vector of length 1 indicating the variable name</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#              for cluster ID</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Returns:</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   A data.frame object with the resampled data. </span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  group <span class="ot">&lt;-</span> data[[group_var]]</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  N <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  new_lv1_index <span class="ot">&lt;-</span> <span class="fu">unlist</span>(</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(new_lv2_id, <span class="cf">function</span>(i) <span class="fu">seq_len</span>(N)[group <span class="sc">==</span> i]))</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  gp_tab <span class="ot">&lt;-</span> <span class="fu">table</span>(group, <span class="at">dnn =</span> <span class="cn">NULL</span>)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>  gp_length <span class="ot">&lt;-</span> gp_tab[<span class="fu">as.character</span>(new_lv2_id)]</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># `new_group` make sure that each resampled cluster get a distinct </span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cluster ID. </span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>  new_group <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">seq_along</span>(new_lv2_id), gp_length)</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>  new_data <span class="ot">&lt;-</span> data[new_lv1_index, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>  new_data[group_var] <span class="ot">&lt;-</span> new_group</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(new_data) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>  new_data</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>ab_resample <span class="ot">&lt;-</span> <span class="cf">function</span>(data_lv2, i, ...) {</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>  new_sch_id <span class="ot">&lt;-</span> sch_id[i]</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>  med_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(smorale <span class="sc">~</span> free <span class="sc">+</span> catholic <span class="sc">+</span> coed, <span class="at">data =</span> data_lv2[i, ])</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>  new_stud_dat <span class="ot">&lt;-</span> <span class="fu">lv1_resample</span>(new_sch_id, ...)</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use `calc.dervis` to skip computing the derivatives and save </span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># some time for each bootstrap replication</span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>  out_fit <span class="ot">&lt;-</span> <span class="fu">lmer</span>(late <span class="sc">~</span> free <span class="sc">+</span> smorale <span class="sc">+</span> catholic <span class="sc">+</span> coed <span class="sc">+</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>                  gender <span class="sc">+</span> income <span class="sc">+</span> pared <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> SCH_ID), <span class="at">data =</span> new_stud_dat, </span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>                  <span class="at">control =</span> <span class="fu">lmerControl</span>(<span class="at">calc.derivs =</span> <span class="cn">FALSE</span>))</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> <span class="fu">unname</span>(<span class="fu">coef</span>(med_fit)[nmtx])</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> <span class="fu">unname</span>(<span class="fu">fixef</span>(out_fit)[nmmed])</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>  ab <span class="ot">&lt;-</span> a <span class="sc">*</span> b</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>  va <span class="ot">&lt;-</span> <span class="fu">vcov</span>(med_fit)[nmtx, nmtx]</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>  vb <span class="ot">&lt;-</span> <span class="fu">vcov</span>(out_fit)[nmmed, nmmed]</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># variance components (for standardizing y):</span></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>  sigma_y <span class="ot">&lt;-</span> <span class="fu">sigma</span>(out_fit)  <span class="co"># level-1 SD</span></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>  tau <span class="ot">&lt;-</span> <span class="fu">getME</span>(out_fit, <span class="st">"theta"</span>) <span class="sc">*</span> sigma_y  <span class="co"># random intercept SD</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># c-prime (for getting proportion mediated)</span></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>  c_prime <span class="ot">&lt;-</span> <span class="fu">unname</span>(<span class="fu">fixef</span>(out_fit)[nmtx])</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="at">ab =</span> ab, </span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">vab =</span> a<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> vb <span class="sc">+</span> b<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> va, </span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">ab_stdy =</span> ab <span class="sc">/</span> <span class="fu">sqrt</span>(tau<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sigma_y<span class="sc">^</span><span class="dv">2</span>), </span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">pm =</span> ab <span class="sc">/</span> (ab <span class="sc">+</span> c_prime))</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(med_boo <span class="ot">&lt;-</span> <span class="fu">boot</span>(school_sub, ab_resample, <span class="dv">1000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
 14.671   0.012  14.684 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>med_boo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
ORDINARY NONPARAMETRIC BOOTSTRAP


Call:
boot(data = school_sub, statistic = ab_resample, R = 1000)


Bootstrap Statistics :
         original        bias     std. error
t1* -4.806245e-03 -9.497912e-04 9.550607e-03
t2*  5.848034e-05  5.562889e-05 1.004374e-04
t3* -4.431893e-03 -8.908471e-04 8.853632e-03
t4* -9.449125e-02 -7.394217e-01 2.031118e+01</code></pre>
</div>
</div>
<p>We can plot the bootstrap distributions (Note the non-normality)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(med_boo, <span class="at">index =</span> 1L)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The output shows that the indirect effect estimate was biased by 20%, whereas the estimated sampling variance was biased by 95%! (or 28% for standard error bias)</p>
<section id="bootstrap-ci" class="level3">
<h3 class="anchored" data-anchor-id="bootstrap-ci">Bootstrap CI</h3>
<section id="indirect-effect" class="level4">
<h4 class="anchored" data-anchor-id="indirect-effect">Indirect effect</h4>
<p>Generally BCa (bias-corrected and accelerated) and studentized CIs (also called bootstrap-<span class="math inline">\(t\)</span>) are more accurate <span class="citation" data-cites="Davison1997">G. W. Cheung and Lau (<a href="#ref-Cheung2008" role="doc-biblioref">2008</a>)</span>. However, the BCa needs the accerlation value (which is used to correct for skewness), which is estimated using the regression estimation here, and to my knowledge its use for multilevel data has not been tested.</p>
<p>The studentized CI requires the use of the sampling variance of the statistic to be bootstrapped, which is why I also computed the asymptotic variance of the indirect effect in each bootstrap replication.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For (unstandardized) indirect effect</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>(med_bootci <span class="ot">&lt;-</span> <span class="fu">boot.ci</span>(med_boo, <span class="at">type =</span> <span class="st">"all"</span>, <span class="at">index =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>BOOTSTRAP CONFIDENCE INTERVAL CALCULATIONS
Based on 1000 bootstrap replicates

CALL : 
boot.ci(boot.out = med_boo, type = "all", index = 1:2)

Intervals : 
Level      Normal              Basic             Studentized     
95%   (-0.0226,  0.0149 )   (-0.0187,  0.0184 )   (-0.0213,  0.0058 )  

Level     Percentile            BCa          
95%   (-0.0280,  0.0091 )   (-0.0387,  0.0058 )  
Calculations and Intervals on Original Scale</code></pre>
</div>
</div>
<p>As you can see, for the indirect effect estimate, both BCa and studentized CIs gave results that are closer compared to other types of CIs. The BCa was known to sometimes overcorrect for skewness, and in this case it might seem to be pushing the confidence limits to the right.</p>
</section>
<section id="y-standardized-indirect-effect" class="level4">
<h4 class="anchored" data-anchor-id="y-standardized-indirect-effect"><span class="math inline">\(y\)</span>-standardized indirect effect</h4>
<p>We also can get study the the indirect effect with <span class="math inline">\(y\)</span> standardized, referred to as <span class="math inline">\(ab_{ps}\)</span> in the literature, defined as <span class="math display">\[ab_{ps} = \frac{ab}{\sqrt{\tau^2_y + \sigma^2_y}},\]</span> where <span class="math inline">\(\tau^2_y + \sigma^2_y\)</span> is the total variance of <span class="math inline">\(y\)</span>. <span class="math inline">\(ab_{ps}\)</span> has the interpretation of:</p>
<blockquote class="blockquote">
<p>Every unit increase in <span class="math inline">\(x\)</span> (treatment variable) results in a change of <span class="math inline">\(ab_{ps}\)</span> standard deviations in <span class="math inline">\(y\)</span> through the mediator.</p>
</blockquote>
<p>First look at the bootstrap distribution:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(med_boo, <span class="at">index =</span> 3L)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>It’s easy to get the bootstrap CIs. However, for the <span class="math inline">\(y\)</span>-standardized indirect effect and the proportion mediated it would be more work to obtain the sampling variance estimates (which can be obtained with the delta method or with other resampling method within each bootstrap sample; the former needs some derivation and may not be very accurate and the latter will increase the computation time by a factor of 100 or more, which is not practical), so I did not request for the studentized CI.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For y-standardized indirect</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">boot.ci</span>(med_boo, <span class="at">type =</span> <span class="fu">c</span>(<span class="st">"norm"</span>, <span class="st">"basic"</span>, <span class="st">"perc"</span>, <span class="st">"bca"</span>), <span class="at">index =</span> 3L)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>BOOTSTRAP CONFIDENCE INTERVAL CALCULATIONS
Based on 1000 bootstrap replicates

CALL : 
boot.ci(boot.out = med_boo, type = c("norm", "basic", "perc", 
    "bca"), index = 3)

Intervals : 
Level      Normal              Basic         
95%   (-0.0209,  0.0138 )   (-0.0174,  0.0169 )  

Level     Percentile            BCa          
95%   (-0.0258,  0.0086 )   (-0.0347,  0.0056 )  
Calculations and Intervals on Original Scale</code></pre>
</div>
</div>
<p>As shown in the result, BCa interval is wider but with higher lower and upper confidence limits. For single-level mediation <span class="citation" data-cites="Cheung2009">M. W.-L. Cheung (<a href="#ref-Cheung2009" role="doc-biblioref">2009</a>)</span> showed that the percentile and BCa CIs are better than Wald CI and using the <code>PRODCLIN CI</code> macro. It is still an open question how the different bootstrap CIs perform in multilevel mediation.</p>
</section>
<section id="proportion-mediated" class="level4">
<h4 class="anchored" data-anchor-id="proportion-mediated">Proportion mediated</h4>
<p>Again, check the bootstrap distribution:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(med_boo, <span class="at">index =</span> 4L)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Finally, we can get CIs for proportion mediated:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For proportion mediated</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">boot.ci</span>(med_boo, <span class="at">type =</span> <span class="fu">c</span>(<span class="st">"norm"</span>, <span class="st">"basic"</span>, <span class="st">"perc"</span>, <span class="st">"bca"</span>), <span class="at">index =</span> 4L)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>BOOTSTRAP CONFIDENCE INTERVAL CALCULATIONS
Based on 1000 bootstrap replicates

CALL : 
boot.ci(boot.out = med_boo, type = c("norm", "basic", "perc", 
    "bca"), index = 4)

Intervals : 
Level      Normal              Basic         
95%   (-39.1643,  40.4541 )   ( -0.7092,   1.5193 )  

Level     Percentile            BCa          
95%   (-1.7082,  0.5202 )   (-9.0233,  0.1396 )  
Calculations and Intervals on Original Scale
Some BCa intervals may be unstable</code></pre>
</div>
</div>
<p>The percentile CI (and to a less degree the basic CI) was close to the one given with the <code>mediation</code> package, whereas the normal bootstrap CI and the BCa CI had much wider intervals. After all, I don’t think proportion mediated would be a good measure of effect size, as also pointed out in <span class="citation" data-cites="Miocevic2017">Miočević et al. (<a href="#ref-Miocevic2017" role="doc-biblioref">2017</a>)</span>.</p>
<p>Note that I only illustrated case bootstrap in this post. For clustered data, in <span class="citation" data-cites="Davison1997">Davison and Hinkley (<a href="#ref-Davison1997" role="doc-biblioref">1997</a>)</span>, it was found that residual bootstrap may result in better coverage. I may implement residual bootstrap for mediation in the R package I am working on, <code>bootmlm</code>.</p>
</section>
</section>
</section>
<section id="fully-bayesian-approach-with-rstan" class="level2">
<h2 class="anchored" data-anchor-id="fully-bayesian-approach-with-rstan">Fully Bayesian Approach With <code>rstan</code></h2>
<p>Brad Efron said the bootstrap can be an approximation of Bayesian estimation. So we can actually do a fully Bayesian model, which actually is not complicated to fit. It is basically putting a Bayesian multiple regression and a random intercept model together. Given that the scales of the variables are quite similar and generally with SD = 0.5 to 2, I used weakly informative priors with <span class="math inline">\(N(0, 10^2)\)</span> for the fixed effects and <span class="math inline">\(t_3(0, 10^2)\)</span> for the random effect standard deviations (i.e., <span class="math inline">\(\sigma_m\)</span>, <span class="math inline">\(\tau_y\)</span>, <span class="math inline">\(\sigma_y\)</span>).</p>
<p>The Bayesian model here assumes normality in the random effects but not asymptotic normality of the posterior distributions of <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> and other parameters.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rstan_options</span>(<span class="at">auto_write =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">mc.cores =</span> 2L)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(coda)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Below is the STAN code for the multilevel mediation model:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>data { 
  // input for mediator model
  int&lt;lower=1&gt; J;  // total number of clusters
  vector[J] M;  // mediator variable (at level-2)
  int&lt;lower=1&gt; Kw;  // number of effects for the mediator (including intercept)
  matrix[J, Kw] W;  // level-2 design matrix for the mediator (including intercept)
  // input for outcome model
  int&lt;lower=1&gt; N;  // total number of observations 
  vector[N] Y;  // mediator variable (at level-2)
  int&lt;lower=1&gt; Kx;  // number of effects for the outcome (including intercept)
  matrix[N, Kx] X;  // level-1 design matrix for the outcome (including intercept)
  int&lt;lower=1&gt; gid[N];  // cluster ID
} 
transformed data { 
  int Kwc = Kw - 1; 
  int Kxc = Kx - 1; 
  matrix[J, Kwc] Wc;  // centered version of W 
  matrix[N, Kxc] Xc;  // centered version of X 
  for (i in 2:Kw) { 
    Wc[, i - 1] = W[, i] - mean(W[, i]); 
  } 
  for (i in 2:Kx) { 
    Xc[, i - 1] = X[, i] - mean(X[, i]); 
  } 
} 
parameters { 
  vector[Kwc] a;  // fixed effects for M
  vector[Kxc] b;  // fixed effects for Y
  real temp_b0_m;  // intercept for M (with centered predictors)
  real temp_b0_y;  // intercept for Y (with centered predictors)
  real&lt;lower=0&gt; sigma_m;  // residual SD for M
  real&lt;lower=0&gt; tau_y;  // group-level residual SD for Y
  real&lt;lower=0&gt; sigma_y;  // group-level residual SD for Y
  vector[J] z_y;  // unscaled group-level effects 
} 
transformed parameters { 
  // group-level effects 
  vector[J] beta_y = tau_y * z_y; 
} 
model { 
  vector[J] mu_m = temp_b0_m + Wc * a;
  vector[N] mu_y = temp_b0_y + Xc * b; 
  for (n in 1:N) { 
    mu_y[n] = mu_y[n] + beta_y[gid[n]];  // group specific effect
  } 
  // prior specifications 
  a ~ normal(0, 10);
  b ~ normal(0, 10); 
  sigma_m ~ student_t(3, 0, 10); 
  sigma_y ~ student_t(3, 0, 10); 
  tau_y ~ student_t(3, 0, 10); 
  z_y ~ normal(0, 1); 
  // likelihood contribution 
  M ~ normal(mu_m, sigma_m);
  Y ~ normal(mu_y, sigma_y); 
} 
generated quantities {
  real ab = a[1] * b[2];  // indirect effect
  real ab_stdy = ab / sqrt(tau_y^2 + sigma_y^2); 
  real pm = ab / (ab + b[2]);  // proportion mediated
}</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>numeric_id <span class="ot">&lt;-</span> <span class="cf">function</span>(id) {</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make group ID to be natural numbers from 1, 2, ..., as needed in the </span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># STAN program</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">match</span>(id, <span class="fu">unique</span>(id))</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>med_sdata <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">J =</span> <span class="fu">nrow</span>(school_sub), </span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">M =</span> school_sub<span class="sc">$</span>smorale, </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Kw =</span> <span class="dv">4</span>, </span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">W =</span> <span class="fu">cbind</span>(<span class="dv">1</span>, school_sub[<span class="fu">c</span>(<span class="st">"free"</span>, <span class="st">"catholic"</span>, <span class="st">"coed"</span>)]), </span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">N =</span> <span class="fu">nrow</span>(student_sub), </span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Y =</span> student_sub<span class="sc">$</span>late, </span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Kx =</span> <span class="dv">8</span>, </span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">X =</span> <span class="fu">cbind</span>(<span class="dv">1</span>, student_sub[<span class="fu">c</span>(<span class="st">"free"</span>, <span class="st">"smorale"</span>, <span class="st">"catholic"</span>, </span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">"coed"</span>, <span class="st">"gender"</span>, <span class="st">"income"</span>, </span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">"pared"</span>)]), </span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">gid =</span> <span class="fu">numeric_id</span>(student_sub<span class="sc">$</span>SCH_ID))</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>med_stan <span class="ot">&lt;-</span> <span class="fu">stan</span>(<span class="st">"stan_mlm_mediate.stan"</span>, <span class="at">data =</span> med_sdata, </span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>                 <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">"temp_b0_m"</span>, <span class="st">"temp_b0_y"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, </span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"sigma_m"</span>, <span class="st">"sigma_y"</span>, <span class="st">"tau_y"</span>, </span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"ab"</span>, <span class="st">"ab_stdy"</span>, <span class="st">"pm"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="posterior-credible-intervals" class="level3">
<h3 class="anchored" data-anchor-id="posterior-credible-intervals">Posterior (Credible) Intervals</h3>
<p>We can get the commonly-used equal-tailed interval or the shorter (but maybe less stable) highest posterior density interval (HPDI).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the posterior samples</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>pars_post <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(med_stan, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">"ab"</span>, <span class="st">"ab_stdy"</span>, <span class="st">"pm"</span>))</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Posterior distribution of ab:</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(pars_post[ , <span class="dv">1</span>], <span class="at">xlab =</span> <span class="st">"ab"</span>, <span class="at">main =</span> <span class="st">"Posterior distribution of ab"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" style="width:50.0%"></p>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Equal-tailed interval:</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>(post_ci <span class="ot">&lt;-</span> <span class="fu">apply</span>(pars_post, <span class="dv">2</span>, quantile, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">025</span>, .<span class="dv">975</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       parameters
                 ab     ab_stdy          pm
  2.5%  -0.02806587 -0.02563696 -0.32200074
  97.5%  0.01229471  0.01127326  0.04537348</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># HPDI</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>(post_hpdi <span class="ot">&lt;-</span> coda<span class="sc">::</span><span class="fu">HPDinterval</span>(<span class="fu">as.mcmc</span>(pars_post)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              lower      upper
ab      -0.02638017 0.01363179
ab_stdy -0.02473339 0.01178296
pm      -0.30653721 0.05423363
attr(,"Probability")
[1] 0.95</code></pre>
</div>
</div>
</section>
</section>
<section id="summary-table-of-different-cis" class="level2">
<h2 class="anchored" data-anchor-id="summary-table-of-different-cis">Summary Table of Different CIs:</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>format_ci <span class="ot">&lt;-</span> <span class="cf">function</span>(ci) {</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">"("</span>, <span class="fu">paste</span>(<span class="fu">comma</span>(ci), <span class="at">collapse =</span> <span class="st">","</span>), <span class="st">")"</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data_frame</span>(<span class="at">Method =</span> <span class="fu">c</span>(<span class="st">"Quasi-Bayesian"</span>, <span class="st">"DOP"</span>, <span class="st">"Asymptotic"</span>, </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Boot Studentized"</span>, <span class="st">"Boot Percentile"</span>, </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Boot BCa"</span>, <span class="st">"Bayesian CI"</span>, <span class="st">"Bayesian HPDI"</span>), </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">95% CI</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">format_ci</span>(med_out<span class="sc">$</span>d0.ci), </span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">format_ci</span>(med_dop[[<span class="dv">1</span>]]), </span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">format_ci</span>(med_asym[[<span class="dv">1</span>]]), </span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">format_ci</span>(<span class="fu">tail</span>(med_bootci<span class="sc">$</span>student[<span class="dv">1</span>, ], 2L)), </span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">format_ci</span>(<span class="fu">tail</span>(med_bootci<span class="sc">$</span>percent[<span class="dv">1</span>, ], 2L)), </span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">format_ci</span>(<span class="fu">tail</span>(med_bootci<span class="sc">$</span>bca[<span class="dv">1</span>, ], 2L)), </span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">format_ci</span>(post_ci[ , <span class="st">"ab"</span>]), </span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">format_ci</span>(post_hpdi[<span class="st">"ab"</span>, ]))) <span class="sc">%&gt;%</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `data_frame()` was deprecated in tibble 1.1.0.
ℹ Please use `tibble()` instead.</code></pre>
</div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Method</th>
<th style="text-align: left;">95% CI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Quasi-Bayesian</td>
<td style="text-align: left;">(-0.0254, 0.0096)</td>
</tr>
<tr class="even">
<td style="text-align: left;">DOP</td>
<td style="text-align: left;">(-0.027, 0.011)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Asymptotic</td>
<td style="text-align: left;">(-0.022, 0.013)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Boot Studentized</td>
<td style="text-align: left;">(-0.0213, 0.0058)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Boot Percentile</td>
<td style="text-align: left;">(-0.0280, 0.0091)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Boot BCa</td>
<td style="text-align: left;">(-0.0387, 0.0058)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Bayesian CI</td>
<td style="text-align: left;">(-0.028, 0.012)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bayesian HPDI</td>
<td style="text-align: left;">(-0.026, 0.014)</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The CIs across methods are somewhat similar, with the exception of BCa and studentized bootstrap CIs and the asymptotic CI, with the two bootstrap CIs having wider intervals. Further studies are needed to compare their performance.</p>
</section>
<section id="bibliography" class="level2">




</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">Bibliography</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-Cheung2008" class="csl-entry" role="listitem">
Cheung, Gordon W., and Rebecca S. Lau. 2008. <span>“<span class="nocase">Testing mediation and suppression effects of latent variables</span>.”</span> <em>Organizational Research Methods</em> 11 (2): 296–325. <a href="https://doi.org/10.1177/1094428107300343">https://doi.org/10.1177/1094428107300343</a>.
</div>
<div id="ref-Cheung2009" class="csl-entry" role="listitem">
Cheung, Mike W-L. 2009. <span>“<span class="nocase">Comparison of methods for constructing confidence intervals of standardized indirect effects.</span>”</span> <em>Behavior Research Methods</em> 41 (2): 425–38. <a href="https://doi.org/10.3758/BRM.41.2.425">https://doi.org/10.3758/BRM.41.2.425</a>.
</div>
<div id="ref-Davison1997" class="csl-entry" role="listitem">
Davison, A. C., and D. V. Hinkley. 1997. <em><span class="nocase">Bootstrap methods and their application</span></em>. Cambridge, UK: Cambridge University Press.
</div>
<div id="ref-VanderLeeden2008" class="csl-entry" role="listitem">
Leeden, Rien van der, Erik Meijer, and Frank M. T. A. Busing. 2008. <span>“<span class="nocase">Resampling multilevel models</span>.”</span> In <em>Handbook of Multilevel Analysis</em>, edited by Jan de Leeuw and Erik Meijer, 401–33. New York, NY: Springer.
</div>
<div id="ref-MacKinnon2004" class="csl-entry" role="listitem">
MacKinnon, David P., Chondra M. Lockwood, and Jason Williams. 2004. <span>“<span class="nocase">Confidence limits for the indirect effect: Distribution of the product and resampling Methods</span>.”</span> <em>Multivariate Behavioral Research</em> 39: 99–128. <a href="https://doi.org/10.1207/s15327906mbr3901_4">https://doi.org/10.1207/s15327906mbr3901_4</a>.
</div>
<div id="ref-Miocevic2017" class="csl-entry" role="listitem">
Miočević, Milica, Holly P. O’Rourke, David P. MacKinnon, and Hendricks C Brown. 2017. <span>“<span class="nocase">Statistical properties of four effect-size measures for mediation models</span>.”</span> <em>Behavior Research Methods</em>, March. <a href="https://doi.org/10.3758/s13428-017-0870-1">https://doi.org/10.3758/s13428-017-0870-1</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">Copyright 2023, Hok Chio (Mark) Lai</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>