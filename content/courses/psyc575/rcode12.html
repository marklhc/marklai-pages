---
title: Using R for Week 13
linktitle: R Codes (wk 13)
type: docs
date: "2020-10-28T11:39:00+01:00"
draft: false
lastmod: '2020-10-31'
rmd: "rcodes/week13-samplesize-planning"
menu:
  psyc575:
    parent: Week 13
    weight: 2
output:
  blogdown::html_page:
    toc: true
    df_print: paged
header-includes:
  - \newcommand{\bv}[1]{\boldsymbol{\mathbf{#1}}}
# Prev/next pager order (if `docs_section_pager` enabled in `params.toml`)
weight: 2
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>
<link href="/rmarkdown-libs/pagedtable/css/pagedtable.css" rel="stylesheet" />
<script src="/rmarkdown-libs/pagedtable/js/pagedtable.js"></script>
<link href="/rmarkdown-libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<script src="/rmarkdown-libs/anchor-sections/anchor-sections.js"></script>

<div id="TOC">
<ul>
<li><a href="#load-packages">Load Packages</a></li>
<li><a href="#binary-predictor-at-level-2">Binary Predictor at Level 2</a>
<ul>
<li><a href="#preparing-simulated-data">Preparing simulated data</a></li>
<li><a href="#obtain-simulation-based-power">Obtain simulation-based power</a></li>
</ul></li>
<li><a href="#continuous-predictor-at-level-2">Continuous Predictor at Level 2</a>
<ul>
<li><a href="#preparing-simulated-data-1">Preparing Simulated Data</a></li>
<li><a href="#obtain-simulation-based-power-1">Obtain simulation-based power</a></li>
</ul></li>
<li><a href="#binary-predictor-at-level-2-with-a-continuous-level-1-covariate-and-random-slope">Binary Predictor at Level 2 With a Continuous Level-1 Covariate (and Random Slope)</a>
<ul>
<li><a href="#preparing-simulated-data-2">Preparing Simulated Data</a></li>
<li><a href="#obtain-simulation-based-power-2">Obtain simulation-based power</a></li>
</ul></li>
<li><a href="#growth-modeling">Growth Modeling</a>
<ul>
<li><a href="#preparing-simulated-data-3">Preparing Simulated Data</a></li>
<li><a href="#obtain-simulation-based-power-3">Obtain simulation-based power</a></li>
</ul></li>
</ul>
</div>

{{% rmd-buttons %}}
{{% youtube "mexjG8JYH0o" %}}
{{% youtube "8-CfslHFD2c" %}}
<div id="load-packages" class="section level2">
<h2>Load Packages</h2>
<pre class="r"><code># To install a package, run the following ONCE (and only once on your computer)
# install.packages(&quot;simr&quot;)  
library(tidyverse)
library(lme4)
library(simr)
library(MuMIn)
# (Optional) Set multiple cores in global option
theme_set(theme_bw())  # Theme; just my personal preference</code></pre>
<p>See also an example from the vignette of the <code>simr</code> package: <a href="https://cran.r-project.org/web/packages/simr/vignettes/fromscratch.html" class="uri">https://cran.r-project.org/web/packages/simr/vignettes/fromscratch.html</a></p>
<p>Note: In the examples of this note I used 100 simulation samples only to save
time. In practice, you should use at least 1,000 to obtain a reasonable
precision on the power estimation.</p>
</div>
<div id="binary-predictor-at-level-2" class="section level2">
<h2>Binary Predictor at Level 2</h2>
<p><span class="math display">\[
  \begin{aligned}
    Y_{ij} &amp; = \beta_{0j} + e_{ij} \\
    \beta_{0j} &amp; = \gamma_{00} + {\color{red}{\gamma_{01}}} T_j + u_{0j}
  \end{aligned}
\]</span></p>
<div id="preparing-simulated-data" class="section level3">
<h3>Preparing simulated data</h3>
<p>First, generate the predictor matrix and the cluster ID</p>
<pre class="r"><code># Cluster ID (start with 10 clusters)
num_clus &lt;- 10
id &lt;- 1:num_clus
# Binary lv-2 predictor
treat &lt;- factor(c(&quot;c&quot;, &quot;t&quot;))
# Level-2 data
lv2_dat &lt;- tibble(id, treat = rep_len(treat, length.out = num_clus))
# Cluster size
clus_size &lt;- 5
# Expand each cluster to include more rows
(sim_dat &lt;- 
    lv2_dat %&gt;% 
    slice(rep(1:n(), each = clus_size)))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["int"],"align":["right"]},{"label":["treat"],"name":[2],"type":["fct"],"align":["left"]}],"data":[{"1":"1","2":"c"},{"1":"1","2":"c"},{"1":"1","2":"c"},{"1":"1","2":"c"},{"1":"1","2":"c"},{"1":"2","2":"t"},{"1":"2","2":"t"},{"1":"2","2":"t"},{"1":"2","2":"t"},{"1":"2","2":"t"},{"1":"3","2":"c"},{"1":"3","2":"c"},{"1":"3","2":"c"},{"1":"3","2":"c"},{"1":"3","2":"c"},{"1":"4","2":"t"},{"1":"4","2":"t"},{"1":"4","2":"t"},{"1":"4","2":"t"},{"1":"4","2":"t"},{"1":"5","2":"c"},{"1":"5","2":"c"},{"1":"5","2":"c"},{"1":"5","2":"c"},{"1":"5","2":"c"},{"1":"6","2":"t"},{"1":"6","2":"t"},{"1":"6","2":"t"},{"1":"6","2":"t"},{"1":"6","2":"t"},{"1":"7","2":"c"},{"1":"7","2":"c"},{"1":"7","2":"c"},{"1":"7","2":"c"},{"1":"7","2":"c"},{"1":"8","2":"t"},{"1":"8","2":"t"},{"1":"8","2":"t"},{"1":"8","2":"t"},{"1":"8","2":"t"},{"1":"9","2":"c"},{"1":"9","2":"c"},{"1":"9","2":"c"},{"1":"9","2":"c"},{"1":"9","2":"c"},{"1":"10","2":"t"},{"1":"10","2":"t"},{"1":"10","2":"t"},{"1":"10","2":"t"},{"1":"10","2":"t"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Then specify the fixed effect coefficients and the random effect variance:</p>
<pre class="r"><code>gams &lt;- c(0, 0.625)  # gamma_00, gamma_01
taus &lt;- matrix(0.25)  # conditional ICC = 0.25 / (1 + 0.25) = 0.2
sigma &lt;- 1  # sigma, usually fixed to be 1.0 for easier scaling</code></pre>
<p>Use <code>simr::makeLmer()</code> to build an artificial <code>lmer</code> object:</p>
<pre class="r"><code>sim_m1 &lt;- makeLmer(y ~ treat + (1 | id), 
                   fixef = gams, VarCorr = taus, sigma = sigma, 
                   data = sim_dat)
# Check R^2
r.squaredGLMM(sim_m1)</code></pre>
<pre><code>&gt;# Warning: &#39;r.squaredGLMM&#39; now calculates a revised statistic. See the help page.</code></pre>
<pre><code>&gt;#             R2m       R2c
&gt;# [1,] 0.07383343 0.2590667</code></pre>
<pre class="r"><code># Cohen&#39;s d
gams[2] / sqrt(taus + sigma^2)</code></pre>
<pre><code>&gt;#          [,1]
&gt;# [1,] 0.559017</code></pre>
</div>
<div id="obtain-simulation-based-power" class="section level3">
<h3>Obtain simulation-based power</h3>
<p>Now, check the power:</p>
<pre class="r"><code>power_m1 &lt;- powerSim(sim_m1, 
                     # number of simulated samples; use a small number for 
                     # trial run
                     nsim = 20,
                     progress = FALSE)  # suppress the progress bar
power_m1</code></pre>
<pre><code>&gt;# Power for predictor &#39;treat&#39;, (95% confidence interval):
&gt;#       40.00% (19.12, 63.95)
&gt;# 
&gt;# Test: Likelihood ratio
&gt;# 
&gt;# Based on 20 simulations, (1 warning, 0 errors)
&gt;# alpha = 0.05, nrow = 50
&gt;# 
&gt;# Time elapsed: 0 h 0 m 1 s</code></pre>
<p>Power was obviously not sufficient as it is far from 80%, so we’ll increase it.</p>
<div id="increasing-number-of-clusters" class="section level4">
<h4>Increasing number of clusters</h4>
<p>Increase to 50 clusters</p>
<pre class="r"><code>sim_m1_50J &lt;- extend(sim_m1, 
                     along = &quot;id&quot;,  # add more levels of `id` (i.e., clusters)
                     n = 50)  # increase to 50 clusters
power_m1_50J &lt;- powerSim(sim_m1_50J, nsim = 20, progress = FALSE)
power_m1_50J</code></pre>
<pre><code>&gt;# Power for predictor &#39;treat&#39;, (95% confidence interval):
&gt;#       90.00% (68.30, 98.77)
&gt;# 
&gt;# Test: Likelihood ratio
&gt;# 
&gt;# Based on 20 simulations, (0 warnings, 0 errors)
&gt;# alpha = 0.05, nrow = 250
&gt;# 
&gt;# Time elapsed: 0 h 0 m 2 s</code></pre>
<p>This looks close to 80%. Let’s try several numbers of clusters (30, 35, 40, 45, 50) with a larger <code>nsim</code>. To my knowledge <code>simr</code> does not directly handle multiple values for number of clusters, so I provided you a handy <code>power_extend()</code> function, and an associated function for plotting the results.</p>
<pre class="r"><code># Wrap to a function
power_extend &lt;- function(fit, along, within, new_size, time_points, ...) {
  if (!missing(time_points)) {
    power_lst &lt;- vector(&quot;list&quot;, length(time_points))
    for (j in seq_along(time_points)) {
      sim_m &lt;- extend(fit, along = along, within = within, 
                      values = (1:time_points[j]) - 1)
      power_lst[[j]] &lt;- powerSim(sim_m, ...)
    }
    setNames(power_lst, time_points)
  } else {
    power_lst &lt;- vector(&quot;list&quot;, length(new_size))
    for (j in seq_along(new_size)) {
      sim_m &lt;- extend(fit, along = along, within = within, n = new_size[j])
      power_lst[[j]] &lt;- powerSim(sim_m, ...)
    }
    setNames(power_lst, new_size)
  }
}
# Compute proportions and CI
powerinterval &lt;- function(object, alpha = object$alpha, level = 0.95, 
                          method = getSimrOption(&quot;binom&quot;), ...) {
    x &lt;- sum(object$pval &lt; alpha, na.rm = TRUE)
    n &lt;- object$n
    if (is.na(x) || is.na(n) || (n == 0)) {
        return(rep(NA, 3))
    }
    binom::binom.confint(x, n, level, method, ...)[c(&quot;mean&quot;, &quot;lower&quot;, &quot;upper&quot;)]
}
# Add a plotting function to get power curve
plot_power_extend &lt;- function(object, target = .80, ...) {
  nsim &lt;- object[[1]]$n
  df &lt;- purrr::map_dfr(object, powerinterval, .id = &quot;n&quot;, ...)
  df$n &lt;- as.integer(df$n)
  ggplot(df, aes(x = n, y = mean, group = 1)) + 
    geom_hline(yintercept = target) + 
    geom_smooth(method = &quot;glm&quot;, 
                formula = cbind(y * nsim, (1 - y) * nsim) ~ x, 
                method.args = list(family = binomial(&quot;probit&quot;))) + 
    geom_pointrange(aes(ymin = lower, ymax = upper)) + 
    labs(y = &quot;power&quot;) + 
    ylim(0, 1)
}</code></pre>
<pre class="r"><code>powers_m1 &lt;- power_extend(sim_m1, along = &quot;id&quot;, 
                          new_size = seq.int(30, to = 50, by = 5), 
                          nsim = 100)</code></pre>
<pre><code>&gt;# Simulating: |                                                                  |Simulating: |=                                                                 |Simulating: |==                                                                |Simulating: |===                                                               |Simulating: |====                                                              |Simulating: |=====                                                             |Simulating: |======                                                            |Simulating: |=======                                                           |Simulating: |========                                                          |Simulating: |=========                                                         |Simulating: |==========                                                        |Simulating: |===========                                                       |Simulating: |============                                                      |Simulating: |=============                                                     |Simulating: |==============                                                    |Simulating: |===============                                                   |Simulating: |================                                                  |Simulating: |=================                                                 |Simulating: |==================                                                |Simulating: |===================                                               |Simulating: |====================                                              |Simulating: |=====================                                             |Simulating: |======================                                            |Simulating: |=======================                                           |Simulating: |========================                                          |Simulating: |=========================                                         |Simulating: |==========================                                        |Simulating: |===========================                                       |Simulating: |============================                                      |Simulating: |=============================                                     |Simulating: |==============================                                    |Simulating: |===============================                                   |Simulating: |================================                                  |Simulating: |=================================                                 |Simulating: |==================================                                |Simulating: |===================================                               |Simulating: |====================================                              |Simulating: |=====================================                             |Simulating: |======================================                            |Simulating: |=======================================                           |Simulating: |========================================                          |Simulating: |=========================================                         |Simulating: |==========================================                        |Simulating: |===========================================                       |Simulating: |============================================                      |Simulating: |=============================================                     |Simulating: |==============================================                    |Simulating: |===============================================                   |Simulating: |================================================                  |Simulating: |=================================================                 |Simulating: |==================================================                |Simulating: |===================================================               |Simulating: |====================================================              |Simulating: |=====================================================             |Simulating: |======================================================            |Simulating: |=======================================================           |Simulating: |========================================================          |Simulating: |=========================================================         |Simulating: |==========================================================        |Simulating: |===========================================================       |Simulating: |============================================================      |Simulating: |=============================================================     |Simulating: |==============================================================    |Simulating: |===============================================================   |Simulating: |================================================================  |Simulating: |================================================================= |Simulating: |==================================================================|Simulating: |                                                                  |Simulating: |=                                                                 |Simulating: |==                                                                |Simulating: |===                                                               |Simulating: |====                                                              |Simulating: |=====                                                             |Simulating: |======                                                            |Simulating: |=======                                                           |Simulating: |========                                                          |Simulating: |=========                                                         |Simulating: |==========                                                        |Simulating: |===========                                                       |Simulating: |============                                                      |Simulating: |=============                                                     |Simulating: |==============                                                    |Simulating: |===============                                                   |Simulating: |================                                                  |Simulating: |=================                                                 |Simulating: |==================                                                |Simulating: |===================                                               |Simulating: |====================                                              |Simulating: |=====================                                             |Simulating: |======================                                            |Simulating: |=======================                                           |Simulating: |========================                                          |Simulating: |=========================                                         |Simulating: |==========================                                        |Simulating: |===========================                                       |Simulating: |============================                                      |Simulating: |=============================                                     |Simulating: |==============================                                    |Simulating: |===============================                                   |Simulating: |================================                                  |Simulating: |=================================                                 |Simulating: |==================================                                |Simulating: |===================================                               |Simulating: |====================================                              |Simulating: |=====================================                             |Simulating: |======================================                            |Simulating: |=======================================                           |Simulating: |========================================                          |Simulating: |=========================================                         |Simulating: |==========================================                        |Simulating: |===========================================                       |Simulating: |============================================                      |Simulating: |=============================================                     |Simulating: |==============================================                    |Simulating: |===============================================                   |Simulating: |================================================                  |Simulating: |=================================================                 |Simulating: |==================================================                |Simulating: |===================================================               |Simulating: |====================================================              |Simulating: |=====================================================             |Simulating: |======================================================            |Simulating: |=======================================================           |Simulating: |========================================================          |Simulating: |=========================================================         |Simulating: |==========================================================        |Simulating: |===========================================================       |Simulating: |============================================================      |Simulating: |=============================================================     |Simulating: |==============================================================    |Simulating: |===============================================================   |Simulating: |================================================================  |Simulating: |================================================================= |Simulating: |==================================================================|Simulating: |                                                                  |Simulating: |=                                                                 |Simulating: |==                                                                |Simulating: |===                                                               |Simulating: |====                                                              |Simulating: |=====                                                             |Simulating: |======                                                            |Simulating: |=======                                                           |Simulating: |========                                                          |Simulating: |=========                                                         |Simulating: |==========                                                        |Simulating: |===========                                                       |Simulating: |============                                                      |Simulating: |=============                                                     |Simulating: |==============                                                    |Simulating: |===============                                                   |Simulating: |================                                                  |Simulating: |=================                                                 |Simulating: |==================                                                |Simulating: |===================                                               |Simulating: |====================                                              |Simulating: |=====================                                             |Simulating: |======================                                            |Simulating: |=======================                                           |Simulating: |========================                                          |Simulating: |=========================                                         |Simulating: |==========================                                        |Simulating: |===========================                                       |Simulating: |============================                                      |Simulating: |=============================                                     |Simulating: |==============================                                    |Simulating: |===============================                                   |Simulating: |================================                                  |Simulating: |=================================                                 |Simulating: |==================================                                |Simulating: |===================================                               |Simulating: |====================================                              |Simulating: |=====================================                             |Simulating: |======================================                            |Simulating: |=======================================                           |Simulating: |========================================                          |Simulating: |=========================================                         |Simulating: |==========================================                        |Simulating: |===========================================                       |Simulating: |============================================                      |Simulating: |=============================================                     |Simulating: |==============================================                    |Simulating: |===============================================                   |Simulating: |================================================                  |Simulating: |=================================================                 |Simulating: |==================================================                |Simulating: |===================================================               |Simulating: |====================================================              |Simulating: |=====================================================             |Simulating: |======================================================            |Simulating: |=======================================================           |Simulating: |========================================================          |Simulating: |=========================================================         |Simulating: |==========================================================        |Simulating: |===========================================================       |Simulating: |============================================================      |Simulating: |=============================================================     |Simulating: |==============================================================    |Simulating: |===============================================================   |Simulating: |================================================================  |Simulating: |================================================================= |Simulating: |==================================================================|Simulating: |                                                                  |Simulating: |=                                                                 |Simulating: |==                                                                |Simulating: |===                                                               |Simulating: |====                                                              |Simulating: |=====                                                             |Simulating: |======                                                            |Simulating: |=======                                                           |Simulating: |========                                                          |Simulating: |=========                                                         |Simulating: |==========                                                        |Simulating: |===========                                                       |Simulating: |============                                                      |Simulating: |=============                                                     |Simulating: |==============                                                    |Simulating: |===============                                                   |Simulating: |================                                                  |Simulating: |=================                                                 |Simulating: |==================                                                |Simulating: |===================                                               |Simulating: |====================                                              |Simulating: |=====================                                             |Simulating: |======================                                            |Simulating: |=======================                                           |Simulating: |========================                                          |Simulating: |=========================                                         |Simulating: |==========================                                        |Simulating: |===========================                                       |Simulating: |============================                                      |Simulating: |=============================                                     |Simulating: |==============================                                    |Simulating: |===============================                                   |Simulating: |================================                                  |Simulating: |=================================                                 |Simulating: |==================================                                |Simulating: |===================================                               |Simulating: |====================================                              |Simulating: |=====================================                             |Simulating: |======================================                            |Simulating: |=======================================                           |Simulating: |========================================                          |Simulating: |=========================================                         |Simulating: |==========================================                        |Simulating: |===========================================                       |Simulating: |============================================                      |Simulating: |=============================================                     |Simulating: |==============================================                    |Simulating: |===============================================                   |Simulating: |================================================                  |Simulating: |=================================================                 |Simulating: |==================================================                |Simulating: |===================================================               |Simulating: |====================================================              |Simulating: |=====================================================             |Simulating: |======================================================            |Simulating: |=======================================================           |Simulating: |========================================================          |Simulating: |=========================================================         |Simulating: |==========================================================        |Simulating: |===========================================================       |Simulating: |============================================================      |Simulating: |=============================================================     |Simulating: |==============================================================    |Simulating: |===============================================================   |Simulating: |================================================================  |Simulating: |================================================================= |Simulating: |==================================================================|Simulating: |                                                                  |Simulating: |=                                                                 |Simulating: |==                                                                |Simulating: |===                                                               |Simulating: |====                                                              |Simulating: |=====                                                             |Simulating: |======                                                            |Simulating: |=======                                                           |Simulating: |========                                                          |Simulating: |=========                                                         |Simulating: |==========                                                        |Simulating: |===========                                                       |Simulating: |============                                                      |Simulating: |=============                                                     |Simulating: |==============                                                    |Simulating: |===============                                                   |Simulating: |================                                                  |Simulating: |=================                                                 |Simulating: |==================                                                |Simulating: |===================                                               |Simulating: |====================                                              |Simulating: |=====================                                             |Simulating: |======================                                            |Simulating: |=======================                                           |Simulating: |========================                                          |Simulating: |=========================                                         |Simulating: |==========================                                        |Simulating: |===========================                                       |Simulating: |============================                                      |Simulating: |=============================                                     |Simulating: |==============================                                    |Simulating: |===============================                                   |Simulating: |================================                                  |Simulating: |=================================                                 |Simulating: |==================================                                |Simulating: |===================================                               |Simulating: |====================================                              |Simulating: |=====================================                             |Simulating: |======================================                            |Simulating: |=======================================                           |Simulating: |========================================                          |Simulating: |=========================================                         |Simulating: |==========================================                        |Simulating: |===========================================                       |Simulating: |============================================                      |Simulating: |=============================================                     |Simulating: |==============================================                    |Simulating: |===============================================                   |Simulating: |================================================                  |Simulating: |=================================================                 |Simulating: |==================================================                |Simulating: |===================================================               |Simulating: |====================================================              |Simulating: |=====================================================             |Simulating: |======================================================            |Simulating: |=======================================================           |Simulating: |========================================================          |Simulating: |=========================================================         |Simulating: |==========================================================        |Simulating: |===========================================================       |Simulating: |============================================================      |Simulating: |=============================================================     |Simulating: |==============================================================    |Simulating: |===============================================================   |Simulating: |================================================================  |Simulating: |================================================================= |Simulating: |==================================================================|</code></pre>
<pre class="r"><code># Plot
plot_power_extend(powers_m1)</code></pre>
<p><img src="/courses/psyc575/rcode12_files/figure-html/powers_m1-1.png" width="672" /></p>
<p>This suggests that about 40 clusters are needed, if each cluster contains 5 observations.</p>
</div>
<div id="increasing-cluster-size" class="section level4">
<h4>Increasing cluster size</h4>
<p>Instead of increasing the number of cluster, one can also increase the cluster
size:</p>
<pre class="r"><code>sim_m1_25n &lt;- extend(sim_m1, 
                     # need to specify the combination of id and lv-2 predictors
                     within = &quot;id + treat&quot;,
                     n = 25)  # cluster size
power_m1_25n &lt;- powerSim(sim_m1_25n, nsim = 100, progress = FALSE)
power_m1_25n</code></pre>
<pre><code>&gt;# Power for predictor &#39;treat&#39;, (95% confidence interval):
&gt;#       47.00% (36.94, 57.24)
&gt;# 
&gt;# Test: Likelihood ratio
&gt;# 
&gt;# Based on 100 simulations, (0 warnings, 0 errors)
&gt;# alpha = 0.05, nrow = 250
&gt;# 
&gt;# Time elapsed: 0 h 0 m 8 s</code></pre>
<p>Note that the power of increasing cluster size by 5 times is much smaller than
that of increasing number of clusters by 5 times. Here is the power curve:</p>
<pre class="r"><code># Use the previously defined function
powers_m1 &lt;- power_extend(sim_m1, within = &quot;id + treat&quot;, 
                          new_size = c(5, 10, 25, 50), 
                          nsim = 100)</code></pre>
<pre><code>&gt;# Simulating: |                                                                  |Simulating: |=                                                                 |Simulating: |==                                                                |Simulating: |===                                                               |Simulating: |====                                                              |Simulating: |=====                                                             |Simulating: |======                                                            |Simulating: |=======                                                           |Simulating: |========                                                          |Simulating: |=========                                                         |Simulating: |==========                                                        |Simulating: |===========                                                       |Simulating: |============                                                      |Simulating: |=============                                                     |Simulating: |==============                                                    |Simulating: |===============                                                   |Simulating: |================                                                  |Simulating: |=================                                                 |Simulating: |==================                                                |Simulating: |===================                                               |Simulating: |====================                                              |Simulating: |=====================                                             |Simulating: |======================                                            |Simulating: |=======================                                           |Simulating: |========================                                          |Simulating: |=========================                                         |Simulating: |==========================                                        |Simulating: |===========================                                       |Simulating: |============================                                      |Simulating: |=============================                                     |Simulating: |==============================                                    |Simulating: |===============================                                   |Simulating: |================================                                  |Simulating: |=================================                                 |Simulating: |==================================                                |Simulating: |===================================                               |Simulating: |====================================                              |Simulating: |=====================================                             |Simulating: |======================================                            |Simulating: |=======================================                           |Simulating: |========================================                          |Simulating: |=========================================                         |Simulating: |==========================================                        |Simulating: |===========================================                       |Simulating: |============================================                      |Simulating: |=============================================                     |Simulating: |==============================================                    |Simulating: |===============================================                   |Simulating: |================================================                  |Simulating: |=================================================                 |Simulating: |==================================================                |Simulating: |===================================================               |Simulating: |====================================================              |Simulating: |=====================================================             |Simulating: |======================================================            |Simulating: |=======================================================           |Simulating: |========================================================          |Simulating: |=========================================================         |Simulating: |==========================================================        |Simulating: |===========================================================       |Simulating: |============================================================      |Simulating: |=============================================================     |Simulating: |==============================================================    |Simulating: |===============================================================   |Simulating: |================================================================  |Simulating: |================================================================= |Simulating: |==================================================================|Simulating: |                                                                  |Simulating: |=                                                                 |Simulating: |==                                                                |Simulating: |===                                                               |Simulating: |====                                                              |Simulating: |=====                                                             |Simulating: |======                                                            |Simulating: |=======                                                           |Simulating: |========                                                          |Simulating: |=========                                                         |Simulating: |==========                                                        |Simulating: |===========                                                       |Simulating: |============                                                      |Simulating: |=============                                                     |Simulating: |==============                                                    |Simulating: |===============                                                   |Simulating: |================                                                  |Simulating: |=================                                                 |Simulating: |==================                                                |Simulating: |===================                                               |Simulating: |====================                                              |Simulating: |=====================                                             |Simulating: |======================                                            |Simulating: |=======================                                           |Simulating: |========================                                          |Simulating: |=========================                                         |Simulating: |==========================                                        |Simulating: |===========================                                       |Simulating: |============================                                      |Simulating: |=============================                                     |Simulating: |==============================                                    |Simulating: |===============================                                   |Simulating: |================================                                  |Simulating: |=================================                                 |Simulating: |==================================                                |Simulating: |===================================                               |Simulating: |====================================                              |Simulating: |=====================================                             |Simulating: |======================================                            |Simulating: |=======================================                           |Simulating: |========================================                          |Simulating: |=========================================                         |Simulating: |==========================================                        |Simulating: |===========================================                       |Simulating: |============================================                      |Simulating: |=============================================                     |Simulating: |==============================================                    |Simulating: |===============================================                   |Simulating: |================================================                  |Simulating: |=================================================                 |Simulating: |==================================================                |Simulating: |===================================================               |Simulating: |====================================================              |Simulating: |=====================================================             |Simulating: |======================================================            |Simulating: |=======================================================           |Simulating: |========================================================          |Simulating: |=========================================================         |Simulating: |==========================================================        |Simulating: |===========================================================       |Simulating: |============================================================      |Simulating: |=============================================================     |Simulating: |==============================================================    |Simulating: |===============================================================   |Simulating: |================================================================  |Simulating: |================================================================= |Simulating: |==================================================================|Simulating: |                                                                  |Simulating: |=                                                                 |Simulating: |==                                                                |Simulating: |===                                                               |Simulating: |====                                                              |Simulating: |=====                                                             |Simulating: |======                                                            |Simulating: |=======                                                           |Simulating: |========                                                          |Simulating: |=========                                                         |Simulating: |==========                                                        |Simulating: |===========                                                       |Simulating: |============                                                      |Simulating: |=============                                                     |Simulating: |==============                                                    |Simulating: |===============                                                   |Simulating: |================                                                  |Simulating: |=================                                                 |Simulating: |==================                                                |Simulating: |===================                                               |Simulating: |====================                                              |Simulating: |=====================                                             |Simulating: |======================                                            |Simulating: |=======================                                           |Simulating: |========================                                          |Simulating: |=========================                                         |Simulating: |==========================                                        |Simulating: |===========================                                       |Simulating: |============================                                      |Simulating: |=============================                                     |Simulating: |==============================                                    |Simulating: |===============================                                   |Simulating: |================================                                  |Simulating: |=================================                                 |Simulating: |==================================                                |Simulating: |===================================                               |Simulating: |====================================                              |Simulating: |=====================================                             |Simulating: |======================================                            |Simulating: |=======================================                           |Simulating: |========================================                          |Simulating: |=========================================                         |Simulating: |==========================================                        |Simulating: |===========================================                       |Simulating: |============================================                      |Simulating: |=============================================                     |Simulating: |==============================================                    |Simulating: |===============================================                   |Simulating: |================================================                  |Simulating: |=================================================                 |Simulating: |==================================================                |Simulating: |===================================================               |Simulating: |====================================================              |Simulating: |=====================================================             |Simulating: |======================================================            |Simulating: |=======================================================           |Simulating: |========================================================          |Simulating: |=========================================================         |Simulating: |==========================================================        |Simulating: |===========================================================       |Simulating: |============================================================      |Simulating: |=============================================================     |Simulating: |==============================================================    |Simulating: |===============================================================   |Simulating: |================================================================  |Simulating: |================================================================= |Simulating: |==================================================================|Simulating: |                                                                  |Simulating: |=                                                                 |Simulating: |==                                                                |Simulating: |===                                                               |Simulating: |====                                                              |Simulating: |=====                                                             |Simulating: |======                                                            |Simulating: |=======                                                           |Simulating: |========                                                          |Simulating: |=========                                                         |Simulating: |==========                                                        |Simulating: |===========                                                       |Simulating: |============                                                      |Simulating: |=============                                                     |Simulating: |==============                                                    |Simulating: |===============                                                   |Simulating: |================                                                  |Simulating: |=================                                                 |Simulating: |==================                                                |Simulating: |===================                                               |Simulating: |====================                                              |Simulating: |=====================                                             |Simulating: |======================                                            |Simulating: |=======================                                           |Simulating: |========================                                          |Simulating: |=========================                                         |Simulating: |==========================                                        |Simulating: |===========================                                       |Simulating: |============================                                      |Simulating: |=============================                                     |Simulating: |==============================                                    |Simulating: |===============================                                   |Simulating: |================================                                  |Simulating: |=================================                                 |Simulating: |==================================                                |Simulating: |===================================                               |Simulating: |====================================                              |Simulating: |=====================================                             |Simulating: |======================================                            |Simulating: |=======================================                           |Simulating: |========================================                          |Simulating: |=========================================                         |Simulating: |==========================================                        |Simulating: |===========================================                       |Simulating: |============================================                      |Simulating: |=============================================                     |Simulating: |==============================================                    |Simulating: |===============================================                   |Simulating: |================================================                  |Simulating: |=================================================                 |Simulating: |==================================================                |Simulating: |===================================================               |Simulating: |====================================================              |Simulating: |=====================================================             |Simulating: |======================================================            |Simulating: |=======================================================           |Simulating: |========================================================          |Simulating: |=========================================================         |Simulating: |==========================================================        |Simulating: |===========================================================       |Simulating: |============================================================      |Simulating: |=============================================================     |Simulating: |==============================================================    |Simulating: |===============================================================   |Simulating: |================================================================  |Simulating: |================================================================= |Simulating: |==================================================================|</code></pre>
<pre class="r"><code>plot_power_extend(powers_m1)</code></pre>
<p><img src="/courses/psyc575/rcode12_files/figure-html/powers_m1-2-1.png" width="672" /></p>
<p>In this case, increasing the cluster size only increases the power to close to 50%. There is an upper limit in power improvement with increasing the cluster size, when the number of cluster is kept constant.</p>
</div>
</div>
</div>
<div id="continuous-predictor-at-level-2" class="section level2">
<h2>Continuous Predictor at Level 2</h2>
<p><span class="math display">\[
  \begin{aligned}
    Y_{ij} &amp; = \beta_{0j} + e_{ij} \\
    \beta_{0j} &amp; = \gamma_{00} + {\color{red}{\gamma_{01}}} W_j + u_{0j}
  \end{aligned}
\]</span></p>
<div id="preparing-simulated-data-1" class="section level3">
<h3>Preparing Simulated Data</h3>
<p>First, generate the predictor matrix and the cluster ID</p>
<pre class="r"><code># Cluster ID (start with 10 clusters)
num_clus &lt;- 10
id &lt;- 1:num_clus
# Binary lv-2 predictor
w &lt;- rnorm(num_clus)
# Force SD = 1
w &lt;- (w - mean(w)) / sd(w) * (num_clus - 1) / num_clus
# Level-2 data
lv2_dat &lt;- tibble(id, w = w)
# Cluster size
clus_size &lt;- 5
# Expand each cluster to include more rows
(sim_dat &lt;- 
    lv2_dat %&gt;% 
    slice(rep(1:n(), each = clus_size)))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["int"],"align":["right"]},{"label":["w"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"1.34492008"},{"1":"1","2":"1.34492008"},{"1":"1","2":"1.34492008"},{"1":"1","2":"1.34492008"},{"1":"1","2":"1.34492008"},{"1":"2","2":"-0.73474606"},{"1":"2","2":"-0.73474606"},{"1":"2","2":"-0.73474606"},{"1":"2","2":"-0.73474606"},{"1":"2","2":"-0.73474606"},{"1":"3","2":"-0.38053972"},{"1":"3","2":"-0.38053972"},{"1":"3","2":"-0.38053972"},{"1":"3","2":"-0.38053972"},{"1":"3","2":"-0.38053972"},{"1":"4","2":"0.80865488"},{"1":"4","2":"0.80865488"},{"1":"4","2":"0.80865488"},{"1":"4","2":"0.80865488"},{"1":"4","2":"0.80865488"},{"1":"5","2":"-1.77259075"},{"1":"5","2":"-1.77259075"},{"1":"5","2":"-1.77259075"},{"1":"5","2":"-1.77259075"},{"1":"5","2":"-1.77259075"},{"1":"6","2":"0.01644753"},{"1":"6","2":"0.01644753"},{"1":"6","2":"0.01644753"},{"1":"6","2":"0.01644753"},{"1":"6","2":"0.01644753"},{"1":"7","2":"0.56086006"},{"1":"7","2":"0.56086006"},{"1":"7","2":"0.56086006"},{"1":"7","2":"0.56086006"},{"1":"7","2":"0.56086006"},{"1":"8","2":"0.58894251"},{"1":"8","2":"0.58894251"},{"1":"8","2":"0.58894251"},{"1":"8","2":"0.58894251"},{"1":"8","2":"0.58894251"},{"1":"9","2":"-0.56636654"},{"1":"9","2":"-0.56636654"},{"1":"9","2":"-0.56636654"},{"1":"9","2":"-0.56636654"},{"1":"9","2":"-0.56636654"},{"1":"10","2":"0.13441802"},{"1":"10","2":"0.13441802"},{"1":"10","2":"0.13441802"},{"1":"10","2":"0.13441802"},{"1":"10","2":"0.13441802"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Then specify the fixed effect coefficients and the random effect variance:</p>
<pre class="r"><code>gams &lt;- c(1, 0.3)  # gamma_00, gamma_01
taus &lt;- matrix(0.5)  # conditional ICC = 0.5 / (1 + 0.5) = 0.33
sigma &lt;- 1  # sigma, usually fixed to be 1.0 for easier scaling</code></pre>
<p>Use <code>simr::makeLmer()</code> to build an artificial <code>lmer</code> object:</p>
<pre class="r"><code>sim_m2 &lt;- makeLmer(y ~ w + (1 | id), 
                   fixef = gams, VarCorr = taus, sigma = sigma, 
                   data = sim_dat)
# Check R^2
r.squaredGLMM(sim_m2)</code></pre>
<pre><code>&gt;#             R2m       R2c
&gt;# [1,] 0.04272569 0.3618171</code></pre>
</div>
<div id="obtain-simulation-based-power-1" class="section level3">
<h3>Obtain simulation-based power</h3>
<p>Use various numbers of clusters</p>
<pre class="r"><code># Use it on our example:
powers_m2 &lt;- power_extend(sim_m2, along = &quot;id&quot;, 
                          new_size = c(10, 20, 50, 100), 
                          nsim = 100)</code></pre>
<pre><code>&gt;# Simulating: |                                                                  |Simulating: |=                                                                 |Simulating: |==                                                                |Simulating: |===                                                               |Simulating: |====                                                              |Simulating: |=====                                                             |Simulating: |======                                                            |Simulating: |=======                                                           |Simulating: |========                                                          |Simulating: |=========                                                         |Simulating: |==========                                                        |Simulating: |===========                                                       |Simulating: |============                                                      |Simulating: |=============                                                     |Simulating: |==============                                                    |Simulating: |===============                                                   |Simulating: |================                                                  |Simulating: |=================                                                 |Simulating: |==================                                                |Simulating: |===================                                               |Simulating: |====================                                              |Simulating: |=====================                                             |Simulating: |======================                                            |Simulating: |=======================                                           |Simulating: |========================                                          |Simulating: |=========================                                         |Simulating: |==========================                                        |Simulating: |===========================                                       |Simulating: |============================                                      |Simulating: |=============================                                     |Simulating: |==============================                                    |Simulating: |===============================                                   |Simulating: |================================                                  |Simulating: |=================================                                 |Simulating: |==================================                                |Simulating: |===================================                               |Simulating: |====================================                              |Simulating: |=====================================                             |Simulating: |======================================                            |Simulating: |=======================================                           |Simulating: |========================================                          |Simulating: |=========================================                         |Simulating: |==========================================                        |Simulating: |===========================================                       |Simulating: |============================================                      |Simulating: |=============================================                     |Simulating: |==============================================                    |Simulating: |===============================================                   |Simulating: |================================================                  |Simulating: |=================================================                 |Simulating: |==================================================                |Simulating: |===================================================               |Simulating: |====================================================              |Simulating: |=====================================================             |Simulating: |======================================================            |Simulating: |=======================================================           |Simulating: |========================================================          |Simulating: |=========================================================         |Simulating: |==========================================================        |Simulating: |===========================================================       |Simulating: |============================================================      |Simulating: |=============================================================     |Simulating: |==============================================================    |Simulating: |===============================================================   |Simulating: |================================================================  |Simulating: |================================================================= |Simulating: |==================================================================|Simulating: |                                                                  |Simulating: |=                                                                 |Simulating: |==                                                                |Simulating: |===                                                               |Simulating: |====                                                              |Simulating: |=====                                                             |Simulating: |======                                                            |Simulating: |=======                                                           |Simulating: |========                                                          |Simulating: |=========                                                         |Simulating: |==========                                                        |Simulating: |===========                                                       |Simulating: |============                                                      |Simulating: |=============                                                     |Simulating: |==============                                                    |Simulating: |===============                                                   |Simulating: |================                                                  |Simulating: |=================                                                 |Simulating: |==================                                                |Simulating: |===================                                               |Simulating: |====================                                              |Simulating: |=====================                                             |Simulating: |======================                                            |Simulating: |=======================                                           |Simulating: |========================                                          |Simulating: |=========================                                         |Simulating: |==========================                                        |Simulating: |===========================                                       |Simulating: |============================                                      |Simulating: |=============================                                     |Simulating: |==============================                                    |Simulating: |===============================                                   |Simulating: |================================                                  |Simulating: |=================================                                 |Simulating: |==================================                                |Simulating: |===================================                               |Simulating: |====================================                              |Simulating: |=====================================                             |Simulating: |======================================                            |Simulating: |=======================================                           |Simulating: |========================================                          |Simulating: |=========================================                         |Simulating: |==========================================                        |Simulating: |===========================================                       |Simulating: |============================================                      |Simulating: |=============================================                     |Simulating: |==============================================                    |Simulating: |===============================================                   |Simulating: |================================================                  |Simulating: |=================================================                 |Simulating: |==================================================                |Simulating: |===================================================               |Simulating: |====================================================              |Simulating: |=====================================================             |Simulating: |======================================================            |Simulating: |=======================================================           |Simulating: |========================================================          |Simulating: |=========================================================         |Simulating: |==========================================================        |Simulating: |===========================================================       |Simulating: |============================================================      |Simulating: |=============================================================     |Simulating: |==============================================================    |Simulating: |===============================================================   |Simulating: |================================================================  |Simulating: |================================================================= |Simulating: |==================================================================|Simulating: |                                                                  |Simulating: |=                                                                 |Simulating: |==                                                                |Simulating: |===                                                               |Simulating: |====                                                              |Simulating: |=====                                                             |Simulating: |======                                                            |Simulating: |=======                                                           |Simulating: |========                                                          |Simulating: |=========                                                         |Simulating: |==========                                                        |Simulating: |===========                                                       |Simulating: |============                                                      |Simulating: |=============                                                     |Simulating: |==============                                                    |Simulating: |===============                                                   |Simulating: |================                                                  |Simulating: |=================                                                 |Simulating: |==================                                                |Simulating: |===================                                               |Simulating: |====================                                              |Simulating: |=====================                                             |Simulating: |======================                                            |Simulating: |=======================                                           |Simulating: |========================                                          |Simulating: |=========================                                         |Simulating: |==========================                                        |Simulating: |===========================                                       |Simulating: |============================                                      |Simulating: |=============================                                     |Simulating: |==============================                                    |Simulating: |===============================                                   |Simulating: |================================                                  |Simulating: |=================================                                 |Simulating: |==================================                                |Simulating: |===================================                               |Simulating: |====================================                              |Simulating: |=====================================                             |Simulating: |======================================                            |Simulating: |=======================================                           |Simulating: |========================================                          |Simulating: |=========================================                         |Simulating: |==========================================                        |Simulating: |===========================================                       |Simulating: |============================================                      |Simulating: |=============================================                     |Simulating: |==============================================                    |Simulating: |===============================================                   |Simulating: |================================================                  |Simulating: |=================================================                 |Simulating: |==================================================                |Simulating: |===================================================               |Simulating: |====================================================              |Simulating: |=====================================================             |Simulating: |======================================================            |Simulating: |=======================================================           |Simulating: |========================================================          |Simulating: |=========================================================         |Simulating: |==========================================================        |Simulating: |===========================================================       |Simulating: |============================================================      |Simulating: |=============================================================     |Simulating: |==============================================================    |Simulating: |===============================================================   |Simulating: |================================================================  |Simulating: |================================================================= |Simulating: |==================================================================|Simulating: |                                                                  |Simulating: |=                                                                 |Simulating: |==                                                                |Simulating: |===                                                               |Simulating: |====                                                              |Simulating: |=====                                                             |Simulating: |======                                                            |Simulating: |=======                                                           |Simulating: |========                                                          |Simulating: |=========                                                         |Simulating: |==========                                                        |Simulating: |===========                                                       |Simulating: |============                                                      |Simulating: |=============                                                     |Simulating: |==============                                                    |Simulating: |===============                                                   |Simulating: |================                                                  |Simulating: |=================                                                 |Simulating: |==================                                                |Simulating: |===================                                               |Simulating: |====================                                              |Simulating: |=====================                                             |Simulating: |======================                                            |Simulating: |=======================                                           |Simulating: |========================                                          |Simulating: |=========================                                         |Simulating: |==========================                                        |Simulating: |===========================                                       |Simulating: |============================                                      |Simulating: |=============================                                     |Simulating: |==============================                                    |Simulating: |===============================                                   |Simulating: |================================                                  |Simulating: |=================================                                 |Simulating: |==================================                                |Simulating: |===================================                               |Simulating: |====================================                              |Simulating: |=====================================                             |Simulating: |======================================                            |Simulating: |=======================================                           |Simulating: |========================================                          |Simulating: |=========================================                         |Simulating: |==========================================                        |Simulating: |===========================================                       |Simulating: |============================================                      |Simulating: |=============================================                     |Simulating: |==============================================                    |Simulating: |===============================================                   |Simulating: |================================================                  |Simulating: |=================================================                 |Simulating: |==================================================                |Simulating: |===================================================               |Simulating: |====================================================              |Simulating: |=====================================================             |Simulating: |======================================================            |Simulating: |=======================================================           |Simulating: |========================================================          |Simulating: |=========================================================         |Simulating: |==========================================================        |Simulating: |===========================================================       |Simulating: |============================================================      |Simulating: |=============================================================     |Simulating: |==============================================================    |Simulating: |===============================================================   |Simulating: |================================================================  |Simulating: |================================================================= |Simulating: |==================================================================|</code></pre>
<pre class="r"><code>plot_power_extend(powers_m2)</code></pre>
<p><img src="/courses/psyc575/rcode12_files/figure-html/powers_m2-1.png" width="672" /></p>
<p>Use various cluster sizes</p>
<pre class="r"><code># Use it on our example:
powers_m2 &lt;- power_extend(sim_m2, 
                          within = &quot;id + w&quot;, 
                          new_size = c(5, 10, 25, 50), 
                          nsim = 100)</code></pre>
<pre><code>&gt;# Simulating: |                                                                  |Simulating: |=                                                                 |Simulating: |==                                                                |Simulating: |===                                                               |Simulating: |====                                                              |Simulating: |=====                                                             |Simulating: |======                                                            |Simulating: |=======                                                           |Simulating: |========                                                          |Simulating: |=========                                                         |Simulating: |==========                                                        |Simulating: |===========                                                       |Simulating: |============                                                      |Simulating: |=============                                                     |Simulating: |==============                                                    |Simulating: |===============                                                   |Simulating: |================                                                  |Simulating: |=================                                                 |Simulating: |==================                                                |Simulating: |===================                                               |Simulating: |====================                                              |Simulating: |=====================                                             |Simulating: |======================                                            |Simulating: |=======================                                           |Simulating: |========================                                          |Simulating: |=========================                                         |Simulating: |==========================                                        |Simulating: |===========================                                       |Simulating: |============================                                      |Simulating: |=============================                                     |Simulating: |==============================                                    |Simulating: |===============================                                   |Simulating: |================================                                  |Simulating: |=================================                                 |Simulating: |==================================                                |Simulating: |===================================                               |Simulating: |====================================                              |Simulating: |=====================================                             |Simulating: |======================================                            |Simulating: |=======================================                           |Simulating: |========================================                          |Simulating: |=========================================                         |Simulating: |==========================================                        |Simulating: |===========================================                       |Simulating: |============================================                      |Simulating: |=============================================                     |Simulating: |==============================================                    |Simulating: |===============================================                   |Simulating: |================================================                  |Simulating: |=================================================                 |Simulating: |==================================================                |Simulating: |===================================================               |Simulating: |====================================================              |Simulating: |=====================================================             |Simulating: |======================================================            |Simulating: |=======================================================           |Simulating: |========================================================          |Simulating: |=========================================================         |Simulating: |==========================================================        |Simulating: |===========================================================       |Simulating: |============================================================      |Simulating: |=============================================================     |Simulating: |==============================================================    |Simulating: |===============================================================   |Simulating: |================================================================  |Simulating: |================================================================= |Simulating: |==================================================================|Simulating: |                                                                  |Simulating: |=                                                                 |Simulating: |==                                                                |Simulating: |===                                                               |Simulating: |====                                                              |Simulating: |=====                                                             |Simulating: |======                                                            |Simulating: |=======                                                           |Simulating: |========                                                          |Simulating: |=========                                                         |Simulating: |==========                                                        |Simulating: |===========                                                       |Simulating: |============                                                      |Simulating: |=============                                                     |Simulating: |==============                                                    |Simulating: |===============                                                   |Simulating: |================                                                  |Simulating: |=================                                                 |Simulating: |==================                                                |Simulating: |===================                                               |Simulating: |====================                                              |Simulating: |=====================                                             |Simulating: |======================                                            |Simulating: |=======================                                           |Simulating: |========================                                          |Simulating: |=========================                                         |Simulating: |==========================                                        |Simulating: |===========================                                       |Simulating: |============================                                      |Simulating: |=============================                                     |Simulating: |==============================                                    |Simulating: |===============================                                   |Simulating: |================================                                  |Simulating: |=================================                                 |Simulating: |==================================                                |Simulating: |===================================                               |Simulating: |====================================                              |Simulating: |=====================================                             |Simulating: |======================================                            |Simulating: |=======================================                           |Simulating: |========================================                          |Simulating: |=========================================                         |Simulating: |==========================================                        |Simulating: |===========================================                       |Simulating: |============================================                      |Simulating: |=============================================                     |Simulating: |==============================================                    |Simulating: |===============================================                   |Simulating: |================================================                  |Simulating: |=================================================                 |Simulating: |==================================================                |Simulating: |===================================================               |Simulating: |====================================================              |Simulating: |=====================================================             |Simulating: |======================================================            |Simulating: |=======================================================           |Simulating: |========================================================          |Simulating: |=========================================================         |Simulating: |==========================================================        |Simulating: |===========================================================       |Simulating: |============================================================      |Simulating: |=============================================================     |Simulating: |==============================================================    |Simulating: |===============================================================   |Simulating: |================================================================  |Simulating: |================================================================= |Simulating: |==================================================================|Simulating: |                                                                  |Simulating: |=                                                                 |Simulating: |==                                                                |Simulating: |===                                                               |Simulating: |====                                                              |Simulating: |=====                                                             |Simulating: |======                                                            |Simulating: |=======                                                           |Simulating: |========                                                          |Simulating: |=========                                                         |Simulating: |==========                                                        |Simulating: |===========                                                       |Simulating: |============                                                      |Simulating: |=============                                                     |Simulating: |==============                                                    |Simulating: |===============                                                   |Simulating: |================                                                  |Simulating: |=================                                                 |Simulating: |==================                                                |Simulating: |===================                                               |Simulating: |====================                                              |Simulating: |=====================                                             |Simulating: |======================                                            |Simulating: |=======================                                           |Simulating: |========================                                          |Simulating: |=========================                                         |Simulating: |==========================                                        |Simulating: |===========================                                       |Simulating: |============================                                      |Simulating: |=============================                                     |Simulating: |==============================                                    |Simulating: |===============================                                   |Simulating: |================================                                  |Simulating: |=================================                                 |Simulating: |==================================                                |Simulating: |===================================                               |Simulating: |====================================                              |Simulating: |=====================================                             |Simulating: |======================================                            |Simulating: |=======================================                           |Simulating: |========================================                          |Simulating: |=========================================                         |Simulating: |==========================================                        |Simulating: |===========================================                       |Simulating: |============================================                      |Simulating: |=============================================                     |Simulating: |==============================================                    |Simulating: |===============================================                   |Simulating: |================================================                  |Simulating: |=================================================                 |Simulating: |==================================================                |Simulating: |===================================================               |Simulating: |====================================================              |Simulating: |=====================================================             |Simulating: |======================================================            |Simulating: |=======================================================           |Simulating: |========================================================          |Simulating: |=========================================================         |Simulating: |==========================================================        |Simulating: |===========================================================       |Simulating: |============================================================      |Simulating: |=============================================================     |Simulating: |==============================================================    |Simulating: |===============================================================   |Simulating: |================================================================  |Simulating: |================================================================= |Simulating: |==================================================================|Simulating: |                                                                  |Simulating: |=                                                                 |Simulating: |==                                                                |Simulating: |===                                                               |Simulating: |====                                                              |Simulating: |=====                                                             |Simulating: |======                                                            |Simulating: |=======                                                           |Simulating: |========                                                          |Simulating: |=========                                                         |Simulating: |==========                                                        |Simulating: |===========                                                       |Simulating: |============                                                      |Simulating: |=============                                                     |Simulating: |==============                                                    |Simulating: |===============                                                   |Simulating: |================                                                  |Simulating: |=================                                                 |Simulating: |==================                                                |Simulating: |===================                                               |Simulating: |====================                                              |Simulating: |=====================                                             |Simulating: |======================                                            |Simulating: |=======================                                           |Simulating: |========================                                          |Simulating: |=========================                                         |Simulating: |==========================                                        |Simulating: |===========================                                       |Simulating: |============================                                      |Simulating: |=============================                                     |Simulating: |==============================                                    |Simulating: |===============================                                   |Simulating: |================================                                  |Simulating: |=================================                                 |Simulating: |==================================                                |Simulating: |===================================                               |Simulating: |====================================                              |Simulating: |=====================================                             |Simulating: |======================================                            |Simulating: |=======================================                           |Simulating: |========================================                          |Simulating: |=========================================                         |Simulating: |==========================================                        |Simulating: |===========================================                       |Simulating: |============================================                      |Simulating: |=============================================                     |Simulating: |==============================================                    |Simulating: |===============================================                   |Simulating: |================================================                  |Simulating: |=================================================                 |Simulating: |==================================================                |Simulating: |===================================================               |Simulating: |====================================================              |Simulating: |=====================================================             |Simulating: |======================================================            |Simulating: |=======================================================           |Simulating: |========================================================          |Simulating: |=========================================================         |Simulating: |==========================================================        |Simulating: |===========================================================       |Simulating: |============================================================      |Simulating: |=============================================================     |Simulating: |==============================================================    |Simulating: |===============================================================   |Simulating: |================================================================  |Simulating: |================================================================= |Simulating: |==================================================================|</code></pre>
<pre class="r"><code>plot_power_extend(powers_m2)</code></pre>
<p><img src="/courses/psyc575/rcode12_files/figure-html/powers_m2-2-1.png" width="672" /></p>
</div>
</div>
<div id="binary-predictor-at-level-2-with-a-continuous-level-1-covariate-and-random-slope" class="section level2">
<h2>Binary Predictor at Level 2 With a Continuous Level-1 Covariate (and Random Slope)</h2>
<p>Cluster-mean centering needs to be considerd</p>
<p><span class="math display">\[
  \begin{aligned}
    Y_{ij} &amp; = \beta_{0j} + \beta_{1j} X\text{_cmc}_{ij} + e_{ij} \\
    \beta_{0j} &amp; = \gamma_{00} + \gamma_{01} W_j + \gamma_{02} X\text{_cm}_{j} + u_{0j} \\
    \beta_{1j} &amp; = \gamma_{10} + {\color{red}{\gamma_{11}}} W_j + u_{1j}
  \end{aligned}
\]</span></p>
<div id="preparing-simulated-data-2" class="section level3">
<h3>Preparing Simulated Data</h3>
<p>First, generate the predictor matrix and the cluster ID</p>
<pre class="r"><code># Cluster ID (start with 10 clusters)
num_clus &lt;- 10
id &lt;- 1:num_clus
# Binary lv-2 predictor
treat &lt;- factor(c(&quot;c&quot;, &quot;t&quot;))
# Cluster means of X, with ICC(X) = 0.2
x_cm &lt;- rnorm(num_clus, mean = 0, sd = sqrt(0.2))
# Force SD = sqrt(0.2)
x_cm &lt;- (x_cm - mean(x_cm)) / sd(x_cm) * sqrt(0.2) * (num_clus - 1) / num_clus
# Level-2 data
lv2_dat &lt;- tibble(id, treat = rep_len(treat, length.out = num_clus), 
                  x_cm)
# Expand each cluster to include more rows
clus_size &lt;- 20  # Cluster size
lv2_dat &lt;- lv2_dat %&gt;% 
    slice(rep(1:n(), each = clus_size))
# Within-cluster component of X, with sigma^2(X) = 0.8
num_obs &lt;- num_clus * clus_size
x_cmc &lt;- rnorm(num_obs, mean = 0, sd = 1)
x_cmc &lt;- x_cmc - ave(x_cmc, lv2_dat$id, FUN = mean)
# Force SD = sqrt(0.8)
x_cmc &lt;- x_cmc / sd(x_cmc) * sqrt(0.8) * (num_obs - 1) / num_obs
# Expand each cluster to include more rows
(sim_dat &lt;- mutate(lv2_dat, x_cmc = x_cmc))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["int"],"align":["right"]},{"label":["treat"],"name":[2],"type":["fct"],"align":["left"]},{"label":["x_cm"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["x_cmc"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"c","3":"0.40170660","4":"-0.48798280"},{"1":"1","2":"c","3":"0.40170660","4":"0.86719218"},{"1":"1","2":"c","3":"0.40170660","4":"-1.05980058"},{"1":"1","2":"c","3":"0.40170660","4":"0.09373119"},{"1":"1","2":"c","3":"0.40170660","4":"-1.51644314"},{"1":"1","2":"c","3":"0.40170660","4":"-0.20892237"},{"1":"1","2":"c","3":"0.40170660","4":"1.81470973"},{"1":"1","2":"c","3":"0.40170660","4":"1.69246521"},{"1":"1","2":"c","3":"0.40170660","4":"-0.73490023"},{"1":"1","2":"c","3":"0.40170660","4":"-0.49669364"},{"1":"1","2":"c","3":"0.40170660","4":"-0.23024961"},{"1":"1","2":"c","3":"0.40170660","4":"0.75557962"},{"1":"1","2":"c","3":"0.40170660","4":"-2.27941213"},{"1":"1","2":"c","3":"0.40170660","4":"-0.12288942"},{"1":"1","2":"c","3":"0.40170660","4":"-0.46804871"},{"1":"1","2":"c","3":"0.40170660","4":"-1.05384615"},{"1":"1","2":"c","3":"0.40170660","4":"0.32017133"},{"1":"1","2":"c","3":"0.40170660","4":"0.98553139"},{"1":"1","2":"c","3":"0.40170660","4":"0.57706300"},{"1":"1","2":"c","3":"0.40170660","4":"1.55274513"},{"1":"2","2":"t","3":"0.26796953","4":"0.69938086"},{"1":"2","2":"t","3":"0.26796953","4":"1.18672605"},{"1":"2","2":"t","3":"0.26796953","4":"0.94453344"},{"1":"2","2":"t","3":"0.26796953","4":"-0.66575086"},{"1":"2","2":"t","3":"0.26796953","4":"1.07894121"},{"1":"2","2":"t","3":"0.26796953","4":"0.27081897"},{"1":"2","2":"t","3":"0.26796953","4":"-0.68136403"},{"1":"2","2":"t","3":"0.26796953","4":"-0.83937255"},{"1":"2","2":"t","3":"0.26796953","4":"0.34903471"},{"1":"2","2":"t","3":"0.26796953","4":"-0.38972425"},{"1":"2","2":"t","3":"0.26796953","4":"-0.14926485"},{"1":"2","2":"t","3":"0.26796953","4":"-0.79212808"},{"1":"2","2":"t","3":"0.26796953","4":"-0.47390360"},{"1":"2","2":"t","3":"0.26796953","4":"-0.61263823"},{"1":"2","2":"t","3":"0.26796953","4":"0.94797961"},{"1":"2","2":"t","3":"0.26796953","4":"-0.61105743"},{"1":"2","2":"t","3":"0.26796953","4":"-0.30670890"},{"1":"2","2":"t","3":"0.26796953","4":"-0.46472562"},{"1":"2","2":"t","3":"0.26796953","4":"1.49931195"},{"1":"2","2":"t","3":"0.26796953","4":"-0.99008838"},{"1":"3","2":"c","3":"-0.04489297","4":"-1.23375788"},{"1":"3","2":"c","3":"-0.04489297","4":"-0.15722865"},{"1":"3","2":"c","3":"-0.04489297","4":"-1.18614079"},{"1":"3","2":"c","3":"-0.04489297","4":"-0.28405324"},{"1":"3","2":"c","3":"-0.04489297","4":"-0.09889997"},{"1":"3","2":"c","3":"-0.04489297","4":"-0.25147066"},{"1":"3","2":"c","3":"-0.04489297","4":"0.86511419"},{"1":"3","2":"c","3":"-0.04489297","4":"-0.41994192"},{"1":"3","2":"c","3":"-0.04489297","4":"0.13352134"},{"1":"3","2":"c","3":"-0.04489297","4":"0.65970081"},{"1":"3","2":"c","3":"-0.04489297","4":"0.72141355"},{"1":"3","2":"c","3":"-0.04489297","4":"-1.98901081"},{"1":"3","2":"c","3":"-0.04489297","4":"1.32547523"},{"1":"3","2":"c","3":"-0.04489297","4":"0.58757162"},{"1":"3","2":"c","3":"-0.04489297","4":"-0.22616021"},{"1":"3","2":"c","3":"-0.04489297","4":"0.53719504"},{"1":"3","2":"c","3":"-0.04489297","4":"0.50015885"},{"1":"3","2":"c","3":"-0.04489297","4":"1.92073206"},{"1":"3","2":"c","3":"-0.04489297","4":"-0.99560343"},{"1":"3","2":"c","3":"-0.04489297","4":"-0.40861511"},{"1":"4","2":"t","3":"0.18725525","4":"0.50083865"},{"1":"4","2":"t","3":"0.18725525","4":"-1.52696547"},{"1":"4","2":"t","3":"0.18725525","4":"0.36951047"},{"1":"4","2":"t","3":"0.18725525","4":"-0.93362818"},{"1":"4","2":"t","3":"0.18725525","4":"0.07057343"},{"1":"4","2":"t","3":"0.18725525","4":"0.11299975"},{"1":"4","2":"t","3":"0.18725525","4":"-0.46606986"},{"1":"4","2":"t","3":"0.18725525","4":"-1.90023403"},{"1":"4","2":"t","3":"0.18725525","4":"0.07200229"},{"1":"4","2":"t","3":"0.18725525","4":"-0.09844177"},{"1":"4","2":"t","3":"0.18725525","4":"-0.29275914"},{"1":"4","2":"t","3":"0.18725525","4":"1.10889782"},{"1":"4","2":"t","3":"0.18725525","4":"0.72522544"},{"1":"4","2":"t","3":"0.18725525","4":"2.20977942"},{"1":"4","2":"t","3":"0.18725525","4":"-0.44070676"},{"1":"4","2":"t","3":"0.18725525","4":"0.11128486"},{"1":"4","2":"t","3":"0.18725525","4":"-0.85973504"},{"1":"4","2":"t","3":"0.18725525","4":"0.57140134"},{"1":"4","2":"t","3":"0.18725525","4":"0.08140768"},{"1":"4","2":"t","3":"0.18725525","4":"0.58461912"},{"1":"5","2":"c","3":"0.16516314","4":"-0.02869743"},{"1":"5","2":"c","3":"0.16516314","4":"-0.59473411"},{"1":"5","2":"c","3":"0.16516314","4":"-0.98698715"},{"1":"5","2":"c","3":"0.16516314","4":"1.52445806"},{"1":"5","2":"c","3":"0.16516314","4":"1.56669159"},{"1":"5","2":"c","3":"0.16516314","4":"0.67262062"},{"1":"5","2":"c","3":"0.16516314","4":"1.02060146"},{"1":"5","2":"c","3":"0.16516314","4":"0.76605698"},{"1":"5","2":"c","3":"0.16516314","4":"-0.28637179"},{"1":"5","2":"c","3":"0.16516314","4":"-1.21286263"},{"1":"5","2":"c","3":"0.16516314","4":"0.08953337"},{"1":"5","2":"c","3":"0.16516314","4":"-0.04065273"},{"1":"5","2":"c","3":"0.16516314","4":"-0.84147440"},{"1":"5","2":"c","3":"0.16516314","4":"0.41838716"},{"1":"5","2":"c","3":"0.16516314","4":"0.51125163"},{"1":"5","2":"c","3":"0.16516314","4":"-0.63898668"},{"1":"5","2":"c","3":"0.16516314","4":"-1.78673605"},{"1":"5","2":"c","3":"0.16516314","4":"-0.34968995"},{"1":"5","2":"c","3":"0.16516314","4":"-0.36324397"},{"1":"5","2":"c","3":"0.16516314","4":"0.56083603"},{"1":"6","2":"t","3":"0.20639807","4":"0.74553530"},{"1":"6","2":"t","3":"0.20639807","4":"-0.38521225"},{"1":"6","2":"t","3":"0.20639807","4":"-0.71385951"},{"1":"6","2":"t","3":"0.20639807","4":"0.45548071"},{"1":"6","2":"t","3":"0.20639807","4":"-0.62318891"},{"1":"6","2":"t","3":"0.20639807","4":"0.61618494"},{"1":"6","2":"t","3":"0.20639807","4":"0.15912131"},{"1":"6","2":"t","3":"0.20639807","4":"0.06011002"},{"1":"6","2":"t","3":"0.20639807","4":"2.28973904"},{"1":"6","2":"t","3":"0.20639807","4":"0.12412198"},{"1":"6","2":"t","3":"0.20639807","4":"-1.27055051"},{"1":"6","2":"t","3":"0.20639807","4":"-0.47533796"},{"1":"6","2":"t","3":"0.20639807","4":"-1.31623411"},{"1":"6","2":"t","3":"0.20639807","4":"1.11620950"},{"1":"6","2":"t","3":"0.20639807","4":"-1.29785998"},{"1":"6","2":"t","3":"0.20639807","4":"1.21248078"},{"1":"6","2":"t","3":"0.20639807","4":"0.19010715"},{"1":"6","2":"t","3":"0.20639807","4":"0.29260086"},{"1":"6","2":"t","3":"0.20639807","4":"-0.80882756"},{"1":"6","2":"t","3":"0.20639807","4":"-0.37062078"},{"1":"7","2":"c","3":"-0.57547036","4":"1.07085708"},{"1":"7","2":"c","3":"-0.57547036","4":"-0.28470161"},{"1":"7","2":"c","3":"-0.57547036","4":"-0.38211989"},{"1":"7","2":"c","3":"-0.57547036","4":"-0.30305103"},{"1":"7","2":"c","3":"-0.57547036","4":"1.11090623"},{"1":"7","2":"c","3":"-0.57547036","4":"0.50449186"},{"1":"7","2":"c","3":"-0.57547036","4":"-1.45371250"},{"1":"7","2":"c","3":"-0.57547036","4":"0.31412588"},{"1":"7","2":"c","3":"-0.57547036","4":"0.15160368"},{"1":"7","2":"c","3":"-0.57547036","4":"-0.19457643"},{"1":"7","2":"c","3":"-0.57547036","4":"-1.29618728"},{"1":"7","2":"c","3":"-0.57547036","4":"0.87081947"},{"1":"7","2":"c","3":"-0.57547036","4":"-0.32591616"},{"1":"7","2":"c","3":"-0.57547036","4":"-0.22478711"},{"1":"7","2":"c","3":"-0.57547036","4":"-0.62919812"},{"1":"7","2":"c","3":"-0.57547036","4":"0.65287638"},{"1":"7","2":"c","3":"-0.57547036","4":"-0.83735855"},{"1":"7","2":"c","3":"-0.57547036","4":"-0.73413525"},{"1":"7","2":"c","3":"-0.57547036","4":"1.71674826"},{"1":"7","2":"c","3":"-0.57547036","4":"0.27331510"},{"1":"8","2":"t","3":"-0.52708265","4":"-0.31466524"},{"1":"8","2":"t","3":"-0.52708265","4":"-0.65984650"},{"1":"8","2":"t","3":"-0.52708265","4":"-0.42993753"},{"1":"8","2":"t","3":"-0.52708265","4":"1.37853447"},{"1":"8","2":"t","3":"-0.52708265","4":"-1.31831872"},{"1":"8","2":"t","3":"-0.52708265","4":"1.04745512"},{"1":"8","2":"t","3":"-0.52708265","4":"0.17497390"},{"1":"8","2":"t","3":"-0.52708265","4":"-0.09998111"},{"1":"8","2":"t","3":"-0.52708265","4":"-2.65062701"},{"1":"8","2":"t","3":"-0.52708265","4":"-0.05120033"},{"1":"8","2":"t","3":"-0.52708265","4":"-0.30492609"},{"1":"8","2":"t","3":"-0.52708265","4":"-0.52742374"},{"1":"8","2":"t","3":"-0.52708265","4":"1.14498908"},{"1":"8","2":"t","3":"-0.52708265","4":"-0.40606397"},{"1":"8","2":"t","3":"-0.52708265","4":"0.94384443"},{"1":"8","2":"t","3":"-0.52708265","4":"0.49692270"},{"1":"8","2":"t","3":"-0.52708265","4":"-0.14783177"},{"1":"8","2":"t","3":"-0.52708265","4":"1.25214389"},{"1":"8","2":"t","3":"-0.52708265","4":"0.22964004"},{"1":"8","2":"t","3":"-0.52708265","4":"0.24231838"},{"1":"9","2":"c","3":"0.46226824","4":"-0.02982459"},{"1":"9","2":"c","3":"0.46226824","4":"-0.18644043"},{"1":"9","2":"c","3":"0.46226824","4":"0.56567300"},{"1":"9","2":"c","3":"0.46226824","4":"-1.07159779"},{"1":"9","2":"c","3":"0.46226824","4":"0.42278493"},{"1":"9","2":"c","3":"0.46226824","4":"-1.27878689"},{"1":"9","2":"c","3":"0.46226824","4":"0.78098407"},{"1":"9","2":"c","3":"0.46226824","4":"-0.03750811"},{"1":"9","2":"c","3":"0.46226824","4":"0.06740087"},{"1":"9","2":"c","3":"0.46226824","4":"-0.29873658"},{"1":"9","2":"c","3":"0.46226824","4":"0.81212674"},{"1":"9","2":"c","3":"0.46226824","4":"1.56442858"},{"1":"9","2":"c","3":"0.46226824","4":"-0.82511342"},{"1":"9","2":"c","3":"0.46226824","4":"0.45641687"},{"1":"9","2":"c","3":"0.46226824","4":"-0.94348759"},{"1":"9","2":"c","3":"0.46226824","4":"-0.69811430"},{"1":"9","2":"c","3":"0.46226824","4":"-0.61600982"},{"1":"9","2":"c","3":"0.46226824","4":"-0.77936076"},{"1":"9","2":"c","3":"0.46226824","4":"1.73682011"},{"1":"9","2":"c","3":"0.46226824","4":"0.35834512"},{"1":"10","2":"t","3":"-0.54331486","4":"1.30808074"},{"1":"10","2":"t","3":"-0.54331486","4":"-0.40479706"},{"1":"10","2":"t","3":"-0.54331486","4":"-0.28786939"},{"1":"10","2":"t","3":"-0.54331486","4":"0.09196599"},{"1":"10","2":"t","3":"-0.54331486","4":"-1.02364523"},{"1":"10","2":"t","3":"-0.54331486","4":"0.06585023"},{"1":"10","2":"t","3":"-0.54331486","4":"-0.22575047"},{"1":"10","2":"t","3":"-0.54331486","4":"0.03133380"},{"1":"10","2":"t","3":"-0.54331486","4":"0.63858496"},{"1":"10","2":"t","3":"-0.54331486","4":"-0.17959041"},{"1":"10","2":"t","3":"-0.54331486","4":"0.54537301"},{"1":"10","2":"t","3":"-0.54331486","4":"-0.88518801"},{"1":"10","2":"t","3":"-0.54331486","4":"0.10355624"},{"1":"10","2":"t","3":"-0.54331486","4":"-0.56723520"},{"1":"10","2":"t","3":"-0.54331486","4":"2.02470700"},{"1":"10","2":"t","3":"-0.54331486","4":"1.01429147"},{"1":"10","2":"t","3":"-0.54331486","4":"-1.04878251"},{"1":"10","2":"t","3":"-0.54331486","4":"-0.99383697"},{"1":"10","2":"t","3":"-0.54331486","4":"1.25947724"},{"1":"10","2":"t","3":"-0.54331486","4":"-1.46652545"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Then specify the fixed effect coefficients and the random effect variance:</p>
<pre class="r"><code># gamma_00, gamma_01, gamma_02, gamma_10, gamma_11
gams &lt;- c(0, 0.3, 0.2, 0.1, 0.2)  
taus &lt;- matrix(c(0.25, 0, 
                 0, 0.10), nrow = 2)  # tau^2_0 = 0.25, tau^2_1 = 0.1
sigma &lt;- sqrt(.96)  # sigma</code></pre>
<p>Use <code>simr::makeLmer()</code> to build an artificial <code>lmer</code> object:</p>
<pre class="r"><code>sim_m4 &lt;- makeLmer(y ~ treat + x_cm + x_cmc + treat:x_cmc + (x_cmc | id), 
                   fixef = gams, VarCorr = taus, sigma = sigma, 
                   data = sim_dat)
# Check R^2
r.squaredGLMM(sim_m4)</code></pre>
<pre><code>&gt;#             R2m     R2c
&gt;# [1,] 0.04625677 0.28958</code></pre>
<pre class="r"><code># Compare to a model without the cross-level interaction
sim_m4n &lt;- makeLmer(y ~ treat + x_cm + x_cmc + (x_cmc | id), 
                    fixef = gams[1:4], VarCorr = taus, sigma = sigma, 
                    data = sim_dat)
# Check R^2
r.squaredGLMM(sim_m4n)</code></pre>
<pre><code>&gt;#             R2m       R2c
&gt;# [1,] 0.02383195 0.2728763</code></pre>
<pre class="r"><code># So the cross-level interaction corresponds to an R^2 change of about 2.5%</code></pre>
</div>
<div id="obtain-simulation-based-power-2" class="section level3">
<h3>Obtain simulation-based power</h3>
<p>Use various numbers of clusters</p>
<p>Note: by default the first term in the fixed effect (other than the intercept)
will be tested. We’ll specify the interaction instead.</p>
<pre class="r"><code># Use it on our example:
powers_m4 &lt;- power_extend(sim_m4, 
                          along = &quot;id&quot;, 
                          new_size = c(10, 20, 50, 100), 
                          nsim = 100, 
                          test = fixed(&quot;treat:x_cmc&quot;, 
                                       method = &quot;anova&quot;))</code></pre>
<pre><code>&gt;# Simulating: |                                                                  |Simulating: |=                                                                 |Simulating: |==                                                                |Simulating: |===                                                               |Simulating: |====                                                              |Simulating: |=====                                                             |Simulating: |======                                                            |Simulating: |=======                                                           |Simulating: |========                                                          |Simulating: |=========                                                         |Simulating: |==========                                                        |Simulating: |===========                                                       |Simulating: |============                                                      |Simulating: |=============                                                     |Simulating: |==============                                                    |Simulating: |===============                                                   |Simulating: |================                                                  |Simulating: |=================                                                 |Simulating: |==================                                                |Simulating: |===================                                               |Simulating: |====================                                              |Simulating: |=====================                                             |Simulating: |======================                                            |Simulating: |=======================                                           |Simulating: |========================                                          |Simulating: |=========================                                         |Simulating: |==========================                                        |Simulating: |===========================                                       |Simulating: |============================                                      |Simulating: |=============================                                     |Simulating: |==============================                                    |Simulating: |===============================                                   |Simulating: |================================                                  |Simulating: |=================================                                 |Simulating: |==================================                                |Simulating: |===================================                               |Simulating: |====================================                              |Simulating: |=====================================                             |Simulating: |======================================                            |Simulating: |=======================================                           |Simulating: |========================================                          |Simulating: |=========================================                         |Simulating: |==========================================                        |Simulating: |===========================================                       |Simulating: |============================================                      |Simulating: |=============================================                     |Simulating: |==============================================                    |Simulating: |===============================================                   |Simulating: |================================================                  |Simulating: |=================================================                 |Simulating: |==================================================                |Simulating: |===================================================               |Simulating: |====================================================              |Simulating: |=====================================================             |Simulating: |======================================================            |Simulating: |=======================================================           |Simulating: |========================================================          |Simulating: |=========================================================         |Simulating: |==========================================================        |Simulating: |===========================================================       |Simulating: |============================================================      |Simulating: |=============================================================     |Simulating: |==============================================================    |Simulating: |===============================================================   |Simulating: |================================================================  |Simulating: |================================================================= |Simulating: |==================================================================|Simulating: |                                                                  |Simulating: |=                                                                 |Simulating: |==                                                                |Simulating: |===                                                               |Simulating: |====                                                              |Simulating: |=====                                                             |Simulating: |======                                                            |Simulating: |=======                                                           |Simulating: |========                                                          |Simulating: |=========                                                         |Simulating: |==========                                                        |Simulating: |===========                                                       |Simulating: |============                                                      |Simulating: |=============                                                     |Simulating: |==============                                                    |Simulating: |===============                                                   |Simulating: |================                                                  |Simulating: |=================                                                 |Simulating: |==================                                                |Simulating: |===================                                               |Simulating: |====================                                              |Simulating: |=====================                                             |Simulating: |======================                                            |Simulating: |=======================                                           |Simulating: |========================                                          |Simulating: |=========================                                         |Simulating: |==========================                                        |Simulating: |===========================                                       |Simulating: |============================                                      |Simulating: |=============================                                     |Simulating: |==============================                                    |Simulating: |===============================                                   |Simulating: |================================                                  |Simulating: |=================================                                 |Simulating: |==================================                                |Simulating: |===================================                               |Simulating: |====================================                              |Simulating: |=====================================                             |Simulating: |======================================                            |Simulating: |=======================================                           |Simulating: |========================================                          |Simulating: |=========================================                         |Simulating: |==========================================                        |Simulating: |===========================================                       |Simulating: |============================================                      |Simulating: |=============================================                     |Simulating: |==============================================                    |Simulating: |===============================================                   |Simulating: |================================================                  |Simulating: |=================================================                 |Simulating: |==================================================                |Simulating: |===================================================               |Simulating: |====================================================              |Simulating: |=====================================================             |Simulating: |======================================================            |Simulating: |=======================================================           |Simulating: |========================================================          |Simulating: |=========================================================         |Simulating: |==========================================================        |Simulating: |===========================================================       |Simulating: |============================================================      |Simulating: |=============================================================     |Simulating: |==============================================================    |Simulating: |===============================================================   |Simulating: |================================================================  |Simulating: |================================================================= |Simulating: |==================================================================|Simulating: |                                                                  |Simulating: |=                                                                 |Simulating: |==                                                                |Simulating: |===                                                               |Simulating: |====                                                              |Simulating: |=====                                                             |Simulating: |======                                                            |Simulating: |=======                                                           |Simulating: |========                                                          |Simulating: |=========                                                         |Simulating: |==========                                                        |Simulating: |===========                                                       |Simulating: |============                                                      |Simulating: |=============                                                     |Simulating: |==============                                                    |Simulating: |===============                                                   |Simulating: |================                                                  |Simulating: |=================                                                 |Simulating: |==================                                                |Simulating: |===================                                               |Simulating: |====================                                              |Simulating: |=====================                                             |Simulating: |======================                                            |Simulating: |=======================                                           |Simulating: |========================                                          |Simulating: |=========================                                         |Simulating: |==========================                                        |Simulating: |===========================                                       |Simulating: |============================                                      |Simulating: |=============================                                     |Simulating: |==============================                                    |Simulating: |===============================                                   |Simulating: |================================                                  |Simulating: |=================================                                 |Simulating: |==================================                                |Simulating: |===================================                               |Simulating: |====================================                              |Simulating: |=====================================                             |Simulating: |======================================                            |Simulating: |=======================================                           |Simulating: |========================================                          |Simulating: |=========================================                         |Simulating: |==========================================                        |Simulating: |===========================================                       |Simulating: |============================================                      |Simulating: |=============================================                     |Simulating: |==============================================                    |Simulating: |===============================================                   |Simulating: |================================================                  |Simulating: |=================================================                 |Simulating: |==================================================                |Simulating: |===================================================               |Simulating: |====================================================              |Simulating: |=====================================================             |Simulating: |======================================================            |Simulating: |=======================================================           |Simulating: |========================================================          |Simulating: |=========================================================         |Simulating: |==========================================================        |Simulating: |===========================================================       |Simulating: |============================================================      |Simulating: |=============================================================     |Simulating: |==============================================================    |Simulating: |===============================================================   |Simulating: |================================================================  |Simulating: |================================================================= |Simulating: |==================================================================|Simulating: |                                                                  |Simulating: |=                                                                 |Simulating: |==                                                                |Simulating: |===                                                               |Simulating: |====                                                              |Simulating: |=====                                                             |Simulating: |======                                                            |Simulating: |=======                                                           |Simulating: |========                                                          |Simulating: |=========                                                         |Simulating: |==========                                                        |Simulating: |===========                                                       |Simulating: |============                                                      |Simulating: |=============                                                     |Simulating: |==============                                                    |Simulating: |===============                                                   |Simulating: |================                                                  |Simulating: |=================                                                 |Simulating: |==================                                                |Simulating: |===================                                               |Simulating: |====================                                              |Simulating: |=====================                                             |Simulating: |======================                                            |Simulating: |=======================                                           |Simulating: |========================                                          |Simulating: |=========================                                         |Simulating: |==========================                                        |Simulating: |===========================                                       |Simulating: |============================                                      |Simulating: |=============================                                     |Simulating: |==============================                                    |Simulating: |===============================                                   |Simulating: |================================                                  |Simulating: |=================================                                 |Simulating: |==================================                                |Simulating: |===================================                               |Simulating: |====================================                              |Simulating: |=====================================                             |Simulating: |======================================                            |Simulating: |=======================================                           |Simulating: |========================================                          |Simulating: |=========================================                         |Simulating: |==========================================                        |Simulating: |===========================================                       |Simulating: |============================================                      |Simulating: |=============================================                     |Simulating: |==============================================                    |Simulating: |===============================================                   |Simulating: |================================================                  |Simulating: |=================================================                 |Simulating: |==================================================                |Simulating: |===================================================               |Simulating: |====================================================              |Simulating: |=====================================================             |Simulating: |======================================================            |Simulating: |=======================================================           |Simulating: |========================================================          |Simulating: |=========================================================         |Simulating: |==========================================================        |Simulating: |===========================================================       |Simulating: |============================================================      |Simulating: |=============================================================     |Simulating: |==============================================================    |Simulating: |===============================================================   |Simulating: |================================================================  |Simulating: |================================================================= |Simulating: |==================================================================|</code></pre>
<pre class="r"><code>plot_power_extend(powers_m4)</code></pre>
<p><img src="/courses/psyc575/rcode12_files/figure-html/powers_m4-1.png" width="672" /></p>
<p>Use various cluster sizes (results not shown)</p>
<pre class="r"><code># Use it on our example:
powers_m4 &lt;- power_extend(sim_m4, 
                          within = &quot;id + treat + x_cm&quot;,
                          new_size = c(40, 80, 200), 
                          nsim = 100, 
                          test = fixed(&quot;treat:x_cmc&quot;, 
                                       method = &quot;anova&quot;))
plot_power_extend(powers_m4)</code></pre>
</div>
</div>
<div id="growth-modeling" class="section level2">
<h2>Growth Modeling</h2>
<p>With a binary person-level predictor</p>
<p><span class="math display">\[
  \begin{aligned}
    Y_{ti} &amp; = \beta_{0j} + \beta_{1i} \text{time}_{ti} + e_{ti} \\
    \beta_{0i} &amp; = \gamma_{00} + {\color{red}{\gamma_{01}}} W_i + u_{0i} \\
    \beta_{1i} &amp; = \gamma_{10} + \gamma_{11} W_i + u_{1i}
  \end{aligned}
\]</span></p>
<div id="preparing-simulated-data-3" class="section level3">
<h3>Preparing Simulated Data</h3>
<p>First, generate the predictor matrix and the cluster ID</p>
<pre class="r"><code># Person ID (start with 10 clusters)
num_clus &lt;- 10
id &lt;- 1:num_clus
# Binary lv-2 predictor
treat &lt;- factor(c(&quot;c&quot;, &quot;t&quot;))
# Level-2 data
lv2_dat &lt;- tibble(id, treat = rep_len(treat, length.out = num_clus))
# Expand each cluster to include more rows
clus_size &lt;- 4  # Number of time points
# Within-cluster component of X, with sigma^2(X) = 0.8
time &lt;- 0:(clus_size - 1)
# Expand each cluster to include more rows
(sim_dat &lt;- expand_grid(lv2_dat, time))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["int"],"align":["right"]},{"label":["treat"],"name":[2],"type":["fct"],"align":["left"]},{"label":["time"],"name":[3],"type":["int"],"align":["right"]}],"data":[{"1":"1","2":"c","3":"0"},{"1":"1","2":"c","3":"1"},{"1":"1","2":"c","3":"2"},{"1":"1","2":"c","3":"3"},{"1":"2","2":"t","3":"0"},{"1":"2","2":"t","3":"1"},{"1":"2","2":"t","3":"2"},{"1":"2","2":"t","3":"3"},{"1":"3","2":"c","3":"0"},{"1":"3","2":"c","3":"1"},{"1":"3","2":"c","3":"2"},{"1":"3","2":"c","3":"3"},{"1":"4","2":"t","3":"0"},{"1":"4","2":"t","3":"1"},{"1":"4","2":"t","3":"2"},{"1":"4","2":"t","3":"3"},{"1":"5","2":"c","3":"0"},{"1":"5","2":"c","3":"1"},{"1":"5","2":"c","3":"2"},{"1":"5","2":"c","3":"3"},{"1":"6","2":"t","3":"0"},{"1":"6","2":"t","3":"1"},{"1":"6","2":"t","3":"2"},{"1":"6","2":"t","3":"3"},{"1":"7","2":"c","3":"0"},{"1":"7","2":"c","3":"1"},{"1":"7","2":"c","3":"2"},{"1":"7","2":"c","3":"3"},{"1":"8","2":"t","3":"0"},{"1":"8","2":"t","3":"1"},{"1":"8","2":"t","3":"2"},{"1":"8","2":"t","3":"3"},{"1":"9","2":"c","3":"0"},{"1":"9","2":"c","3":"1"},{"1":"9","2":"c","3":"2"},{"1":"9","2":"c","3":"3"},{"1":"10","2":"t","3":"0"},{"1":"10","2":"t","3":"1"},{"1":"10","2":"t","3":"2"},{"1":"10","2":"t","3":"3"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Then specify the fixed effect coefficients and the random effect variance:</p>
<pre class="r"><code># gamma_00, gamma_01, gamma_10, gamma_11
gams &lt;- c(1, 0.5, -0.2, 0.3)  
taus &lt;- matrix(c(0.5, 0, 
                 0, 0.10), nrow = 2)  # tau^2_0 = 0.5, tau^2_1 = 0.1
sigma &lt;- sqrt(1)  # sigma</code></pre>
<p>Use <code>simr::makeLmer()</code> to build an artificial <code>lmer</code> object:</p>
<pre class="r"><code>sim_m5 &lt;- makeLmer(y ~ treat + time + treat:time + (time | id), 
                   fixef = gams, VarCorr = taus, sigma = sigma, 
                   data = sim_dat)
# Check R^2
r.squaredGLMM(sim_m5)</code></pre>
<pre><code>&gt;#            R2m       R2c
&gt;# [1,] 0.1246588 0.5268426</code></pre>
<pre class="r"><code># Compare to a model without the binary treatment predictor
sim_m5n &lt;- makeLmer(y ~ time + (time | id), 
                    fixef = gams[c(1, 3)], VarCorr = taus, sigma = sigma, 
                    data = sim_dat)
# Check R^2
r.squaredGLMM(sim_m5n)</code></pre>
<pre><code>&gt;#             R2m       R2c
&gt;# [1,] 0.02697235 0.4740391</code></pre>
<pre class="r"><code># So treat corresponds to an R^2 change of about 10%</code></pre>
</div>
<div id="obtain-simulation-based-power-3" class="section level3">
<h3>Obtain simulation-based power</h3>
<p>Use various numbers of clusters</p>
<p>Note: by default the first term in the fixed effect (other than the intercept)
will be tested. We’ll first specify the effect of treat.</p>
<pre class="r"><code># Use it on our example:
powers_m5 &lt;- power_extend(sim_m5, 
                          along = &quot;id&quot;, 
                          new_size = c(10, 20, 50, 100), 
                          nsim = 100)</code></pre>
<pre><code>&gt;# Simulating: |                                                                  |Simulating: |=                                                                 |Simulating: |==                                                                |Simulating: |===                                                               |Simulating: |====                                                              |Simulating: |=====                                                             |Simulating: |======                                                            |Simulating: |=======                                                           |Simulating: |========                                                          |Simulating: |=========                                                         |Simulating: |==========                                                        |Simulating: |===========                                                       |Simulating: |============                                                      |Simulating: |=============                                                     |Simulating: |==============                                                    |Simulating: |===============                                                   |Simulating: |================                                                  |Simulating: |=================                                                 |Simulating: |==================                                                |Simulating: |===================                                               |Simulating: |====================                                              |Simulating: |=====================                                             |Simulating: |======================                                            |Simulating: |=======================                                           |Simulating: |========================                                          |Simulating: |=========================                                         |Simulating: |==========================                                        |Simulating: |===========================                                       |Simulating: |============================                                      |Simulating: |=============================                                     |Simulating: |==============================                                    |Simulating: |===============================                                   |Simulating: |================================                                  |Simulating: |=================================                                 |Simulating: |==================================                                |Simulating: |===================================                               |Simulating: |====================================                              |Simulating: |=====================================                             |Simulating: |======================================                            |Simulating: |=======================================                           |Simulating: |========================================                          |Simulating: |=========================================                         |Simulating: |==========================================                        |Simulating: |===========================================                       |Simulating: |============================================                      |Simulating: |=============================================                     |Simulating: |==============================================                    |Simulating: |===============================================                   |Simulating: |================================================                  |Simulating: |=================================================                 |Simulating: |==================================================                |Simulating: |===================================================               |Simulating: |====================================================              |Simulating: |=====================================================             |Simulating: |======================================================            |Simulating: |=======================================================           |Simulating: |========================================================          |Simulating: |=========================================================         |Simulating: |==========================================================        |Simulating: |===========================================================       |Simulating: |============================================================      |Simulating: |=============================================================     |Simulating: |==============================================================    |Simulating: |===============================================================   |Simulating: |================================================================  |Simulating: |================================================================= |Simulating: |==================================================================|Simulating: |                                                                  |Simulating: |=                                                                 |Simulating: |==                                                                |Simulating: |===                                                               |Simulating: |====                                                              |Simulating: |=====                                                             |Simulating: |======                                                            |Simulating: |=======                                                           |Simulating: |========                                                          |Simulating: |=========                                                         |Simulating: |==========                                                        |Simulating: |===========                                                       |Simulating: |============                                                      |Simulating: |=============                                                     |Simulating: |==============                                                    |Simulating: |===============                                                   |Simulating: |================                                                  |Simulating: |=================                                                 |Simulating: |==================                                                |Simulating: |===================                                               |Simulating: |====================                                              |Simulating: |=====================                                             |Simulating: |======================                                            |Simulating: |=======================                                           |Simulating: |========================                                          |Simulating: |=========================                                         |Simulating: |==========================                                        |Simulating: |===========================                                       |Simulating: |============================                                      |Simulating: |=============================                                     |Simulating: |==============================                                    |Simulating: |===============================                                   |Simulating: |================================                                  |Simulating: |=================================                                 |Simulating: |==================================                                |Simulating: |===================================                               |Simulating: |====================================                              |Simulating: |=====================================                             |Simulating: |======================================                            |Simulating: |=======================================                           |Simulating: |========================================                          |Simulating: |=========================================                         |Simulating: |==========================================                        |Simulating: |===========================================                       |Simulating: |============================================                      |Simulating: |=============================================                     |Simulating: |==============================================                    |Simulating: |===============================================                   |Simulating: |================================================                  |Simulating: |=================================================                 |Simulating: |==================================================                |Simulating: |===================================================               |Simulating: |====================================================              |Simulating: |=====================================================             |Simulating: |======================================================            |Simulating: |=======================================================           |Simulating: |========================================================          |Simulating: |=========================================================         |Simulating: |==========================================================        |Simulating: |===========================================================       |Simulating: |============================================================      |Simulating: |=============================================================     |Simulating: |==============================================================    |Simulating: |===============================================================   |Simulating: |================================================================  |Simulating: |================================================================= |Simulating: |==================================================================|Simulating: |                                                                  |Simulating: |=                                                                 |Simulating: |==                                                                |Simulating: |===                                                               |Simulating: |====                                                              |Simulating: |=====                                                             |Simulating: |======                                                            |Simulating: |=======                                                           |Simulating: |========                                                          |Simulating: |=========                                                         |Simulating: |==========                                                        |Simulating: |===========                                                       |Simulating: |============                                                      |Simulating: |=============                                                     |Simulating: |==============                                                    |Simulating: |===============                                                   |Simulating: |================                                                  |Simulating: |=================                                                 |Simulating: |==================                                                |Simulating: |===================                                               |Simulating: |====================                                              |Simulating: |=====================                                             |Simulating: |======================                                            |Simulating: |=======================                                           |Simulating: |========================                                          |Simulating: |=========================                                         |Simulating: |==========================                                        |Simulating: |===========================                                       |Simulating: |============================                                      |Simulating: |=============================                                     |Simulating: |==============================                                    |Simulating: |===============================                                   |Simulating: |================================                                  |Simulating: |=================================                                 |Simulating: |==================================                                |Simulating: |===================================                               |Simulating: |====================================                              |Simulating: |=====================================                             |Simulating: |======================================                            |Simulating: |=======================================                           |Simulating: |========================================                          |Simulating: |=========================================                         |Simulating: |==========================================                        |Simulating: |===========================================                       |Simulating: |============================================                      |Simulating: |=============================================                     |Simulating: |==============================================                    |Simulating: |===============================================                   |Simulating: |================================================                  |Simulating: |=================================================                 |Simulating: |==================================================                |Simulating: |===================================================               |Simulating: |====================================================              |Simulating: |=====================================================             |Simulating: |======================================================            |Simulating: |=======================================================           |Simulating: |========================================================          |Simulating: |=========================================================         |Simulating: |==========================================================        |Simulating: |===========================================================       |Simulating: |============================================================      |Simulating: |=============================================================     |Simulating: |==============================================================    |Simulating: |===============================================================   |Simulating: |================================================================  |Simulating: |================================================================= |Simulating: |==================================================================|Simulating: |                                                                  |Simulating: |=                                                                 |Simulating: |==                                                                |Simulating: |===                                                               |Simulating: |====                                                              |Simulating: |=====                                                             |Simulating: |======                                                            |Simulating: |=======                                                           |Simulating: |========                                                          |Simulating: |=========                                                         |Simulating: |==========                                                        |Simulating: |===========                                                       |Simulating: |============                                                      |Simulating: |=============                                                     |Simulating: |==============                                                    |Simulating: |===============                                                   |Simulating: |================                                                  |Simulating: |=================                                                 |Simulating: |==================                                                |Simulating: |===================                                               |Simulating: |====================                                              |Simulating: |=====================                                             |Simulating: |======================                                            |Simulating: |=======================                                           |Simulating: |========================                                          |Simulating: |=========================                                         |Simulating: |==========================                                        |Simulating: |===========================                                       |Simulating: |============================                                      |Simulating: |=============================                                     |Simulating: |==============================                                    |Simulating: |===============================                                   |Simulating: |================================                                  |Simulating: |=================================                                 |Simulating: |==================================                                |Simulating: |===================================                               |Simulating: |====================================                              |Simulating: |=====================================                             |Simulating: |======================================                            |Simulating: |=======================================                           |Simulating: |========================================                          |Simulating: |=========================================                         |Simulating: |==========================================                        |Simulating: |===========================================                       |Simulating: |============================================                      |Simulating: |=============================================                     |Simulating: |==============================================                    |Simulating: |===============================================                   |Simulating: |================================================                  |Simulating: |=================================================                 |Simulating: |==================================================                |Simulating: |===================================================               |Simulating: |====================================================              |Simulating: |=====================================================             |Simulating: |======================================================            |Simulating: |=======================================================           |Simulating: |========================================================          |Simulating: |=========================================================         |Simulating: |==========================================================        |Simulating: |===========================================================       |Simulating: |============================================================      |Simulating: |=============================================================     |Simulating: |==============================================================    |Simulating: |===============================================================   |Simulating: |================================================================  |Simulating: |================================================================= |Simulating: |==================================================================|</code></pre>
<pre class="r"><code>plot_power_extend(powers_m5)</code></pre>
<p><img src="/courses/psyc575/rcode12_files/figure-html/powers_m5-1.png" width="672" /></p>
<p>And then the slope difference</p>
<pre class="r"><code># Use it on our example:
powers_m5 &lt;- power_extend(sim_m5, 
                          along = &quot;id&quot;, 
                          new_size = c(10, 20, 50, 100), 
                          nsim = 100, 
                          test = fixed(&quot;treat:time&quot;, 
                                       method = &quot;anova&quot;))</code></pre>
<pre><code>&gt;# Simulating: |                                                                  |Simulating: |=                                                                 |Simulating: |==                                                                |Simulating: |===                                                               |Simulating: |====                                                              |Simulating: |=====                                                             |Simulating: |======                                                            |Simulating: |=======                                                           |Simulating: |========                                                          |Simulating: |=========                                                         |Simulating: |==========                                                        |Simulating: |===========                                                       |Simulating: |============                                                      |Simulating: |=============                                                     |Simulating: |==============                                                    |Simulating: |===============                                                   |Simulating: |================                                                  |Simulating: |=================                                                 |Simulating: |==================                                                |Simulating: |===================                                               |Simulating: |====================                                              |Simulating: |=====================                                             |Simulating: |======================                                            |Simulating: |=======================                                           |Simulating: |========================                                          |Simulating: |=========================                                         |Simulating: |==========================                                        |Simulating: |===========================                                       |Simulating: |============================                                      |Simulating: |=============================                                     |Simulating: |==============================                                    |Simulating: |===============================                                   |Simulating: |================================                                  |Simulating: |=================================                                 |Simulating: |==================================                                |Simulating: |===================================                               |Simulating: |====================================                              |Simulating: |=====================================                             |Simulating: |======================================                            |Simulating: |=======================================                           |Simulating: |========================================                          |Simulating: |=========================================                         |Simulating: |==========================================                        |Simulating: |===========================================                       |Simulating: |============================================                      |Simulating: |=============================================                     |Simulating: |==============================================                    |Simulating: |===============================================                   |Simulating: |================================================                  |Simulating: |=================================================                 |Simulating: |==================================================                |Simulating: |===================================================               |Simulating: |====================================================              |Simulating: |=====================================================             |Simulating: |======================================================            |Simulating: |=======================================================           |Simulating: |========================================================          |Simulating: |=========================================================         |Simulating: |==========================================================        |Simulating: |===========================================================       |Simulating: |============================================================      |Simulating: |=============================================================     |Simulating: |==============================================================    |Simulating: |===============================================================   |Simulating: |================================================================  |Simulating: |================================================================= |Simulating: |==================================================================|Simulating: |                                                                  |Simulating: |=                                                                 |Simulating: |==                                                                |Simulating: |===                                                               |Simulating: |====                                                              |Simulating: |=====                                                             |Simulating: |======                                                            |Simulating: |=======                                                           |Simulating: |========                                                          |Simulating: |=========                                                         |Simulating: |==========                                                        |Simulating: |===========                                                       |Simulating: |============                                                      |Simulating: |=============                                                     |Simulating: |==============                                                    |Simulating: |===============                                                   |Simulating: |================                                                  |Simulating: |=================                                                 |Simulating: |==================                                                |Simulating: |===================                                               |Simulating: |====================                                              |Simulating: |=====================                                             |Simulating: |======================                                            |Simulating: |=======================                                           |Simulating: |========================                                          |Simulating: |=========================                                         |Simulating: |==========================                                        |Simulating: |===========================                                       |Simulating: |============================                                      |Simulating: |=============================                                     |Simulating: |==============================                                    |Simulating: |===============================                                   |Simulating: |================================                                  |Simulating: |=================================                                 |Simulating: |==================================                                |Simulating: |===================================                               |Simulating: |====================================                              |Simulating: |=====================================                             |Simulating: |======================================                            |Simulating: |=======================================                           |Simulating: |========================================                          |Simulating: |=========================================                         |Simulating: |==========================================                        |Simulating: |===========================================                       |Simulating: |============================================                      |Simulating: |=============================================                     |Simulating: |==============================================                    |Simulating: |===============================================                   |Simulating: |================================================                  |Simulating: |=================================================                 |Simulating: |==================================================                |Simulating: |===================================================               |Simulating: |====================================================              |Simulating: |=====================================================             |Simulating: |======================================================            |Simulating: |=======================================================           |Simulating: |========================================================          |Simulating: |=========================================================         |Simulating: |==========================================================        |Simulating: |===========================================================       |Simulating: |============================================================      |Simulating: |=============================================================     |Simulating: |==============================================================    |Simulating: |===============================================================   |Simulating: |================================================================  |Simulating: |================================================================= |Simulating: |==================================================================|Simulating: |                                                                  |Simulating: |=                                                                 |Simulating: |==                                                                |Simulating: |===                                                               |Simulating: |====                                                              |Simulating: |=====                                                             |Simulating: |======                                                            |Simulating: |=======                                                           |Simulating: |========                                                          |Simulating: |=========                                                         |Simulating: |==========                                                        |Simulating: |===========                                                       |Simulating: |============                                                      |Simulating: |=============                                                     |Simulating: |==============                                                    |Simulating: |===============                                                   |Simulating: |================                                                  |Simulating: |=================                                                 |Simulating: |==================                                                |Simulating: |===================                                               |Simulating: |====================                                              |Simulating: |=====================                                             |Simulating: |======================                                            |Simulating: |=======================                                           |Simulating: |========================                                          |Simulating: |=========================                                         |Simulating: |==========================                                        |Simulating: |===========================                                       |Simulating: |============================                                      |Simulating: |=============================                                     |Simulating: |==============================                                    |Simulating: |===============================                                   |Simulating: |================================                                  |Simulating: |=================================                                 |Simulating: |==================================                                |Simulating: |===================================                               |Simulating: |====================================                              |Simulating: |=====================================                             |Simulating: |======================================                            |Simulating: |=======================================                           |Simulating: |========================================                          |Simulating: |=========================================                         |Simulating: |==========================================                        |Simulating: |===========================================                       |Simulating: |============================================                      |Simulating: |=============================================                     |Simulating: |==============================================                    |Simulating: |===============================================                   |Simulating: |================================================                  |Simulating: |=================================================                 |Simulating: |==================================================                |Simulating: |===================================================               |Simulating: |====================================================              |Simulating: |=====================================================             |Simulating: |======================================================            |Simulating: |=======================================================           |Simulating: |========================================================          |Simulating: |=========================================================         |Simulating: |==========================================================        |Simulating: |===========================================================       |Simulating: |============================================================      |Simulating: |=============================================================     |Simulating: |==============================================================    |Simulating: |===============================================================   |Simulating: |================================================================  |Simulating: |================================================================= |Simulating: |==================================================================|Simulating: |                                                                  |Simulating: |=                                                                 |Simulating: |==                                                                |Simulating: |===                                                               |Simulating: |====                                                              |Simulating: |=====                                                             |Simulating: |======                                                            |Simulating: |=======                                                           |Simulating: |========                                                          |Simulating: |=========                                                         |Simulating: |==========                                                        |Simulating: |===========                                                       |Simulating: |============                                                      |Simulating: |=============                                                     |Simulating: |==============                                                    |Simulating: |===============                                                   |Simulating: |================                                                  |Simulating: |=================                                                 |Simulating: |==================                                                |Simulating: |===================                                               |Simulating: |====================                                              |Simulating: |=====================                                             |Simulating: |======================                                            |Simulating: |=======================                                           |Simulating: |========================                                          |Simulating: |=========================                                         |Simulating: |==========================                                        |Simulating: |===========================                                       |Simulating: |============================                                      |Simulating: |=============================                                     |Simulating: |==============================                                    |Simulating: |===============================                                   |Simulating: |================================                                  |Simulating: |=================================                                 |Simulating: |==================================                                |Simulating: |===================================                               |Simulating: |====================================                              |Simulating: |=====================================                             |Simulating: |======================================                            |Simulating: |=======================================                           |Simulating: |========================================                          |Simulating: |=========================================                         |Simulating: |==========================================                        |Simulating: |===========================================                       |Simulating: |============================================                      |Simulating: |=============================================                     |Simulating: |==============================================                    |Simulating: |===============================================                   |Simulating: |================================================                  |Simulating: |=================================================                 |Simulating: |==================================================                |Simulating: |===================================================               |Simulating: |====================================================              |Simulating: |=====================================================             |Simulating: |======================================================            |Simulating: |=======================================================           |Simulating: |========================================================          |Simulating: |=========================================================         |Simulating: |==========================================================        |Simulating: |===========================================================       |Simulating: |============================================================      |Simulating: |=============================================================     |Simulating: |==============================================================    |Simulating: |===============================================================   |Simulating: |================================================================  |Simulating: |================================================================= |Simulating: |==================================================================|</code></pre>
<pre class="r"><code>plot_power_extend(powers_m5)</code></pre>
<p><img src="/courses/psyc575/rcode12_files/figure-html/powers_m5-2-1.png" width="672" /></p>
<p>Use more time points</p>
<pre class="r"><code># Use the `time_points` argument
powers_m5 &lt;- power_extend(sim_m5, 
                          along = &quot;time&quot;, 
                          time_points = c(4, 8), 
                          nsim = 100)</code></pre>
<pre><code>&gt;# Simulating: |                                                                  |Simulating: |=                                                                 |Simulating: |==                                                                |Simulating: |===                                                               |Simulating: |====                                                              |Simulating: |=====                                                             |Simulating: |======                                                            |Simulating: |=======                                                           |Simulating: |========                                                          |Simulating: |=========                                                         |Simulating: |==========                                                        |Simulating: |===========                                                       |Simulating: |============                                                      |Simulating: |=============                                                     |Simulating: |==============                                                    |Simulating: |===============                                                   |Simulating: |================                                                  |Simulating: |=================                                                 |Simulating: |==================                                                |Simulating: |===================                                               |Simulating: |====================                                              |Simulating: |=====================                                             |Simulating: |======================                                            |Simulating: |=======================                                           |Simulating: |========================                                          |Simulating: |=========================                                         |Simulating: |==========================                                        |Simulating: |===========================                                       |Simulating: |============================                                      |Simulating: |=============================                                     |Simulating: |==============================                                    |Simulating: |===============================                                   |Simulating: |================================                                  |Simulating: |=================================                                 |Simulating: |==================================                                |Simulating: |===================================                               |Simulating: |====================================                              |Simulating: |=====================================                             |Simulating: |======================================                            |Simulating: |=======================================                           |Simulating: |========================================                          |Simulating: |=========================================                         |Simulating: |==========================================                        |Simulating: |===========================================                       |Simulating: |============================================                      |Simulating: |=============================================                     |Simulating: |==============================================                    |Simulating: |===============================================                   |Simulating: |================================================                  |Simulating: |=================================================                 |Simulating: |==================================================                |Simulating: |===================================================               |Simulating: |====================================================              |Simulating: |=====================================================             |Simulating: |======================================================            |Simulating: |=======================================================           |Simulating: |========================================================          |Simulating: |=========================================================         |Simulating: |==========================================================        |Simulating: |===========================================================       |Simulating: |============================================================      |Simulating: |=============================================================     |Simulating: |==============================================================    |Simulating: |===============================================================   |Simulating: |================================================================  |Simulating: |================================================================= |Simulating: |==================================================================|Simulating: |                                                                  |Simulating: |=                                                                 |Simulating: |==                                                                |Simulating: |===                                                               |Simulating: |====                                                              |Simulating: |=====                                                             |Simulating: |======                                                            |Simulating: |=======                                                           |Simulating: |========                                                          |Simulating: |=========                                                         |Simulating: |==========                                                        |Simulating: |===========                                                       |Simulating: |============                                                      |Simulating: |=============                                                     |Simulating: |==============                                                    |Simulating: |===============                                                   |Simulating: |================                                                  |Simulating: |=================                                                 |Simulating: |==================                                                |Simulating: |===================                                               |Simulating: |====================                                              |Simulating: |=====================                                             |Simulating: |======================                                            |Simulating: |=======================                                           |Simulating: |========================                                          |Simulating: |=========================                                         |Simulating: |==========================                                        |Simulating: |===========================                                       |Simulating: |============================                                      |Simulating: |=============================                                     |Simulating: |==============================                                    |Simulating: |===============================                                   |Simulating: |================================                                  |Simulating: |=================================                                 |Simulating: |==================================                                |Simulating: |===================================                               |Simulating: |====================================                              |Simulating: |=====================================                             |Simulating: |======================================                            |Simulating: |=======================================                           |Simulating: |========================================                          |Simulating: |=========================================                         |Simulating: |==========================================                        |Simulating: |===========================================                       |Simulating: |============================================                      |Simulating: |=============================================                     |Simulating: |==============================================                    |Simulating: |===============================================                   |Simulating: |================================================                  |Simulating: |=================================================                 |Simulating: |==================================================                |Simulating: |===================================================               |Simulating: |====================================================              |Simulating: |=====================================================             |Simulating: |======================================================            |Simulating: |=======================================================           |Simulating: |========================================================          |Simulating: |=========================================================         |Simulating: |==========================================================        |Simulating: |===========================================================       |Simulating: |============================================================      |Simulating: |=============================================================     |Simulating: |==============================================================    |Simulating: |===============================================================   |Simulating: |================================================================  |Simulating: |================================================================= |Simulating: |==================================================================|</code></pre>
<pre class="r"><code>plot_power_extend(powers_m5)</code></pre>
<p><img src="/courses/psyc575/rcode12_files/figure-html/powers_m5-3-1.png" width="672" /></p>
<p>Increasing number of time points does not help the power with the intercept difference. Now let’s look at the slope difference.</p>
<pre class="r"><code># Use the `time_points` argument
powers_m5 &lt;- power_extend(sim_m5, 
                          along = &quot;time&quot;, 
                          time_points = c(4, 8), 
                          nsim = 100, 
                          test = fixed(&quot;treat:time&quot;, 
                                       method = &quot;anova&quot;))</code></pre>
<pre><code>&gt;# Simulating: |                                                                  |Simulating: |=                                                                 |Simulating: |==                                                                |Simulating: |===                                                               |Simulating: |====                                                              |Simulating: |=====                                                             |Simulating: |======                                                            |Simulating: |=======                                                           |Simulating: |========                                                          |Simulating: |=========                                                         |Simulating: |==========                                                        |Simulating: |===========                                                       |Simulating: |============                                                      |Simulating: |=============                                                     |Simulating: |==============                                                    |Simulating: |===============                                                   |Simulating: |================                                                  |Simulating: |=================                                                 |Simulating: |==================                                                |Simulating: |===================                                               |Simulating: |====================                                              |Simulating: |=====================                                             |Simulating: |======================                                            |Simulating: |=======================                                           |Simulating: |========================                                          |Simulating: |=========================                                         |Simulating: |==========================                                        |Simulating: |===========================                                       |Simulating: |============================                                      |Simulating: |=============================                                     |Simulating: |==============================                                    |Simulating: |===============================                                   |Simulating: |================================                                  |Simulating: |=================================                                 |Simulating: |==================================                                |Simulating: |===================================                               |Simulating: |====================================                              |Simulating: |=====================================                             |Simulating: |======================================                            |Simulating: |=======================================                           |Simulating: |========================================                          |Simulating: |=========================================                         |Simulating: |==========================================                        |Simulating: |===========================================                       |Simulating: |============================================                      |Simulating: |=============================================                     |Simulating: |==============================================                    |Simulating: |===============================================                   |Simulating: |================================================                  |Simulating: |=================================================                 |Simulating: |==================================================                |Simulating: |===================================================               |Simulating: |====================================================              |Simulating: |=====================================================             |Simulating: |======================================================            |Simulating: |=======================================================           |Simulating: |========================================================          |Simulating: |=========================================================         |Simulating: |==========================================================        |Simulating: |===========================================================       |Simulating: |============================================================      |Simulating: |=============================================================     |Simulating: |==============================================================    |Simulating: |===============================================================   |Simulating: |================================================================  |Simulating: |================================================================= |Simulating: |==================================================================|Simulating: |                                                                  |Simulating: |=                                                                 |Simulating: |==                                                                |Simulating: |===                                                               |Simulating: |====                                                              |Simulating: |=====                                                             |Simulating: |======                                                            |Simulating: |=======                                                           |Simulating: |========                                                          |Simulating: |=========                                                         |Simulating: |==========                                                        |Simulating: |===========                                                       |Simulating: |============                                                      |Simulating: |=============                                                     |Simulating: |==============                                                    |Simulating: |===============                                                   |Simulating: |================                                                  |Simulating: |=================                                                 |Simulating: |==================                                                |Simulating: |===================                                               |Simulating: |====================                                              |Simulating: |=====================                                             |Simulating: |======================                                            |Simulating: |=======================                                           |Simulating: |========================                                          |Simulating: |=========================                                         |Simulating: |==========================                                        |Simulating: |===========================                                       |Simulating: |============================                                      |Simulating: |=============================                                     |Simulating: |==============================                                    |Simulating: |===============================                                   |Simulating: |================================                                  |Simulating: |=================================                                 |Simulating: |==================================                                |Simulating: |===================================                               |Simulating: |====================================                              |Simulating: |=====================================                             |Simulating: |======================================                            |Simulating: |=======================================                           |Simulating: |========================================                          |Simulating: |=========================================                         |Simulating: |==========================================                        |Simulating: |===========================================                       |Simulating: |============================================                      |Simulating: |=============================================                     |Simulating: |==============================================                    |Simulating: |===============================================                   |Simulating: |================================================                  |Simulating: |=================================================                 |Simulating: |==================================================                |Simulating: |===================================================               |Simulating: |====================================================              |Simulating: |=====================================================             |Simulating: |======================================================            |Simulating: |=======================================================           |Simulating: |========================================================          |Simulating: |=========================================================         |Simulating: |==========================================================        |Simulating: |===========================================================       |Simulating: |============================================================      |Simulating: |=============================================================     |Simulating: |==============================================================    |Simulating: |===============================================================   |Simulating: |================================================================  |Simulating: |================================================================= |Simulating: |==================================================================|</code></pre>
<pre class="r"><code>plot_power_extend(powers_m5)</code></pre>
<p><img src="/courses/psyc575/rcode12_files/figure-html/powers_m5-4-1.png" width="672" /></p>
</div>
</div>
