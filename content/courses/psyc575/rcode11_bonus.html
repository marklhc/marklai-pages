---
title: Bonus R Codes for Week 12
linktitle: Bonus R Codes (wk 12)
type: docs
date: "2020-10-25T11:39:00+01:00"
draft: false
lastmod: '2020-11-04'
rmd: "rcodes/week12-bonus"
menu:
  psyc575:
    parent: Week 12
    weight: 3
output:
  blogdown::html_page:
    toc: true
    df_print: paged
header-includes:
  - \newcommand{\bv}[1]{\boldsymbol{\mathbf{#1}}}
# Prev/next pager order (if `docs_section_pager` enabled in `params.toml`)
weight: 2
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>
<link href="/rmarkdown-libs/pagedtable/css/pagedtable.css" rel="stylesheet" />
<script src="/rmarkdown-libs/pagedtable/js/pagedtable.js"></script>
<link href="/rmarkdown-libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<script src="/rmarkdown-libs/anchor-sections/anchor-sections.js"></script>

<div id="TOC">
<ul>
<li><a href="#load-packages">Load Packages</a></li>
<li><a href="#binomial-logistic-model">Binomial Logistic Model</a>
<ul>
<li><a href="#data-description">Data Description</a>
<ul>
<li><a href="#data-import">Data Import</a></li>
<li><a href="#plotting">Plotting</a></li>
</ul></li>
<li><a href="#model-1">Model 1</a>
<ul>
<li><a href="#plotting-the-output">Plotting the Output</a></li>
<li><a href="#interpretation">Interpretation</a></li>
</ul></li>
</ul></li>
<li><a href="#poisson">Poisson</a>
<ul>
<li><a href="#sample-growth-model">Sample Growth Model</a>
<ul>
<li><a href="#model-equations">Model equations</a></li>
<li><a href="#fitting-in-brms">Fitting in <code>brms</code></a></li>
<li><a href="#plotting-the-output-1">Plotting the Output</a></li>
<li><a href="#interpretation-1">Interpretation</a></li>
<li><a href="#predictive-check">Predictive Check</a></li>
</ul></li>
</ul></li>
</ul>
</div>

{{% rmd-buttons %}}
<div id="load-packages" class="section level2">
<h2>Load Packages</h2>
<pre class="r"><code># To install a package, run the following ONCE (and only once on your computer)
# install.packages(&quot;psych&quot;)  
library(here)  # makes reading data more consistent
library(tidyverse)  # for data manipulation and plotting
library(haven)  # for importing SPSS/SAS/Stata data
library(brms)  # for Bayesian multilevel analysis
# (Optional) Set multiple cores in global option
options(mc.cores = min(parallel::detectCores() - 1, 2L))
library(broom.mixed)  # for summarizing results
library(modelsummary)  # for making tables
theme_set(theme_bw())  # Theme; just my personal preference</code></pre>
</div>
<div id="binomial-logistic-model" class="section level1">
<h1>Binomial Logistic Model</h1>
<div id="data-description" class="section level2">
<h2>Data Description</h2>
<p>In our first example, we’ll use data from a cluster-randomized trial by <a href="https://www.sciencedirect.com/science/article/abs/pii/S0022103117300860">Devine et al. (2017)</a>. The authors have kindly made their data open access at <a href="https://osf.io/yd72p/" class="uri">https://osf.io/yd72p/</a>. The study evaluated a habit-breaking intervention at the University of Wisconsin–Madison that aimed to promote gender equity in hiring practices. You can find more description of the intervention from <a href="https://ars-els-cdn-com.libproxy2.usc.edu/content/image/1-s2.0-S0022103117300860-gr1_lrg.jpg">this graph</a>.</p>
<p>In the study, 98 departments formed 92 clusters (with some smaller departments combined into clusters). Those 92 clusters formed 46 pairs, and one unit in each pair was randomly assigned to the intervention condition while the other unit in the same pair was assigned to the control condition. The main outcome was the proportion of female new hires post-manipulation.</p>
<p>Because the clusters were matched in pairs in terms of size, disciplines, etc, units within the same pair were by design more similar to each other than units from different pairs. Therefore, matching induces dependency in the data, which should be handled by treating the matched pairs as a level of clustering.</p>
<blockquote>
<p>Matching induces dependency in the data, which should be handled by treating the matched pairs as a level of clustering.</p>
</blockquote>
<div id="data-import" class="section level3">
<h3>Data Import</h3>
<p>The data can be downloaded and imported using the <code>read_csv()</code> function.</p>
<pre class="r"><code># Data from OSF
hiring_dat &lt;- read_csv(&quot;https://osf.io/yd72p/download&quot;)</code></pre>
<pre><code>&gt;# 
&gt;# ── Column specification ────────────────────────────────────────────────────────
&gt;# cols(
&gt;#   .default = col_double(),
&gt;#   DEPTDIV = col_character()
&gt;# )
&gt;# ℹ Use `spec()` for the full column specifications.</code></pre>
<p>And then some pre-processing, including computing the number of new female hires (by adding up the subcategories).</p>
<pre class="r"><code>hiring_dat &lt;- hiring_dat %&gt;% 
  mutate(
    # Compute number of female hires
    num_female_hires = NH_NumFacURMF + NH_NumFacAsianF + NH_NumFacWHF, 
    # Also recode EXPDEPT and POST to factors
    EXPDEPT = factor(EXPDEPT, levels = c(0, 1), 
                     labels = c(&quot;control&quot;, &quot;intervention&quot;)), 
    POST = factor(POST, levels = c(0, 1), 
                  labels = c(&quot;pre&quot;, &quot;post&quot;)))</code></pre>
<p>Note that the data contain both pre-manipulation and post-manipulation information, so the department is another level of clustering (as the lowest level is repeated measure). For simplicity, we first focus only on the post-manipulation data.</p>
<pre class="r"><code>hiring_post &lt;- hiring_dat %&gt;% 
  filter(POST == &quot;post&quot;)
hiring_post</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["DEPT_RAND"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["PAIR_RAND"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["EXPDEPT"],"name":[3],"type":["fct"],"align":["left"]},{"label":["GT25"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["NOATT"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["NEWDEPT"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["DEPTDIV"],"name":[7],"type":["chr"],"align":["left"]},{"label":["CLINICAL"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["HIRING"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["NumFac"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["NumFacWHF"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["NumFacWhM"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["NumFacURMF"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["NumFacURMM"],"name":[14],"type":["dbl"],"align":["right"]},{"label":["NumFacAsianF"],"name":[15],"type":["dbl"],"align":["right"]},{"label":["NumFacAsianM"],"name":[16],"type":["dbl"],"align":["right"]},{"label":["NH_NumFac"],"name":[17],"type":["dbl"],"align":["right"]},{"label":["NH_NumFacWHF"],"name":[18],"type":["dbl"],"align":["right"]},{"label":["NH_NumFacWhM"],"name":[19],"type":["dbl"],"align":["right"]},{"label":["NH_NumFacURMF"],"name":[20],"type":["dbl"],"align":["right"]},{"label":["NH_NumFacURMM"],"name":[21],"type":["dbl"],"align":["right"]},{"label":["NH_NumFacAsianF"],"name":[22],"type":["dbl"],"align":["right"]},{"label":["NH_NumFacAsianM"],"name":[23],"type":["dbl"],"align":["right"]},{"label":["Att_NumFac"],"name":[24],"type":["dbl"],"align":["right"]},{"label":["Att_NumFacWHF"],"name":[25],"type":["dbl"],"align":["right"]},{"label":["Att_NumFacWhM"],"name":[26],"type":["dbl"],"align":["right"]},{"label":["Att_NumFacURMF"],"name":[27],"type":["dbl"],"align":["right"]},{"label":["Att_NumFacURMM"],"name":[28],"type":["dbl"],"align":["right"]},{"label":["Att_NumFacAsianF"],"name":[29],"type":["dbl"],"align":["right"]},{"label":["Att_NumFacAsianM"],"name":[30],"type":["dbl"],"align":["right"]},{"label":["POST"],"name":[31],"type":["fct"],"align":["left"]},{"label":["num_female_hires"],"name":[32],"type":["dbl"],"align":["right"]}],"data":[{"1":"11","2":"45","3":"control","4":"0","5":"0","6":"0","7":"B","8":"0","9":"0","10":"19","11":"3","12":"16","13":"0","14":"0","15":"0","16":"0","17":"0","18":"0","19":"0","20":"0","21":"0","22":"0","23":"0","24":"1","25":"1","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"27","2":"86","3":"intervention","4":"1","5":"0","6":"0","7":"P","8":"0","9":"0","10":"13","11":"4","12":"7","13":"0","14":"1","15":"1","16":"0","17":"3","18":"0","19":"1","20":"0","21":"1","22":"0","23":"1","24":"2","25":"1","26":"1","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"31","2":"91","3":"intervention","4":"1","5":"0","6":"0","7":"B","8":"1","9":"0","10":"2","11":"0","12":"2","13":"0","14":"0","15":"0","16":"0","17":"0","18":"0","19":"0","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"37","2":"42","3":"control","4":"0","5":"0","6":"0","7":"B","8":"0","9":"0","10":"34","11":"7","12":"25","13":"0","14":"1","15":"0","16":"1","17":"1","18":"1","19":"0","20":"0","21":"0","22":"0","23":"0","24":"4","25":"0","26":"4","27":"0","28":"0","29":"0","30":"0","31":"post","32":"1"},{"1":"63","2":"85","3":"intervention","4":"0","5":"0","6":"0","7":"B","8":"0","9":"1","10":"18","11":"6","12":"8","13":"0","14":"1","15":"1","16":"2","17":"4","18":"0","19":"2","20":"0","21":"1","22":"1","23":"0","24":"3","25":"1","26":"0","27":"0","28":"1","29":"1","30":"0","31":"post","32":"1"},{"1":"74","2":"90","3":"control","4":"0","5":"0","6":"1","7":"B","8":"1","9":"1","10":"0","11":"0","12":"0","13":"0","14":"0","15":"0","16":"0","17":"0","18":"0","19":"0","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"101","2":"96","3":"intervention","4":"1","5":"0","6":"0","7":"S","8":"0","9":"1","10":"9","11":"4","12":"3","13":"1","14":"0","15":"1","16":"0","17":"1","18":"0","19":"1","20":"0","21":"0","22":"0","23":"0","24":"2","25":"1","26":"1","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"119","2":"12","3":"control","4":"0","5":"0","6":"0","7":"S","8":"0","9":"0","10":"4","11":"1","12":"3","13":"0","14":"0","15":"0","16":"0","17":"0","18":"0","19":"0","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"132","2":"21","3":"intervention","4":"1","5":"0","6":"0","7":"B","8":"1","9":"0","10":"3","11":"1","12":"2","13":"0","14":"0","15":"0","16":"0","17":"0","18":"0","19":"0","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"139","2":"44","3":"intervention","4":"0","5":"0","6":"0","7":"B","8":"1","9":"0","10":"14","11":"3","12":"10","13":"0","14":"0","15":"1","16":"0","17":"3","18":"1","19":"2","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"1"},{"1":"142","2":"77","3":"control","4":"0","5":"0","6":"0","7":"B","8":"1","9":"0","10":"4","11":"2","12":"2","13":"0","14":"0","15":"0","16":"0","17":"0","18":"0","19":"0","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"147","2":"31","3":"intervention","4":"0","5":"0","6":"0","7":"P","8":"0","9":"0","10":"17","11":"3","12":"8","13":"1","14":"0","15":"1","16":"4","17":"3","18":"1","19":"1","20":"0","21":"0","22":"0","23":"1","24":"2","25":"0","26":"1","27":"1","28":"0","29":"0","30":"0","31":"post","32":"1"},{"1":"182","2":"3","3":"control","4":"0","5":"0","6":"0","7":"B","8":"1","9":"0","10":"5","11":"1","12":"4","13":"0","14":"0","15":"0","16":"0","17":"3","18":"1","19":"2","20":"0","21":"0","22":"0","23":"0","24":"1","25":"0","26":"1","27":"0","28":"0","29":"0","30":"0","31":"post","32":"1"},{"1":"185","2":"41","3":"control","4":"0","5":"0","6":"0","7":"B","8":"1","9":"0","10":"12","11":"6","12":"5","13":"0","14":"0","15":"0","16":"1","17":"1","18":"0","19":"1","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"186","2":"21","3":"control","4":"0","5":"0","6":"0","7":"B","8":"1","9":"0","10":"0","11":"0","12":"0","13":"0","14":"0","15":"0","16":"0","17":"0","18":"0","19":"0","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"187","2":"83","3":"control","4":"0","5":"0","6":"1","7":"B","8":"0","9":"0","10":"15","11":"5","12":"8","13":"0","14":"1","15":"1","16":"0","17":"2","18":"1","19":"0","20":"0","21":"0","22":"1","23":"0","24":"1","25":"0","26":"0","27":"0","28":"1","29":"0","30":"0","31":"post","32":"2"},{"1":"193","2":"65","3":"control","4":"0","5":"0","6":"0","7":"P","8":"0","9":"0","10":"12","11":"4","12":"7","13":"0","14":"1","15":"0","16":"0","17":"1","18":"1","19":"0","20":"0","21":"0","22":"0","23":"0","24":"1","25":"0","26":"1","27":"0","28":"0","29":"0","30":"0","31":"post","32":"1"},{"1":"212","2":"41","3":"intervention","4":"1","5":"0","6":"0","7":"B","8":"0","9":"1","10":"23","11":"9","12":"10","13":"1","14":"2","15":"0","16":"1","17":"4","18":"2","19":"0","20":"1","21":"0","22":"1","23":"0","24":"3","25":"1","26":"2","27":"0","28":"0","29":"0","30":"0","31":"post","32":"4"},{"1":"218","2":"65","3":"intervention","4":"1","5":"0","6":"0","7":"P","8":"0","9":"1","10":"40","11":"5","12":"30","13":"0","14":"0","15":"0","16":"5","17":"4","18":"0","19":"1","20":"0","21":"1","22":"2","23":"0","24":"2","25":"0","26":"2","27":"0","28":"0","29":"0","30":"0","31":"post","32":"2"},{"1":"226","2":"22","3":"control","4":"0","5":"0","6":"0","7":"P","8":"0","9":"0","10":"33","11":"3","12":"26","13":"0","14":"1","15":"0","16":"3","17":"4","18":"1","19":"2","20":"0","21":"0","22":"0","23":"1","24":"7","25":"1","26":"5","27":"0","28":"0","29":"0","30":"1","31":"post","32":"1"},{"1":"249","2":"97","3":"control","4":"0","5":"0","6":"0","7":"B","8":"1","9":"0","10":"0","11":"0","12":"0","13":"0","14":"0","15":"0","16":"0","17":"0","18":"0","19":"0","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"251","2":"49","3":"intervention","4":"1","5":"0","6":"0","7":"B","8":"1","9":"0","10":"12","11":"3","12":"5","13":"1","14":"0","15":"0","16":"3","17":"1","18":"0","19":"1","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"277","2":"38","3":"intervention","4":"1","5":"0","6":"0","7":"B","8":"1","9":"1","10":"6","11":"0","12":"5","13":"0","14":"0","15":"1","16":"0","17":"2","18":"2","19":"0","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"2"},{"1":"284","2":"38","3":"control","4":"0","5":"0","6":"0","7":"B","8":"1","9":"0","10":"1","11":"0","12":"1","13":"0","14":"0","15":"0","16":"0","17":"2","18":"1","19":"1","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"1"},{"1":"285","2":"68","3":"intervention","4":"0","5":"0","6":"0","7":"S","8":"0","9":"1","10":"36","11":"7","12":"25","13":"0","14":"2","15":"1","16":"1","17":"7","18":"4","19":"2","20":"0","21":"0","22":"0","23":"1","24":"7","25":"2","26":"3","27":"0","28":"1","29":"0","30":"1","31":"post","32":"4"},{"1":"312","2":"37","3":"control","4":"0","5":"0","6":"0","7":"B","8":"0","9":"1","10":"14","11":"7","12":"7","13":"0","14":"0","15":"0","16":"0","17":"1","18":"0","19":"1","20":"0","21":"0","22":"0","23":"0","24":"1","25":"0","26":"1","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"313","2":"83","3":"intervention","4":"0","5":"0","6":"1","7":"B","8":"0","9":"0","10":"28","11":"7","12":"15","13":"0","14":"0","15":"0","16":"6","17":"1","18":"1","19":"0","20":"0","21":"0","22":"0","23":"0","24":"4","25":"2","26":"2","27":"0","28":"0","29":"0","30":"0","31":"post","32":"1"},{"1":"323","2":"77","3":"intervention","4":"0","5":"0","6":"0","7":"B","8":"1","9":"0","10":"2","11":"0","12":"1","13":"0","14":"0","15":"0","16":"1","17":"0","18":"0","19":"0","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"343","2":"44","3":"control","4":"0","5":"0","6":"0","7":"B","8":"1","9":"0","10":"11","11":"3","12":"6","13":"0","14":"0","15":"0","16":"2","17":"0","18":"0","19":"0","20":"0","21":"0","22":"0","23":"0","24":"2","25":"0","26":"2","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"347","2":"82","3":"intervention","4":"0","5":"0","6":"0","7":"B","8":"1","9":"0","10":"10","11":"0","12":"10","13":"0","14":"0","15":"0","16":"0","17":"6","18":"0","19":"4","20":"0","21":"0","22":"0","23":"2","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"369","2":"3","3":"intervention","4":"1","5":"0","6":"0","7":"B","8":"1","9":"0","10":"2","11":"1","12":"1","13":"0","14":"0","15":"0","16":"0","17":"2","18":"2","19":"0","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"2"},{"1":"375","2":"71","3":"intervention","4":"0","5":"0","6":"0","7":"B","8":"0","9":"1","10":"11","11":"1","12":"7","13":"1","14":"2","15":"0","16":"0","17":"2","18":"2","19":"0","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"2"},{"1":"377","2":"73","3":"intervention","4":"1","5":"0","6":"0","7":"S","8":"0","9":"1","10":"18","11":"5","12":"8","13":"1","14":"1","15":"1","16":"2","17":"5","18":"3","19":"2","20":"0","21":"0","22":"0","23":"0","24":"2","25":"1","26":"1","27":"0","28":"0","29":"0","30":"0","31":"post","32":"3"},{"1":"383","2":"71","3":"control","4":"0","5":"0","6":"0","7":"B","8":"0","9":"0","10":"19","11":"2","12":"13","13":"0","14":"4","15":"0","16":"0","17":"1","18":"0","19":"0","20":"0","21":"0","22":"0","23":"1","24":"3","25":"2","26":"1","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"394","2":"91","3":"control","4":"0","5":"0","6":"0","7":"P","8":"0","9":"0","10":"5","11":"0","12":"5","13":"0","14":"0","15":"0","16":"0","17":"1","18":"0","19":"1","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"396","2":"31","3":"control","4":"0","5":"0","6":"0","7":"P","8":"0","9":"1","10":"23","11":"3","12":"14","13":"0","14":"3","15":"0","16":"3","17":"7","18":"1","19":"4","20":"0","21":"1","22":"1","23":"0","24":"4","25":"1","26":"3","27":"0","28":"0","29":"0","30":"0","31":"post","32":"2"},{"1":"397","2":"96","3":"control","4":"0","5":"0","6":"0","7":"S","8":"0","9":"1","10":"15","11":"4","12":"8","13":"0","14":"1","15":"0","16":"2","17":"1","18":"0","19":"1","20":"0","21":"0","22":"0","23":"0","24":"4","25":"0","26":"3","27":"0","28":"0","29":"0","30":"1","31":"post","32":"0"},{"1":"413","2":"83","3":"control","4":"0","5":"0","6":"0","7":"B","8":"0","9":"0","10":"13","11":"2","12":"9","13":"1","14":"0","15":"0","16":"1","17":"3","18":"2","19":"1","20":"0","21":"0","22":"0","23":"0","24":"2","25":"0","26":"2","27":"0","28":"0","29":"0","30":"0","31":"post","32":"2"},{"1":"427","2":"11","3":"intervention","4":"1","5":"0","6":"0","7":"B","8":"0","9":"1","10":"16","11":"5","12":"8","13":"2","14":"0","15":"0","16":"1","17":"2","18":"2","19":"0","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"2"},{"1":"428","2":"98","3":"control","4":"0","5":"0","6":"0","7":"S","8":"0","9":"1","10":"15","11":"8","12":"4","13":"2","14":"1","15":"0","16":"0","17":"3","18":"1","19":"1","20":"0","21":"0","22":"0","23":"1","24":"2","25":"1","26":"0","27":"1","28":"0","29":"0","30":"0","31":"post","32":"1"},{"1":"439","2":"45","3":"intervention","4":"1","5":"0","6":"0","7":"B","8":"0","9":"1","10":"12","11":"2","12":"8","13":"0","14":"0","15":"2","16":"0","17":"2","18":"1","19":"1","20":"0","21":"0","22":"0","23":"0","24":"2","25":"1","26":"0","27":"0","28":"0","29":"1","30":"0","31":"post","32":"1"},{"1":"450","2":"93","3":"intervention","4":"0","5":"0","6":"0","7":"P","8":"0","9":"1","10":"40","11":"4","12":"24","13":"0","14":"0","15":"2","16":"10","17":"0","18":"0","19":"0","20":"0","21":"0","22":"0","23":"0","24":"6","25":"2","26":"2","27":"0","28":"0","29":"1","30":"1","31":"post","32":"0"},{"1":"454","2":"56","3":"intervention","4":"0","5":"1","6":"0","7":"S","8":"0","9":"1","10":"16","11":"3","12":"11","13":"1","14":"0","15":"0","16":"1","17":"3","18":"1","19":"1","20":"0","21":"0","22":"1","23":"0","24":"1","25":"1","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"2"},{"1":"468","2":"69","3":"control","4":"0","5":"0","6":"0","7":"P","8":"0","9":"0","10":"19","11":"2","12":"15","13":"0","14":"1","15":"0","16":"1","17":"2","18":"0","19":"1","20":"0","21":"0","22":"0","23":"1","24":"2","25":"0","26":"1","27":"0","28":"1","29":"0","30":"0","31":"post","32":"0"},{"1":"473","2":"85","3":"control","4":"0","5":"0","6":"0","7":"B","8":"0","9":"1","10":"14","11":"6","12":"7","13":"1","14":"0","15":"0","16":"0","17":"4","18":"1","19":"3","20":"0","21":"0","22":"0","23":"0","24":"2","25":"0","26":"2","27":"0","28":"0","29":"0","30":"0","31":"post","32":"1"},{"1":"491","2":"60","3":"intervention","4":"1","5":"0","6":"0","7":"B","8":"1","9":"1","10":"17","11":"4","12":"11","13":"0","14":"0","15":"1","16":"1","17":"1","18":"0","19":"0","20":"1","21":"0","22":"0","23":"0","24":"1","25":"0","26":"1","27":"0","28":"0","29":"0","30":"0","31":"post","32":"1"},{"1":"503","2":"42","3":"intervention","4":"1","5":"0","6":"0","7":"B","8":"0","9":"0","10":"14","11":"1","12":"6","13":"1","14":"2","15":"1","16":"3","17":"0","18":"0","19":"0","20":"0","21":"0","22":"0","23":"0","24":"1","25":"0","26":"1","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"507","2":"54","3":"intervention","4":"1","5":"0","6":"0","7":"B","8":"1","9":"0","10":"5","11":"0","12":"4","13":"0","14":"0","15":"0","16":"1","17":"1","18":"0","19":"1","20":"0","21":"0","22":"0","23":"0","24":"1","25":"0","26":"1","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"508","2":"19","3":"intervention","4":"0","5":"0","6":"0","7":"B","8":"0","9":"0","10":"21","11":"2","12":"11","13":"0","14":"1","15":"2","16":"5","17":"3","18":"0","19":"1","20":"0","21":"1","22":"1","23":"0","24":"2","25":"0","26":"2","27":"0","28":"0","29":"0","30":"0","31":"post","32":"1"},{"1":"509","2":"20","3":"control","4":"0","5":"0","6":"0","7":"B","8":"0","9":"0","10":"7","11":"2","12":"3","13":"0","14":"1","15":"1","16":"0","17":"2","18":"0","19":"1","20":"1","21":"0","22":"0","23":"0","24":"1","25":"0","26":"0","27":"0","28":"1","29":"0","30":"0","31":"post","32":"1"},{"1":"523","2":"78","3":"intervention","4":"1","5":"0","6":"0","7":"S","8":"0","9":"1","10":"18","11":"2","12":"13","13":"0","14":"1","15":"1","16":"1","17":"3","18":"0","19":"3","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"524","2":"10","3":"intervention","4":"0","5":"0","6":"0","7":"P","8":"0","9":"0","10":"14","11":"2","12":"9","13":"0","14":"0","15":"0","16":"3","17":"2","18":"0","19":"1","20":"0","21":"0","22":"0","23":"1","24":"1","25":"0","26":"1","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"533","2":"13","3":"intervention","4":"0","5":"1","6":"0","7":"P","8":"0","9":"0","10":"15","11":"2","12":"9","13":"0","14":"1","15":"0","16":"3","17":"0","18":"0","19":"0","20":"0","21":"0","22":"0","23":"0","24":"2","25":"0","26":"2","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"537","2":"49","3":"control","4":"0","5":"0","6":"0","7":"B","8":"1","9":"0","10":"8","11":"2","12":"5","13":"0","14":"1","15":"0","16":"0","17":"3","18":"1","19":"1","20":"0","21":"0","22":"1","23":"0","24":"1","25":"0","26":"1","27":"0","28":"0","29":"0","30":"0","31":"post","32":"2"},{"1":"548","2":"10","3":"control","4":"0","5":"0","6":"0","7":"P","8":"0","9":"0","10":"16","11":"2","12":"10","13":"0","14":"2","15":"1","16":"1","17":"1","18":"0","19":"1","20":"0","21":"0","22":"0","23":"0","24":"3","25":"1","26":"1","27":"0","28":"1","29":"0","30":"0","31":"post","32":"0"},{"1":"550","2":"53","3":"control","4":"0","5":"0","6":"0","7":"B","8":"1","9":"1","10":"21","11":"1","12":"16","13":"0","14":"0","15":"0","16":"4","17":"2","18":"1","19":"1","20":"0","21":"0","22":"0","23":"0","24":"3","25":"0","26":"3","27":"0","28":"0","29":"0","30":"0","31":"post","32":"1"},{"1":"556","2":"73","3":"control","4":"0","5":"0","6":"0","7":"S","8":"0","9":"0","10":"8","11":"3","12":"3","13":"2","14":"0","15":"0","16":"0","17":"0","18":"0","19":"0","20":"0","21":"0","22":"0","23":"0","24":"1","25":"1","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"569","2":"42","3":"intervention","4":"1","5":"0","6":"0","7":"B","8":"0","9":"1","10":"20","11":"4","12":"12","13":"1","14":"2","15":"0","16":"1","17":"2","18":"0","19":"1","20":"0","21":"0","22":"1","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"1"},{"1":"604","2":"13","3":"control","4":"0","5":"0","6":"0","7":"P","8":"0","9":"1","10":"20","11":"3","12":"15","13":"0","14":"0","15":"0","16":"2","17":"2","18":"0","19":"1","20":"0","21":"1","22":"0","23":"0","24":"1","25":"0","26":"1","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"609","2":"12","3":"control","4":"0","5":"0","6":"0","7":"S","8":"0","9":"0","10":"4","11":"0","12":"3","13":"0","14":"1","15":"0","16":"0","17":"0","18":"0","19":"0","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"621","2":"67","3":"intervention","4":"1","5":"0","6":"0","7":"B","8":"0","9":"0","10":"17","11":"2","12":"11","13":"0","14":"1","15":"0","16":"3","17":"2","18":"1","19":"0","20":"0","21":"1","22":"0","23":"0","24":"4","25":"1","26":"3","27":"0","28":"0","29":"0","30":"0","31":"post","32":"1"},{"1":"626","2":"30","3":"control","4":"0","5":"0","6":"0","7":"B","8":"1","9":"1","10":"11","11":"4","12":"7","13":"0","14":"0","15":"0","16":"0","17":"5","18":"3","19":"2","20":"0","21":"0","22":"0","23":"0","24":"1","25":"1","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"3"},{"1":"634","2":"20","3":"intervention","4":"1","5":"0","6":"0","7":"B","8":"0","9":"0","10":"10","11":"3","12":"6","13":"1","14":"0","15":"0","16":"0","17":"1","18":"0","19":"0","20":"0","21":"1","22":"0","23":"0","24":"2","25":"0","26":"2","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"637","2":"78","3":"control","4":"0","5":"0","6":"0","7":"S","8":"0","9":"1","10":"36","11":"5","12":"26","13":"0","14":"1","15":"1","16":"3","17":"4","18":"0","19":"3","20":"0","21":"1","22":"0","23":"0","24":"5","25":"1","26":"3","27":"0","28":"1","29":"0","30":"0","31":"post","32":"0"},{"1":"643","2":"82","3":"control","4":"0","5":"0","6":"0","7":"B","8":"1","9":"0","10":"14","11":"1","12":"10","13":"1","14":"0","15":"0","16":"2","17":"3","18":"2","19":"1","20":"0","21":"0","22":"0","23":"0","24":"3","25":"1","26":"2","27":"0","28":"0","29":"0","30":"0","31":"post","32":"2"},{"1":"649","2":"68","3":"control","4":"0","5":"0","6":"0","7":"S","8":"0","9":"0","10":"32","11":"10","12":"17","13":"0","14":"1","15":"2","16":"2","17":"5","18":"2","19":"2","20":"0","21":"1","22":"0","23":"0","24":"8","25":"2","26":"4","27":"0","28":"1","29":"1","30":"0","31":"post","32":"2"},{"1":"661","2":"65","3":"control","4":"0","5":"0","6":"0","7":"P","8":"0","9":"1","10":"44","11":"5","12":"30","13":"0","14":"1","15":"2","16":"6","17":"3","18":"0","19":"2","20":"0","21":"0","22":"0","23":"1","24":"7","25":"1","26":"4","27":"0","28":"1","29":"1","30":"0","31":"post","32":"0"},{"1":"671","2":"79","3":"control","4":"0","5":"0","6":"0","7":"B","8":"0","9":"0","10":"18","11":"4","12":"10","13":"0","14":"0","15":"0","16":"4","17":"6","18":"2","19":"1","20":"0","21":"0","22":"2","23":"1","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"4"},{"1":"673","2":"11","3":"control","4":"0","5":"0","6":"0","7":"B","8":"0","9":"0","10":"20","11":"6","12":"13","13":"0","14":"0","15":"1","16":"0","17":"1","18":"0","19":"1","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"676","2":"30","3":"intervention","4":"0","5":"0","6":"0","7":"B","8":"1","9":"0","10":"4","11":"1","12":"3","13":"0","14":"0","15":"0","16":"0","17":"1","18":"1","19":"0","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"1"},{"1":"698","2":"47","3":"control","4":"0","5":"0","6":"0","7":"B","8":"1","9":"0","10":"16","11":"1","12":"13","13":"0","14":"0","15":"0","16":"2","17":"3","18":"0","19":"3","20":"0","21":"0","22":"0","23":"0","24":"6","25":"0","26":"6","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"706","2":"60","3":"control","4":"0","5":"0","6":"0","7":"B","8":"1","9":"0","10":"16","11":"6","12":"8","13":"0","14":"1","15":"0","16":"1","17":"2","18":"0","19":"2","20":"0","21":"0","22":"0","23":"0","24":"3","25":"0","26":"3","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"719","2":"47","3":"intervention","4":"1","5":"0","6":"0","7":"B","8":"1","9":"0","10":"8","11":"1","12":"4","13":"0","14":"0","15":"0","16":"3","17":"0","18":"0","19":"0","20":"0","21":"0","22":"0","23":"0","24":"2","25":"1","26":"0","27":"0","28":"0","29":"0","30":"1","31":"post","32":"0"},{"1":"727","2":"69","3":"intervention","4":"1","5":"0","6":"0","7":"P","8":"0","9":"1","10":"24","11":"2","12":"21","13":"0","14":"1","15":"0","16":"0","17":"2","18":"1","19":"1","20":"0","21":"0","22":"0","23":"0","24":"3","25":"0","26":"3","27":"0","28":"0","29":"0","30":"0","31":"post","32":"1"},{"1":"745","2":"79","3":"intervention","4":"1","5":"0","6":"0","7":"P","8":"0","9":"1","10":"21","11":"3","12":"9","13":"0","14":"0","15":"2","16":"7","17":"2","18":"0","19":"1","20":"0","21":"0","22":"0","23":"1","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"748","2":"5","3":"intervention","4":"1","5":"0","6":"0","7":"B","8":"0","9":"0","10":"11","11":"3","12":"5","13":"0","14":"1","15":"1","16":"1","17":"1","18":"1","19":"0","20":"0","21":"0","22":"0","23":"0","24":"1","25":"0","26":"1","27":"0","28":"0","29":"0","30":"0","31":"post","32":"1"},{"1":"754","2":"64","3":"control","4":"0","5":"0","6":"0","7":"S","8":"0","9":"1","10":"19","11":"6","12":"10","13":"1","14":"0","15":"0","16":"2","17":"6","18":"3","19":"2","20":"1","21":"0","22":"0","23":"0","24":"1","25":"0","26":"1","27":"0","28":"0","29":"0","30":"0","31":"post","32":"4"},{"1":"756","2":"54","3":"intervention","4":"0","5":"0","6":"0","7":"B","8":"1","9":"0","10":"21","11":"2","12":"14","13":"0","14":"1","15":"1","16":"3","17":"13","18":"5","19":"6","20":"0","21":"0","22":"0","23":"2","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"5"},{"1":"778","2":"37","3":"intervention","4":"1","5":"0","6":"0","7":"B","8":"0","9":"0","10":"21","11":"3","12":"13","13":"1","14":"0","15":"3","16":"1","17":"0","18":"0","19":"0","20":"0","21":"0","22":"0","23":"0","24":"1","25":"0","26":"1","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"789","2":"100","3":"intervention","4":"0","5":"0","6":"0","7":"B","8":"1","9":"1","10":"3","11":"2","12":"1","13":"0","14":"0","15":"0","16":"0","17":"2","18":"1","19":"0","20":"1","21":"0","22":"0","23":"0","24":"1","25":"0","26":"1","27":"0","28":"0","29":"0","30":"0","31":"post","32":"2"},{"1":"827","2":"77","3":"intervention","4":"0","5":"0","6":"0","7":"B","8":"1","9":"0","10":"7","11":"1","12":"5","13":"0","14":"0","15":"0","16":"1","17":"0","18":"0","19":"0","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"831","2":"86","3":"control","4":"0","5":"0","6":"0","7":"P","8":"0","9":"0","10":"13","11":"2","12":"7","13":"0","14":"0","15":"1","16":"3","17":"1","18":"0","19":"0","20":"0","21":"1","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"834","2":"67","3":"control","4":"0","5":"0","6":"0","7":"B","8":"0","9":"0","10":"15","11":"4","12":"9","13":"1","14":"0","15":"0","16":"1","17":"1","18":"0","19":"1","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"837","2":"56","3":"control","4":"0","5":"0","6":"0","7":"S","8":"0","9":"0","10":"17","11":"6","12":"7","13":"1","14":"0","15":"1","16":"2","17":"3","18":"0","19":"3","20":"0","21":"0","22":"0","23":"0","24":"3","25":"0","26":"2","27":"1","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"838","2":"22","3":"intervention","4":"0","5":"0","6":"0","7":"P","8":"0","9":"0","10":"40","11":"5","12":"26","13":"0","14":"1","15":"0","16":"8","17":"4","18":"1","19":"1","20":"0","21":"0","22":"0","23":"2","24":"7","25":"0","26":"6","27":"0","28":"1","29":"0","30":"0","31":"post","32":"1"},{"1":"862","2":"100","3":"control","4":"0","5":"0","6":"0","7":"B","8":"1","9":"0","10":"25","11":"11","12":"12","13":"0","14":"1","15":"1","16":"0","17":"5","18":"1","19":"3","20":"1","21":"0","22":"0","23":"0","24":"3","25":"2","26":"1","27":"0","28":"0","29":"0","30":"0","31":"post","32":"2"},{"1":"875","2":"19","3":"control","4":"0","5":"0","6":"0","7":"B","8":"0","9":"0","10":"25","11":"1","12":"18","13":"1","14":"0","15":"0","16":"5","17":"3","18":"0","19":"3","20":"0","21":"0","22":"0","23":"0","24":"4","25":"0","26":"4","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"890","2":"5","3":"control","4":"0","5":"0","6":"0","7":"B","8":"0","9":"1","10":"9","11":"1","12":"7","13":"0","14":"0","15":"0","16":"1","17":"3","18":"0","19":"2","20":"0","21":"0","22":"0","23":"1","24":"1","25":"0","26":"1","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"893","2":"12","3":"intervention","4":"1","5":"0","6":"0","7":"S","8":"0","9":"0","10":"7","11":"4","12":"3","13":"0","14":"0","15":"0","16":"0","17":"1","18":"1","19":"0","20":"0","21":"0","22":"0","23":"0","24":"1","25":"1","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"1"},{"1":"897","2":"98","3":"intervention","4":"1","5":"0","6":"0","7":"B","8":"0","9":"0","10":"13","11":"9","12":"4","13":"0","14":"0","15":"0","16":"0","17":"1","18":"1","19":"0","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"1"},{"1":"903","2":"90","3":"intervention","4":"1","5":"0","6":"1","7":"B","8":"1","9":"1","10":"2","11":"1","12":"0","13":"0","14":"0","15":"0","16":"1","17":"0","18":"0","19":"0","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"917","2":"80","3":"control","4":"0","5":"0","6":"0","7":"B","8":"0","9":"0","10":"12","11":"3","12":"7","13":"0","14":"0","15":"0","16":"2","17":"2","18":"1","19":"1","20":"0","21":"0","22":"0","23":"0","24":"2","25":"1","26":"1","27":"0","28":"0","29":"0","30":"0","31":"post","32":"1"},{"1":"929","2":"64","3":"intervention","4":"0","5":"1","6":"0","7":"S","8":"0","9":"1","10":"9","11":"1","12":"2","13":"5","14":"1","15":"0","16":"0","17":"2","18":"0","19":"0","20":"2","21":"0","22":"0","23":"0","24":"1","25":"0","26":"0","27":"1","28":"0","29":"0","30":"0","31":"post","32":"2"},{"1":"931","2":"93","3":"control","4":"0","5":"0","6":"0","7":"P","8":"0","9":"1","10":"46","11":"4","12":"35","13":"1","14":"1","15":"0","16":"5","17":"9","18":"1","19":"6","20":"0","21":"0","22":"0","23":"2","24":"9","25":"0","26":"7","27":"0","28":"0","29":"0","30":"2","31":"post","32":"1"},{"1":"934","2":"54","3":"control","4":"0","5":"0","6":"0","7":"B","8":"1","9":"0","10":"9","11":"2","12":"7","13":"0","14":"0","15":"0","16":"0","17":"1","18":"0","19":"1","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"956","2":"80","3":"intervention","4":"0","5":"0","6":"0","7":"B","8":"0","9":"1","10":"16","11":"2","12":"13","13":"1","14":"0","15":"0","16":"0","17":"0","18":"0","19":"0","20":"0","21":"0","22":"0","23":"0","24":"1","25":"0","26":"1","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"976","2":"53","3":"intervention","4":"0","5":"0","6":"0","7":"B","8":"1","9":"0","10":"7","11":"0","12":"6","13":"0","14":"0","15":"0","16":"1","17":"2","18":"0","19":"2","20":"0","21":"0","22":"0","23":"0","24":"1","25":"0","26":"1","27":"0","28":"0","29":"0","30":"0","31":"post","32":"0"},{"1":"996","2":"97","3":"intervention","4":"1","5":"0","6":"0","7":"B","8":"1","9":"0","10":"7","11":"0","12":"3","13":"0","14":"0","15":"0","16":"4","17":"0","18":"0","19":"0","20":"0","21":"0","22":"0","23":"0","24":"1","25":"0","26":"0","27":"0","28":"0","29":"0","30":"1","31":"post","32":"0"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="plotting" class="section level3">
<h3>Plotting</h3>
<pre class="r"><code>ggplot(hiring_post, aes(x = EXPDEPT, 
                        # Proportion of female new hires
                        y = num_female_hires / NH_NumFac)) + 
  geom_point() + 
  stat_summary(aes(group = PAIR_RAND), geom = &quot;line&quot;) + 
  labs(y = &quot;Proportion of Female New Hires&quot;)</code></pre>
<pre><code>&gt;# Warning: Removed 21 rows containing non-finite values (stat_summary).</code></pre>
<pre><code>&gt;# No summary function supplied, defaulting to `mean_se()`</code></pre>
<pre><code>&gt;# Warning: Removed 21 rows containing missing values (geom_point).</code></pre>
<p><img src="/courses/psyc575/rcode11_bonus_files/figure-html/plot-num-female-hires-1.png" width="672" /></p>
<p>As can be seen, the proportion of female hires seemed to be larger for the intervention condition.</p>
</div>
</div>
<div id="model-1" class="section level2">
<h2>Model 1</h2>
<p>The outcome is a count with a known number of trials, so a good distribution is the binomial distribution. Because the outcome is whether each trial resulted in a female hire, we again use the logit link to model the log odds. The manipulated variable was <code>EXPDEPT</code>. The model equations are</p>
<p>Lv-1:</p>
<p><span class="math display">\[
  \begin{aligned}
    \text{num_female_hires}_{ij} &amp; \sim \text{Binomial}(n_{ij}, \mu_{ij}) \\
    \eta_{ij} &amp; = \text{logit}(\mu_{ij}) \\
    \eta_{ij} &amp; = \beta_{0j} + \beta_{1j} \text{EXPDEPT}_{ij}
  \end{aligned}
\]</span></p>
<p>Lv-2:</p>
<p><span class="math display">\[
\begin{aligned}
  \beta_{0j} &amp; = \gamma_{00} + u_{0j}  \\
  \beta_{1j} &amp; = \gamma_{10} + u_{1j}  \\
  \begin{bmatrix}
    u_{0j} \\
    u_{1j}
  \end{bmatrix} &amp; \sim 
  N\left(
    \begin{bmatrix}
      0 \\
      0
    \end{bmatrix}, 
    \begin{bmatrix}
      \tau^2_0 &amp;  \\
      \tau_{01} &amp; \tau^2_{1}
    \end{bmatrix}
  \right)
\end{aligned}
\]</span></p>
<pre class="r"><code>m1_binomial &lt;- 
  brm(num_female_hires | trials(NH_NumFac) ~ EXPDEPT + 
        (EXPDEPT | PAIR_RAND), 
      data = hiring_post %&gt;% filter(NH_NumFac &gt; 0), 
      family = binomial(&quot;logit&quot;), 
      control = list(adapt_delta = .90), 
      seed = 4090)</code></pre>
<pre><code>&gt;# Compiling Stan program...</code></pre>
<pre><code>&gt;# Start sampling</code></pre>
<pre class="r"><code>summary(m1_binomial)</code></pre>
<pre><code>&gt;#  Family: binomial 
&gt;#   Links: mu = logit 
&gt;# Formula: num_female_hires | trials(NH_NumFac) ~ EXPDEPT + (EXPDEPT | PAIR_RAND) 
&gt;#    Data: hiring_post %&gt;% filter(NH_NumFac &gt; 0) (Number of observations: 77) 
&gt;# Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
&gt;#          total post-warmup samples = 4000
&gt;# 
&gt;# Group-Level Effects: 
&gt;# ~PAIR_RAND (Number of levels: 42) 
&gt;#                                    Estimate Est.Error l-95% CI u-95% CI Rhat
&gt;# sd(Intercept)                          0.56      0.34     0.03     1.32 1.00
&gt;# sd(EXPDEPTintervention)                1.23      0.68     0.09     2.68 1.00
&gt;# cor(Intercept,EXPDEPTintervention)    -0.08      0.53    -0.90     0.92 1.00
&gt;#                                    Bulk_ESS Tail_ESS
&gt;# sd(Intercept)                          1246     1585
&gt;# sd(EXPDEPTintervention)                 688     1337
&gt;# cor(Intercept,EXPDEPTintervention)      974     1998
&gt;# 
&gt;# Population-Level Effects: 
&gt;#                     Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
&gt;# Intercept              -0.87      0.26    -1.44    -0.40 1.00     3219     2039
&gt;# EXPDEPTintervention     0.85      0.43     0.05     1.77 1.00     3051     1740
&gt;# 
&gt;# Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
&gt;# and Tail_ESS are effective sample size measures, and Rhat is the potential
&gt;# scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Two things should be noted. First, in the outcome portion of the formula, the syntax is in the form <code>number_of_success_variable | trials(number_of_trial_variable)</code>. It allows the number of trials to be different across observations, which accommodates our data here as different departments have different number of hires.</p>
<div id="plotting-the-output" class="section level3">
<h3>Plotting the Output</h3>
<pre class="r"><code>random_pairs &lt;- sample(unique(hiring_post$PAIR_RAND), size = 12)
plot(
  conditional_effects(
    m1_binomial, 
    type = &quot;pred&quot;, 
    re_formula = NULL, 
    conditions = tibble(PAIR_RAND = random_pairs)
  ), 
  ncol = 4  # six columns in the plot
)</code></pre>
<pre><code>&gt;# Setting all &#39;trials&#39; variables to 1 by default if not specified otherwise.</code></pre>
<p><img src="/courses/psyc575/rcode11_bonus_files/figure-html/plot-binomial-1.png" width="672" /></p>
</div>
<div id="interpretation" class="section level3">
<h3>Interpretation</h3>
<div id="intercept" class="section level4">
<h4>Intercept</h4>
<p>For the control condition, the average predicted log odds of having a female hire was -0.8726971, 95% CI [-1.438513, -0.3976965].</p>
</div>
<div id="slopes" class="section level4">
<h4>Slopes</h4>
<p>The intervention led to an increase in log odds of a female hire of 0.8519616, 95% CI [0.0475972, 1.7735909].</p>
</div>
<div id="odds-ratio" class="section level4">
<h4>Odds ratio</h4>
<p>The intervention has an odds ratio of a female hire of 2.3442408, 95% CI [1.0487482, 5.891973].</p>
</div>
</div>
</div>
</div>
<div id="poisson" class="section level1">
<h1>Poisson</h1>
<p>Here we’ll use the <code>epilepsy</code> data set. You can get the information of the data from <a href="https://vincentarelbundock.github.io/Rdatasets/doc/HSAUR/epilepsy.html" class="uri">https://vincentarelbundock.github.io/Rdatasets/doc/HSAUR/epilepsy.html</a>). This is a longitudinal data set with 59 patients suffering from epilepsy, with the number of seizures recorded at four time points.</p>
<p>Let’s look at the distribution of the outcome variable, and its relationship with the base rate.</p>
<pre class="r"><code># Get the data from brms
data(&quot;epilepsy&quot;, package = &quot;brms&quot;)
# Distribution
ggplot(epilepsy, aes(x = count)) + 
  geom_histogram()</code></pre>
<pre><code>&gt;# `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="/courses/psyc575/rcode11_bonus_files/figure-html/epilepsy-1.png" width="672" /></p>
<pre class="r"><code># seizure.rate against base
ggplot(epilepsy, aes(x = Base, y = count)) + 
  geom_point() + 
  geom_smooth()</code></pre>
<pre><code>&gt;# `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="/courses/psyc575/rcode11_bonus_files/figure-html/epilepsy-2.png" width="672" /></p>
<p>As you can see, <code>count</code> is not normally distributed, and the association between <code>count</code> and <code>Base</code> were not linear. This is not uncommon. For categorical outcomes, because of the bounded range (0 to 1, 0 to <span class="math inline">\(\infty\)</span>), they tend to relate to other variables in a non-linear way.</p>
<blockquote>
<p>For categorical outcomes, because of the bounded range (0 to 1, 0 to <span class="math inline">\(\infty\)</span>), they tend to relate to other variables in a non-linear way.</p>
</blockquote>
<p>The Poisson distribution is commonly used for counts. The mean of a Poisson distribution is the same as its variance. You can see examples of Poisson distributions <a href="https://en.wikipedia.org/wiki/Poisson_distribution">here</a>.</p>
<p>In a Poisson model, the goal is to model the predicted rate (i.e., count) that the event of interest occurs. In this case, it’s the predicted rate of seizure over the data collection period.</p>
<p>With a Poisson model, a natural link function to use is the log link.</p>
<div id="sample-growth-model" class="section level2">
<h2>Sample Growth Model</h2>
<div id="model-equations" class="section level3">
<h3>Model equations</h3>
<p>Here’s a growth model with <code>visit</code> (i.e., time) predicting <code>count</code>.</p>
<p>Lv-1:</p>
<p><span class="math display">\[
  \begin{aligned}
    \text{count}_{ti} &amp; \sim \text{Poisson}(\mu_{ti}) \\
    \eta_{ti} &amp; = \text{log}(\mu_{ti}) \\
    \eta_{ti} &amp; = \beta_{0i} + \beta_{1i} \text{visit}_{ti} + e_{ti}
  \end{aligned}
\]</span></p>
<p>Lv-2:</p>
<p><span class="math display">\[
\begin{aligned}
  \beta_{0i} &amp; = \gamma_{00} + u_{0i} \\
  \beta_{1i} &amp; = \gamma_{10} + u_{1i}  \\
  \begin{bmatrix}
    u_{0i} \\
    u_{1i}
  \end{bmatrix} &amp; \sim 
  N\left(
    \begin{bmatrix}
      0 \\
      0
    \end{bmatrix}, 
    \begin{bmatrix}
      \tau^2_0 &amp;  \\
      \tau_{01} &amp; \tau^2_{1}
    \end{bmatrix}
  \right)
\end{aligned}
\]</span></p>
</div>
<div id="fitting-in-brms" class="section level3">
<h3>Fitting in <code>brms</code></h3>
<pre class="r"><code># Recode period to start at 0
epilepsy$visit &lt;- as.numeric(as.character(epilepsy$visit)) - 1</code></pre>
<pre class="r"><code>m2_poisson &lt;- 
  brm(count ~ visit + (1 | patient), 
      data = epilepsy, 
      family = poisson(&quot;log&quot;), 
      control = list(adapt_delta = .90), 
      seed = 4090)</code></pre>
<pre><code>&gt;# Compiling Stan program...</code></pre>
<pre><code>&gt;# Trying to compile a simple C file</code></pre>
<pre><code>&gt;# Start sampling</code></pre>
<pre><code>&gt;# Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
&gt;# Running the chains for more iterations may help. See
&gt;# http://mc-stan.org/misc/warnings.html#bulk-ess</code></pre>
<pre class="r"><code>summary(m2_poisson)</code></pre>
<pre><code>&gt;#  Family: poisson 
&gt;#   Links: mu = log 
&gt;# Formula: count ~ visit + (1 | patient) 
&gt;#    Data: epilepsy (Number of observations: 236) 
&gt;# Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
&gt;#          total post-warmup samples = 4000
&gt;# 
&gt;# Group-Level Effects: 
&gt;# ~patient (Number of levels: 59) 
&gt;#               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
&gt;# sd(Intercept)     0.98      0.10     0.80     1.19 1.00      497     1060
&gt;# 
&gt;# Population-Level Effects: 
&gt;#           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
&gt;# Intercept     1.71      0.13     1.44     1.96 1.01      277      434
&gt;# visit        -0.06      0.02    -0.10    -0.02 1.00     4587     2982
&gt;# 
&gt;# Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
&gt;# and Tail_ESS are effective sample size measures, and Rhat is the potential
&gt;# scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div id="plotting-the-output-1" class="section level3">
<h3>Plotting the Output</h3>
<pre class="r"><code>random_patients &lt;- sample(unique(epilepsy$patient), size = 12)
plot(
  conditional_effects(
    m2_poisson, 
    type = &quot;pred&quot;, 
    re_formula = NULL, 
    conditions = tibble(patient = random_patients), 
  ), 
  ncol = 4  # six columns in the plot
)</code></pre>
<p><img src="/courses/psyc575/rcode11_bonus_files/figure-html/plot-poisson-1.png" width="672" /></p>
</div>
<div id="interpretation-1" class="section level3">
<h3>Interpretation</h3>
<div id="intercept-1" class="section level4">
<h4>Intercept</h4>
<p>At the first period, the average predicted log seizure rate was 1.7072129, 95% CI [1.4404368, 1.96234].</p>
</div>
<div id="slopes-1" class="section level4">
<h4>Slopes</h4>
<p>The log seizure rate decreased by -0.0589375 every two weeks, 95% CI [-0.099069, -0.0179787].</p>
</div>
<div id="multiplicative-weights" class="section level4">
<h4>Multiplicative weights</h4>
<p>You can exponentiate the coefficients to turn them into multiplicative weights; i.e., <span class="math inline">\(\exp(\gamma)\)</span>. For example, if <span class="math inline">\(\exp(\gamma) = 0.9\)</span>, it means that every unit increase in the predictor is associated with a decrease in the outcome by 10%.</p>
<p>The log seizure rate decreased by 5.7234264% every two weeks, 95% CI [9.4319748%, 1.7818093%].</p>
</div>
</div>
<div id="predictive-check" class="section level3">
<h3>Predictive Check</h3>
<p>You can check whether the model simulates data that look like the sample data.</p>
<pre class="r"><code>pp_check(m2_poisson)</code></pre>
<pre><code>&gt;# Using 10 posterior samples for ppc type &#39;dens_overlay&#39; by default.</code></pre>
<p><img src="/courses/psyc575/rcode11_bonus_files/figure-html/ppcheck-m2-1.png" width="672" /></p>
</div>
</div>
</div>
